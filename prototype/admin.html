<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin - Customer Status Tracker</title>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css?v=9">
</head>
<body>
  <div class="app-container">
    <!-- Side Navigation -->
    <nav class="side-nav" id="sideNav">
      <div class="side-nav__header">
        <div class="side-nav__logo">CS</div>
        <span class="side-nav__title">CS Tracker</span>
      </div>
      <ul class="side-nav__items">
        <li class="side-nav__item">
          <a href="index.html" class="side-nav__link">
            <svg viewBox="0 0 32 32"><path d="M16 2L2 12v18h10V18h8v12h10V12L16 2zm12 26h-6V16H10v12H4V13.21l12-9 12 9V28z"/></svg>
            <span>Dashboard</span>
          </a>
        </li>
        <li class="side-nav__item">
          <a href="customers.html" class="side-nav__link">
            <svg viewBox="0 0 32 32"><path d="M28 10h-6V6c0-1.1-.9-2-2-2h-8c-1.1 0-2 .9-2 2v4H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h24c1.1 0 2-.9 2-2V12c0-1.1-.9-2-2-2zM12 6h8v4h-8V6zm16 20H4V12h24v14z"/></svg>
            <span>Customers</span>
          </a>
        </li>
        <li class="side-nav__item">
          <a href="tasks.html" class="side-nav__link">
            <svg viewBox="0 0 32 32"><path d="M14 21.5l-5-4.96L7.59 18 14 24.35 25.41 13 24 11.59 14 21.5z"/><path d="M16 2C8.27 2 2 8.27 2 16s6.27 14 14 14 14-6.27 14-14S23.73 2 16 2zm0 26C9.38 28 4 22.62 4 16S9.38 4 16 4s12 5.38 12 12-5.38 12-12 12z"/></svg>
            <span>Tasks</span>
          </a>
        </li>
        <li class="side-nav__divider"></li>
        <li class="side-nav__item">
          <a href="admin.html" class="side-nav__link active">
            <svg viewBox="0 0 32 32"><path d="M27 16.76V16v-.77l1.92-1.68a2 2 0 00.4-2.4l-2-3.46a2 2 0 00-1.94-1 2 2 0 00-.64.1l-2.43.82a11.35 11.35 0 00-1.31-.75l-.51-2.52a2 2 0 00-2-1.61h-4a2 2 0 00-2 1.61l-.51 2.52a11.48 11.48 0 00-1.32.75l-2.38-.86a2 2 0 00-.68-.09 2 2 0 00-1.72 1l-2 3.46a2 2 0 00.4 2.4l1.92 1.68V16v.77l-1.92 1.68a2 2 0 00-.4 2.4l2 3.46a2 2 0 00 1.72 1 2 2 0 00.68-.09l2.42-.82a11.35 11.35 0 001.31.75l.51 2.52a2 2 0 002 1.61h4a2 2 0 002-1.61l.51-2.52a11.48 11.48 0 001.32-.75l2.42.82a2 2 0 00.64.09 2 2 0 001.72-1l2-3.46a2 2 0 00-.4-2.4zM16 22a6 6 0 116-6 6 6 0 01-6 6z"/></svg>
            <span>Admin</span>
          </a>
        </li>
      </ul>
      <button class="side-nav__toggle" id="navToggleBtn" title="Collapse menu">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="11 17 6 12 11 7"></polyline>
          <polyline points="18 17 13 12 18 7"></polyline>
        </svg>
        <span class="side-nav__toggle-text">Collapse</span>
      </button>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Header -->
      <header class="header">
        <div class="header__left">
          <button class="hamburger" onclick="toggleNav()">
            <span></span>
            <span></span>
            <span></span>
          </button>
          <div>
            <h1 class="header__title">Admin</h1>
            <p class="header__subtitle">Data Management</p>
          </div>
        </div>
      </header>

      <!-- Page Content -->
      <div class="page-content">
        <!-- Data Statistics -->
        <div class="card mb-5">
          <div class="card__header">
            <h2 class="card__title">Database Statistics</h2>
            <button class="btn btn--ghost" onclick="refreshStats()">
              <svg width="16" height="16" viewBox="0 0 32 32"><path d="M12 10H6.78A11 11 0 0127 16h2A13 13 0 006 7.68V4H4v8h8zM20 22h5.22A11 11 0 015 16H3a13 13 0 0023 8.32V28h2v-8h-8z"/></svg>
              Refresh
            </button>
          </div>
          <div class="grid grid--4 gap-4" id="statsGrid">
            <div class="stat-item">
              <div class="stat-item__label">Users</div>
              <div class="stat-item__value" id="stat-users">-</div>
            </div>
            <div class="stat-item">
              <div class="stat-item__label">Customers</div>
              <div class="stat-item__value" id="stat-customers">-</div>
            </div>
            <div class="stat-item">
              <div class="stat-item__label">Contacts</div>
              <div class="stat-item__value" id="stat-contacts">-</div>
            </div>
            <div class="stat-item">
              <div class="stat-item__label">Tasks</div>
              <div class="stat-item__value" id="stat-tasks">-</div>
            </div>
            <div class="stat-item">
              <div class="stat-item__label">Engagements</div>
              <div class="stat-item__value" id="stat-engagements">-</div>
            </div>
            <div class="stat-item">
              <div class="stat-item__label">Partners</div>
              <div class="stat-item__value" id="stat-partners">-</div>
            </div>
            <div class="stat-item">
              <div class="stat-item__label">Use Cases</div>
              <div class="stat-item__value" id="stat-use_cases">-</div>
            </div>
            <div class="stat-item">
              <div class="stat-item__label">Roadmaps</div>
              <div class="stat-item__value" id="stat-roadmaps">-</div>
            </div>
          </div>
        </div>

        <!-- Data Management Actions -->
        <div class="grid grid--2 gap-5">
          <!-- Clear Test Data -->
          <div class="card">
            <div class="card__header">
              <h2 class="card__title">Clear Test Data</h2>
            </div>
            <div class="card__body">
              <p class="text-secondary mb-4">
                Remove all test data from the database. This will delete customers, tasks, engagements, contacts, use cases, roadmaps, and partners.
              </p>
              <div class="form-group mb-4">
                <label class="checkbox-wrapper">
                  <input type="checkbox" id="keepUsersCheckbox" checked>
                  <span class="checkbox-label">Keep user accounts</span>
                </label>
              </div>
              <div class="notification notification--warning mb-4">
                <svg width="20" height="20" viewBox="0 0 32 32" fill="#8e6a00"><path d="M16 2L1 29h30L16 2zm-1 10h2v8h-2v-8zm1 14c-.8 0-1.5-.7-1.5-1.5S15.2 23 16 23s1.5.7 1.5 1.5S16.8 26 16 26z"/></svg>
                <span>This action cannot be undone!</span>
              </div>
              <button class="btn btn--danger" onclick="clearTestData()" id="clearDataBtn">
                <svg width="16" height="16" viewBox="0 0 32 32" fill="currentColor"><path d="M12 12h2v12h-2zM18 12h2v12h-2z"/><path d="M4 6v2h2v20a2 2 0 002 2h16a2 2 0 002-2V8h2V6zm4 22V8h16v20zM12 2h8v2h-8z"/></svg>
                Clear All Data
              </button>
            </div>
          </div>

          <!-- Reseed Data -->
          <div class="card">
            <div class="card__header">
              <h2 class="card__title">Reseed Sample Data</h2>
            </div>
            <div class="card__body">
              <p class="text-secondary mb-4">
                Populate the database with sample data for testing and development. This includes sample customers, tasks, engagements, contacts, use cases, and roadmaps.
              </p>
              <div class="notification notification--info mb-4">
                <svg width="20" height="20" viewBox="0 0 32 32" fill="var(--cds-support-info)"><path d="M16 2C8.3 2 2 8.3 2 16s6.3 14 14 14 14-6.3 14-14S23.7 2 16 2zm-1 7h2v2h-2V9zm4 14h-6v-2h2v-5h-2v-2h4v7h2v2z"/></svg>
                <span>Data can only be seeded when the database is empty (no customers).</span>
              </div>
              <button class="btn btn--primary" onclick="reseedData()" id="reseedBtn">
                <svg width="16" height="16" viewBox="0 0 32 32" fill="currentColor"><path d="M12 10H6.78A11 11 0 0127 16h2A13 13 0 006 7.68V4H4v8h8zM20 22h5.22A11 11 0 015 16H3a13 13 0 0023 8.32V28h2v-8h-8z"/></svg>
                Reseed Database
              </button>
            </div>
          </div>
        </div>

        <!-- User Management -->
        <div class="card mt-5">
          <div class="card__header">
            <h2 class="card__title">User Management</h2>
            <button class="btn btn--primary" onclick="openCreateUserModal()">
              <svg width="16" height="16" viewBox="0 0 32 32" fill="currentColor"><path d="M17 15V7h-2v8H7v2h8v8h2v-8h8v-2h-8z"/></svg>
              Create User
            </button>
          </div>
          <div class="card__body">
            <div class="data-table-container">
              <table class="data-table" id="usersTable">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Role</th>
                    <th>Partner</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="usersTableBody">
                  <tr>
                    <td colspan="6" class="text-center text-secondary">Loading users...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Partner Management -->
        <div class="card mt-5">
          <div class="card__header">
            <h2 class="card__title">Partner Management</h2>
            <button class="btn btn--primary" onclick="openCreatePartnerModal()">
              <svg width="16" height="16" viewBox="0 0 32 32" fill="currentColor"><path d="M17 15V7h-2v8H7v2h8v8h2v-8h8v-2h-8z"/></svg>
              Add Partner
            </button>
          </div>
          <div class="card__body">
            <div class="data-table-container">
              <table class="data-table" id="partnersTable">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Code</th>
                    <th>Contact Email</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="partnersTableBody">
                  <tr>
                    <td colspan="5" class="text-center text-secondary">Loading partners...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Use Case Management -->
        <div class="card mt-5">
          <div class="card__header">
            <h2 class="card__title">Use Case Management</h2>
            <div class="flex gap-3">
              <select class="form-select" id="useCaseAreaFilter" onchange="filterUseCases()" style="width: auto; min-width: 120px;">
                <option value="">All Areas</option>
                <option value="WFM">WFM</option>
                <option value="HPM">HPM</option>
                <option value="EAP">EAP</option>
                <option value="POM">POM</option>
                <option value="FPM">FPM</option>
              </select>
              <button class="btn btn--tertiary" onclick="openImportUseCasesModal()">
                <svg width="16" height="16" viewBox="0 0 32 32" fill="currentColor"><path d="M6 17l1.41 1.41L15 10.83V30h2V10.83l7.59 7.58L26 17 16 7 6 17z"/><path d="M6 8V4h20v4h2V4a2 2 0 00-2-2H6a2 2 0 00-2 2v4z"/></svg>
                Import Excel
              </button>
              <button class="btn btn--primary" onclick="openUseCaseModal()">
                <svg width="16" height="16" viewBox="0 0 32 32" fill="currentColor"><path d="M17 15V7h-2v8H7v2h8v8h2v-8h8v-2h-8z"/></svg>
                Add Use Case
              </button>
            </div>
          </div>
          <div class="card__body">
            <div class="data-table-container" style="max-height: 400px; overflow-y: auto;">
              <table class="data-table" id="useCasesTable">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Solution Area</th>
                    <th>Domain</th>
                    <th>Order</th>
                    <th>Active</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="useCasesTableBody">
                  <tr>
                    <td colspan="6" class="text-center text-secondary">Loading use cases...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Adoption Journey Overview -->
        <div class="card mt-5">
          <div class="card__header">
            <h2 class="card__title">Adoption Journey Overview</h2>
            <button class="btn btn--ghost" onclick="refreshAdoptionStats()">
              <svg width="16" height="16" viewBox="0 0 32 32"><path d="M12 10H6.78A11 11 0 0127 16h2A13 13 0 006 7.68V4H4v8h8zM20 22h5.22A11 11 0 015 16H3a13 13 0 0023 8.32V28h2v-8h-8z"/></svg>
              Refresh
            </button>
          </div>
          <div class="card__body">
            <!-- Stage Distribution Stats -->
            <div class="grid grid--5 gap-4 mb-5" id="adoptionStatsGrid">
              <div class="adoption-stat-card" data-stage="onboarding" onclick="filterByStage('onboarding')">
                <div class="adoption-stat-card__number">1</div>
                <div class="adoption-stat-card__content">
                  <div class="adoption-stat-card__name">Onboarding</div>
                  <div class="adoption-stat-card__count" id="adoption-count-onboarding">-</div>
                </div>
              </div>
              <div class="adoption-stat-card" data-stage="adoption" onclick="filterByStage('adoption')">
                <div class="adoption-stat-card__number">2</div>
                <div class="adoption-stat-card__content">
                  <div class="adoption-stat-card__name">Adoption</div>
                  <div class="adoption-stat-card__count" id="adoption-count-adoption">-</div>
                </div>
              </div>
              <div class="adoption-stat-card" data-stage="value_realization" onclick="filterByStage('value_realization')">
                <div class="adoption-stat-card__number">3</div>
                <div class="adoption-stat-card__content">
                  <div class="adoption-stat-card__name">Value Realization</div>
                  <div class="adoption-stat-card__count" id="adoption-count-value_realization">-</div>
                </div>
              </div>
              <div class="adoption-stat-card" data-stage="expansion" onclick="filterByStage('expansion')">
                <div class="adoption-stat-card__number">4</div>
                <div class="adoption-stat-card__content">
                  <div class="adoption-stat-card__name">Expansion</div>
                  <div class="adoption-stat-card__count" id="adoption-count-expansion">-</div>
                </div>
              </div>
              <div class="adoption-stat-card" data-stage="renewal" onclick="filterByStage('renewal')">
                <div class="adoption-stat-card__number">5</div>
                <div class="adoption-stat-card__content">
                  <div class="adoption-stat-card__name">Renewal</div>
                  <div class="adoption-stat-card__count" id="adoption-count-renewal">-</div>
                </div>
              </div>
            </div>

            <!-- Stage Filter Dropdown -->
            <div class="flex gap-3 mb-4">
              <select class="form-select" id="adoptionStageFilter" onchange="filterByStage(this.value)" style="width: auto; min-width: 180px;">
                <option value="">All Stages</option>
                <option value="onboarding">Onboarding</option>
                <option value="adoption">Adoption</option>
                <option value="value_realization">Value Realization</option>
                <option value="expansion">Expansion</option>
                <option value="renewal">Renewal</option>
              </select>
              <span class="tag" id="adoptionFilterCount">- customers</span>
            </div>

            <!-- Customers by Stage Table -->
            <div class="data-table-container" style="max-height: 400px; overflow-y: auto;">
              <table class="data-table" id="adoptionCustomersTable">
                <thead>
                  <tr>
                    <th>Customer</th>
                    <th>Stage</th>
                    <th>Health</th>
                    <th>ARR</th>
                    <th>Renewal Date</th>
                  </tr>
                </thead>
                <tbody id="adoptionCustomersTableBody">
                  <tr>
                    <td colspan="5" class="text-center text-secondary">Loading customers...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- SPM Assessment Templates -->
        <div class="card mt-5">
          <div class="card__header">
            <h2 class="card__title">SPM Assessment Templates</h2>
            <div class="flex gap-3">
              <button class="btn btn--secondary" onclick="openUploadTemplateModal()">
                <svg width="16" height="16" viewBox="0 0 32 32" fill="currentColor"><path d="M6 17l1.41 1.41L15 10.83V30h2V10.83l7.59 7.58L26 17 16 7 6 17z"/><path d="M6 8V4h20v4h2V4a2 2 0 00-2-2H6a2 2 0 00-2 2v4z"/></svg>
                Upload Template
              </button>
              <button class="btn btn--primary" onclick="openCreateTemplateModal()">
                <svg width="16" height="16" viewBox="0 0 32 32" fill="currentColor"><path d="M17 15V7h-2v8H7v2h8v8h2v-8h8v-2h-8z"/></svg>
                Create Template
              </button>
            </div>
          </div>
          <div class="card__body">
            <div class="data-table-container">
              <table class="data-table" id="assessmentTemplatesTable">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                    <th>Questions</th>
                    <th>Dimensions</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="assessmentTemplatesTableBody">
                  <tr>
                    <td colspan="6" class="text-center text-secondary">Loading templates...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Authentication Settings -->
        <div class="card mt-5">
          <div class="card__header">
            <h2 class="card__title">Authentication Settings</h2>
            <span class="tag" id="authStatusBadge">Loading...</span>
          </div>
          <div class="card__body">
            <p class="text-secondary mb-4">
              Control whether authentication is required to access the application. When disabled, the app is accessible without login (useful for development/testing).
            </p>
            <div class="setting-row">
              <div class="setting-info">
                <div class="setting-label">Require Authentication</div>
                <div class="setting-description">When enabled, users must log in to access the application.</div>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" id="authEnabledToggle" onchange="toggleAuthEnabled()">
                <span class="toggle-slider"></span>
              </label>
            </div>
          </div>
        </div>

        <!-- Database Migration -->
        <div class="card mt-5">
          <div class="card__header">
            <h2 class="card__title">Database Migrations</h2>
          </div>
          <div class="card__body">
            <p class="text-secondary mb-4">
              Run database migrations to update the schema with new columns. This is safe to run multiple times.
            </p>
            <button class="btn btn--secondary" onclick="runMigrations()" id="migrateBtn">
              <svg width="16" height="16" viewBox="0 0 32 32" fill="currentColor"><path d="M12 10H6.78A11 11 0 0127 16h2A13 13 0 006 7.68V4H4v8h8zM20 22h5.22A11 11 0 015 16H3a13 13 0 0023 8.32V28h2v-8h-8z"/></svg>
              Run Migrations
            </button>
          </div>
        </div>

        <!-- Operation Results -->
        <div class="card mt-5" id="resultsCard" style="display: none;">
          <div class="card__header">
            <h2 class="card__title">Operation Results</h2>
            <button class="btn btn--ghost" onclick="hideResults()">
              <svg width="16" height="16" viewBox="0 0 32 32"><path d="M24 9.4L22.6 8 16 14.6 9.4 8 8 9.4 14.6 16 8 22.6 9.4 24 16 17.4 22.6 24 24 22.6 17.4 16 24 9.4z"/></svg>
            </button>
          </div>
          <div class="card__body" id="resultsContent">
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Create User Modal -->
  <div class="modal-overlay" id="createUserModal">
    <div class="modal">
      <div class="modal__header">
        <h2 class="modal__title" id="userModalTitle">Create User</h2>
        <button class="modal__close" onclick="closeCreateUserModal()">
          <svg width="20" height="20" viewBox="0 0 32 32"><path d="M24 9.4L22.6 8 16 14.6 9.4 8 8 9.4 14.6 16 8 22.6 9.4 24 16 17.4 22.6 24 24 22.6 17.4 16 24 9.4z"/></svg>
        </button>
      </div>
      <form id="createUserForm" onsubmit="handleUserSubmit(event)">
        <input type="hidden" id="userEditId" value="">
        <div class="modal__body">
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label" for="userFirstName">First Name *</label>
              <input type="text" class="form-input" id="userFirstName" name="first_name" required>
            </div>
            <div class="form-group">
              <label class="form-label" for="userLastName">Last Name *</label>
              <input type="text" class="form-input" id="userLastName" name="last_name" required>
            </div>
            <div class="form-group" style="grid-column: 1 / -1;">
              <label class="form-label" for="userEmail">Email *</label>
              <input type="email" class="form-input" id="userEmail" name="email" required>
            </div>
            <div class="form-group">
              <label class="form-label" for="userRole">Role *</label>
              <select class="form-select" id="userRole" name="role" required>
                <option value="csm">CSM</option>
                <option value="manager">Manager</option>
                <option value="admin">Admin</option>
                <option value="read_only">Read Only</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label" for="userW3id">W3ID (Optional)</label>
              <input type="text" class="form-input" id="userW3id" name="w3id" placeholder="e.g., jsmith@us.ibm.com">
            </div>
            <div class="form-group" style="grid-column: 1 / -1;">
              <label class="checkbox-wrapper">
                <input type="checkbox" id="userIsPartner" name="is_partner_user" onchange="togglePartnerSelect()">
                <span class="checkbox-label">This user is from a partner organization</span>
              </label>
            </div>
            <div class="form-group" id="partnerSelectGroup" style="grid-column: 1 / -1; display: none;">
              <label class="form-label" for="userPartner">Partner Organization *</label>
              <select class="form-select" id="userPartner" name="partner_id">
                <option value="">Select a partner...</option>
              </select>
            </div>
          </div>
        </div>
        <div class="modal__footer">
          <button type="button" class="btn btn--secondary" onclick="closeCreateUserModal()">Cancel</button>
          <button type="submit" class="btn btn--primary" id="createUserBtn">Create User</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Create Partner Modal -->
  <div class="modal-overlay" id="createPartnerModal">
    <div class="modal">
      <div class="modal__header">
        <h2 class="modal__title" id="partnerModalTitle">Create Partner</h2>
        <button class="modal__close" onclick="closePartnerModal()">
          <svg width="20" height="20" viewBox="0 0 32 32"><path d="M24 9.4L22.6 8 16 14.6 9.4 8 8 9.4 14.6 16 8 22.6 9.4 24 16 17.4 22.6 24 24 22.6 17.4 16 24 9.4z"/></svg>
        </button>
      </div>
      <form id="partnerForm" onsubmit="handlePartnerSubmit(event)">
        <input type="hidden" id="partnerEditId" value="">
        <div class="modal__body">
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label" for="partnerName">Partner Name *</label>
              <input type="text" class="form-input" id="partnerName" name="name" required placeholder="e.g., Acme Consulting">
            </div>
            <div class="form-group">
              <label class="form-label" for="partnerCode">Code *</label>
              <input type="text" class="form-input" id="partnerCode" name="code" required placeholder="e.g., acme_consulting">
              <span class="form-hint">Unique identifier (lowercase, no spaces)</span>
            </div>
            <div class="form-group" style="grid-column: 1 / -1;">
              <label class="form-label" for="partnerEmail">Contact Email</label>
              <input type="email" class="form-input" id="partnerEmail" name="contact_email" placeholder="e.g., contact@partner.com">
            </div>
            <div class="form-group">
              <label class="form-label" for="partnerPhone">Contact Phone</label>
              <input type="tel" class="form-input" id="partnerPhone" name="contact_phone" placeholder="e.g., +1-555-0100">
            </div>
            <div class="form-group">
              <label class="form-label" for="partnerWebsite">Website</label>
              <input type="url" class="form-input" id="partnerWebsite" name="website" placeholder="e.g., https://partner.com">
            </div>
          </div>
        </div>
        <div class="modal__footer">
          <button type="button" class="btn btn--secondary" onclick="closePartnerModal()">Cancel</button>
          <button type="submit" class="btn btn--primary" id="partnerSubmitBtn">Create Partner</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Use Case Modal -->
  <div class="modal-overlay" id="useCaseModal">
    <div class="modal">
      <div class="modal__header">
        <h2 class="modal__title" id="useCaseModalTitle">Add Use Case</h2>
        <button class="modal__close" onclick="closeUseCaseModal()">
          <svg width="20" height="20" viewBox="0 0 32 32"><path d="M24 9.4L22.6 8 16 14.6 9.4 8 8 9.4 14.6 16 8 22.6 9.4 24 16 17.4 22.6 24 24 22.6 17.4 16 24 9.4z"/></svg>
        </button>
      </div>
      <form id="useCaseForm" onsubmit="handleUseCaseSubmit(event)">
        <input type="hidden" id="useCaseEditId" value="">
        <div class="modal__body">
          <div class="form-grid">
            <div class="form-group" style="grid-column: 1 / -1;">
              <label class="form-label" for="useCaseName">Use Case Name *</label>
              <input type="text" class="form-input" id="useCaseName" name="name" required placeholder="e.g., Set and cascade corporate OKRs">
            </div>
            <div class="form-group">
              <label class="form-label" for="useCaseSolutionArea">Solution Area *</label>
              <select class="form-select" id="useCaseSolutionArea" name="solution_area" required>
                <option value="">Select...</option>
                <option value="WFM">WFM - Workforce Management</option>
                <option value="HPM">HPM - Hybrid Portfolio Management</option>
                <option value="EAP">EAP - Enterprise Agile Planning</option>
                <option value="POM">POM - Product Operating Model</option>
                <option value="FPM">FPM - Financial Portfolio Management</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label" for="useCaseDomain">Domain *</label>
              <select class="form-select" id="useCaseDomain" name="domain" required>
                <option value="">Select...</option>
                <option value="Strategic Planning">Strategic Planning</option>
                <option value="Portfolio Management">Portfolio Management</option>
                <option value="Capacity Management">Capacity Management</option>
                <option value="Resource Management">Resource Management</option>
                <option value="Financial Management">Financial Management</option>
              </select>
            </div>
            <div class="form-group" style="grid-column: 1 / -1;">
              <label class="form-label" for="useCaseDescription">Description</label>
              <textarea class="form-input" id="useCaseDescription" name="description" rows="3" placeholder="Optional description of this use case"></textarea>
            </div>
            <div class="form-group">
              <label class="form-label" for="useCaseOrder">Display Order</label>
              <input type="number" class="form-input" id="useCaseOrder" name="display_order" value="1" min="1">
              <span class="form-hint">Lower numbers appear first within the domain</span>
            </div>
            <div class="form-group">
              <label class="checkbox-wrapper" style="margin-top: 24px;">
                <input type="checkbox" id="useCaseActive" name="is_active" checked>
                <span class="checkbox-label">Active</span>
              </label>
            </div>
          </div>
        </div>
        <div class="modal__footer">
          <button type="button" class="btn btn--secondary" onclick="closeUseCaseModal()">Cancel</button>
          <button type="submit" class="btn btn--primary" id="useCaseSubmitBtn">Add Use Case</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Import Use Cases Modal -->
  <div class="modal-overlay" id="importUseCasesModal">
    <div class="modal">
      <div class="modal__header">
        <h2 class="modal__title">Import Use Cases from Excel</h2>
        <button class="modal__close" onclick="closeImportUseCasesModal()">
          <svg width="20" height="20" viewBox="0 0 32 32"><path d="M24 9.4L22.6 8 16 14.6 9.4 8 8 9.4 14.6 16 8 22.6 9.4 24 16 17.4 22.6 24 24 22.6 17.4 16 24 9.4z"/></svg>
        </button>
      </div>
      <form id="importUseCasesForm" onsubmit="handleImportUseCases(event)">
        <div class="modal__body">
          <div class="notification notification--info mb-4">
            <svg width="20" height="20" viewBox="0 0 32 32" fill="var(--cds-support-info)"><path d="M16 2C8.3 2 2 8.3 2 16s6.3 14 14 14 14-6.3 14-14S23.7 2 16 2zm-1 7h2v2h-2V9zm4 14h-6v-2h2v-5h-2v-2h4v7h2v2z"/></svg>
            <span>Upload an Excel file (.xlsx) with the following columns: <strong>name</strong> (required), <strong>solution_area</strong> (required: WFM, HPM, EAP, POM, or FPM), <strong>domain</strong> (required), description, category, display_order.</span>
          </div>
          <div class="form-group">
            <label class="form-label" for="useCaseImportFile">Excel File *</label>
            <input type="file" class="form-input" id="useCaseImportFile" name="file" accept=".xlsx,.xls" required>
            <span class="form-hint">Accepts .xlsx or .xls files</span>
          </div>
          <div class="form-group">
            <label class="checkbox-wrapper">
              <input type="checkbox" id="useCaseReplaceExisting" name="replace_existing">
              <span class="checkbox-label">Replace all existing use cases</span>
            </label>
            <span class="form-hint text-danger">Warning: This will delete ALL existing use cases and customer tracking before importing!</span>
          </div>
        </div>
        <div class="modal__footer">
          <button type="button" class="btn btn--secondary" onclick="closeImportUseCasesModal()">Cancel</button>
          <button type="submit" class="btn btn--primary" id="importUseCasesBtn">Import Use Cases</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Upload Assessment Template Modal -->
  <div class="modal-overlay" id="uploadTemplateModal">
    <div class="modal">
      <div class="modal__header">
        <h2 class="modal__title">Upload Assessment Template</h2>
        <button class="modal__close" onclick="closeUploadTemplateModal()">
          <svg width="20" height="20" viewBox="0 0 32 32"><path d="M24 9.4L22.6 8 16 14.6 9.4 8 8 9.4 14.6 16 8 22.6 9.4 24 16 17.4 22.6 24 24 22.6 17.4 16 24 9.4z"/></svg>
        </button>
      </div>
      <form id="uploadTemplateForm" onsubmit="handleTemplateUpload(event)">
        <div class="modal__body">
          <div class="notification notification--info mb-4">
            <svg width="20" height="20" viewBox="0 0 32 32" fill="var(--cds-support-info)"><path d="M16 2C8.3 2 2 8.3 2 16s6.3 14 14 14 14-6.3 14-14S23.7 2 16 2zm-1 7h2v2h-2V9zm4 14h-6v-2h2v-5h-2v-2h4v7h2v2z"/></svg>
            <span>Upload an Excel (.xlsx) or CSV file with dimensions and questions. The system will parse the TBM Maturity Assessment format automatically.</span>
          </div>
          <div class="form-group">
            <label class="form-label" for="templateName">Template Name *</label>
            <input type="text" class="form-input" id="templateName" name="name" required placeholder="e.g., SPM Maturity Assessment">
          </div>
          <div class="form-group">
            <label class="form-label" for="templateVersion">Version *</label>
            <input type="text" class="form-input" id="templateVersion" name="version" required placeholder="e.g., 1.0">
          </div>
          <div class="form-group">
            <label class="form-label" for="templateDescription">Description</label>
            <textarea class="form-input" id="templateDescription" name="description" rows="2" placeholder="Optional description"></textarea>
          </div>
          <div class="form-group">
            <label class="form-label" for="templateFile">Template File *</label>
            <input type="file" class="form-input" id="templateFile" name="file" accept=".xlsx,.xls,.csv" required>
            <span class="form-hint">Accepts .xlsx, .xls, or .csv files. Include columns for Question Number, Dimension, Question Text, and optionally Min/Max Score and Score Labels.</span>
          </div>
        </div>
        <div class="modal__footer">
          <button type="button" class="btn btn--secondary" onclick="closeUploadTemplateModal()">Cancel</button>
          <button type="submit" class="btn btn--primary" id="uploadTemplateBtn">Upload Template</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Create Assessment Template Modal -->
  <div class="modal-overlay" id="createTemplateModal">
    <div class="modal">
      <div class="modal__header">
        <h2 class="modal__title" id="templateModalTitle">Create Template</h2>
        <button class="modal__close" onclick="closeCreateTemplateModal()">
          <svg width="20" height="20" viewBox="0 0 32 32"><path d="M24 9.4L22.6 8 16 14.6 9.4 8 8 9.4 14.6 16 8 22.6 9.4 24 16 17.4 22.6 24 24 22.6 17.4 16 24 9.4z"/></svg>
        </button>
      </div>
      <form id="createTemplateForm" onsubmit="handleCreateTemplate(event)">
        <input type="hidden" id="templateEditId" value="">
        <div class="modal__body">
          <div class="form-group">
            <label class="form-label" for="createTemplateName">Template Name *</label>
            <input type="text" class="form-input" id="createTemplateName" name="name" required placeholder="e.g., SPM Maturity Assessment">
          </div>
          <div class="form-group">
            <label class="form-label" for="createTemplateVersion">Version *</label>
            <input type="text" class="form-input" id="createTemplateVersion" name="version" required placeholder="e.g., 1.0">
          </div>
          <div class="form-group">
            <label class="form-label" for="createTemplateDescription">Description</label>
            <textarea class="form-input" id="createTemplateDescription" name="description" rows="2" placeholder="Optional description"></textarea>
          </div>
        </div>
        <div class="modal__footer">
          <button type="button" class="btn btn--secondary" onclick="closeCreateTemplateModal()">Cancel</button>
          <button type="submit" class="btn btn--primary" id="createTemplateSubmitBtn">Create Template</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Toast container -->
  <div id="toastContainer" class="toast-container"></div>

  <!-- Scripts -->
  <script src="js/auth.js?v=5"></script>
  <script src="js/api.js?v=10"></script>
  <script src="js/admin.js?v=10"></script>
  <script>
    function toggleNav() {
      document.getElementById('sideNav').classList.toggle('open');
    }

    // Nav collapse functionality
    document.addEventListener('DOMContentLoaded', function() {
      const sideNav = document.getElementById('sideNav');
      const toggleBtn = document.getElementById('navToggleBtn');

      if (localStorage.getItem('navCollapsed') === 'true') {
        sideNav.classList.add('collapsed');
      }

      if (toggleBtn) {
        toggleBtn.addEventListener('click', function() {
          sideNav.classList.toggle('collapsed');
          localStorage.setItem('navCollapsed', sideNav.classList.contains('collapsed'));
        });
      }
    });
  </script>
</body>
</html>
