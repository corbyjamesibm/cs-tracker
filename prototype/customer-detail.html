<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Customer Detail - CS Tracker</title>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css?v=35">
  <link rel="stylesheet" href="css/chat.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-sankey@0.12.0/dist/chartjs-chart-sankey.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <style>
    .customer-header {
      background: linear-gradient(135deg, #161616 0%, #393939 100%);
      color: white;
      padding: var(--cds-spacing-06);
      margin: 0 calc(-1 * var(--cds-spacing-06)) var(--cds-spacing-05);
    }
    .customer-header__top {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: var(--cds-spacing-05);
    }
    .customer-header__name {
      font-size: 2rem;
      font-weight: 600;
      margin-bottom: var(--cds-spacing-02);
    }
    .customer-header__meta {
      display: flex;
      gap: var(--cds-spacing-05);
      font-size: 0.875rem;
      opacity: 0.8;
    }
    .customer-header__stats {
      display: flex;
      gap: var(--cds-spacing-07);
    }
    .customer-header__stat {
      text-align: center;
    }
    .customer-header__stat-value {
      font-size: 1.5rem;
      font-weight: 600;
    }
    .customer-header__stat-label {
      font-size: 0.75rem;
      opacity: 0.7;
      text-transform: uppercase;
    }
    .section-title {
      font-size: 1.125rem;
      font-weight: 600;
      margin-bottom: var(--cds-spacing-04);
      display: flex;
      align-items: center;
      gap: var(--cds-spacing-03);
    }
    .adoption-stage {
      display: flex;
      gap: var(--cds-spacing-02);
      margin-bottom: var(--cds-spacing-05);
    }
    .adoption-stage__step {
      flex: 1;
      text-align: center;
      padding: var(--cds-spacing-03);
      background: var(--cds-layer-02);
      border-radius: 4px;
      font-size: 0.75rem;
      position: relative;
    }
    .adoption-stage__step::after {
      content: '';
      position: absolute;
      right: -8px;
      top: 50%;
      transform: translateY(-50%);
      border: 6px solid transparent;
      border-left-color: var(--cds-layer-02);
      z-index: 1;
    }
    .adoption-stage__step:last-child::after {
      display: none;
    }
    .adoption-stage__step.completed {
      background: var(--cds-support-success);
      color: white;
    }
    .adoption-stage__step.completed::after {
      border-left-color: var(--cds-support-success);
    }
    .adoption-stage__step.current {
      background: var(--cds-interactive);
      color: white;
    }
    .adoption-stage__step.current::after {
      border-left-color: var(--cds-interactive);
    }
    .checklist {
      list-style: none;
    }
    .checklist__item {
      display: flex;
      align-items: center;
      gap: var(--cds-spacing-03);
      padding: var(--cds-spacing-03) 0;
      border-bottom: 1px solid var(--cds-border-subtle-01);
    }
    .checklist__checkbox {
      width: 20px;
      height: 20px;
      border: 2px solid var(--cds-border-strong-01);
      border-radius: 2px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    .checklist__checkbox.checked {
      background: var(--cds-support-success);
      border-color: var(--cds-support-success);
      color: white;
    }
    .checklist__checkbox.in-progress {
      background: var(--cds-support-warning);
      border-color: var(--cds-support-warning);
    }
    .contact-card {
      display: flex;
      align-items: center;
      gap: var(--cds-spacing-04);
      padding: var(--cds-spacing-04);
      background: var(--cds-layer-02);
      border-radius: 4px;
      margin-bottom: var(--cds-spacing-03);
    }
    .contact-card__info {
      flex: 1;
    }
    .contact-card__name {
      font-weight: 500;
    }
    .contact-card__role {
      font-size: 0.75rem;
      color: var(--cds-text-secondary);
    }
    .contact-card__actions {
      display: flex;
      gap: var(--cds-spacing-02);
    }
    @media (max-width: 768px) {
      .customer-header {
        padding: var(--cds-spacing-05);
        margin: calc(-1 * var(--cds-spacing-05));
        margin-bottom: var(--cds-spacing-04);
      }
      .customer-header__top {
        flex-direction: column;
        gap: var(--cds-spacing-04);
      }
      .customer-header__name {
        font-size: 1.5rem;
      }
      .customer-header__stats {
        gap: var(--cds-spacing-05);
        flex-wrap: wrap;
      }
      .adoption-stage {
        flex-direction: column;
      }
      .adoption-stage__step::after {
        display: none;
      }
    }
    /* Recommendation Cards - styles moved to styles.css */
    .weak-dimension-chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: var(--cds-support-error-inverse);
      color: var(--cds-support-error);
      font-size: 13px;
      padding: 6px 12px;
      border-radius: 16px;
      font-weight: 500;
    }
    .weak-dimension-chip__score {
      background: rgba(0,0,0,0.1);
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 12px;
    }
    /* Assessment Type Tabs */
    .assessment-type-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
      padding: 0 16px;
    }
    .assessment-type-tab {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 16px;
      background: transparent;
      border: 1px solid var(--cds-border-subtle-01);
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      color: var(--cds-text-secondary);
      transition: all 0.15s ease;
    }
    .assessment-type-tab:hover {
      background: var(--cds-layer-hover-01);
    }
    .assessment-type-tab.active {
      background: var(--cds-layer-01);
      border-color: var(--cds-border-strong-01);
      color: var(--cds-text-primary);
    }
    .assessment-type-tab__indicator {
      width: 10px;
      height: 10px;
      border-radius: 50%;
    }
    .assessment-type-tab__score {
      background: var(--cds-layer-02);
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 12px;
      font-weight: 600;
    }
    .assessment-type-tab.active .assessment-type-tab__score {
      background: var(--cds-interactive);
      color: white;
    }
    .assessment-tab-panel {
      display: none;
    }
    .assessment-tab-panel.active {
      display: block;
    }

    /* Roadmap drag and resize styles */
    .roadmap-item {
      transition: box-shadow 0.15s ease, opacity 0.15s ease;
    }
    .roadmap-item:hover {
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }
    .roadmap-item:hover .roadmap-resize-handle {
      background: rgba(255,255,255,0.3);
    }
    .roadmap-resize-handle:hover {
      background: rgba(255,255,255,0.5) !important;
    }
    .roadmap-resize-left:hover {
      border-left: 3px solid rgba(255,255,255,0.8);
    }
    .roadmap-resize-right:hover {
      border-right: 3px solid rgba(255,255,255,0.8);
    }
    .roadmap-item.dragging {
      opacity: 0.8;
      cursor: grabbing !important;
      z-index: 100;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }

    /* Roadmap item text wrapping */
    .roadmap-item {
      min-width: 0; /* Allow flex item to shrink below content size */
      overflow: hidden;
    }
    .roadmap-item-content {
      display: flex;
      flex-direction: column;
      min-width: 0;
      overflow: hidden;
    }
    .roadmap-item-title {
      min-width: 0;
    }
    .roadmap-item-title span {
      min-width: 0;
      flex: 1;
    }
    /* Highlighted items during dependency hover */
    .roadmap-item.dep-highlight {
      box-shadow: 0 0 0 2px rgba(255,255,255,0.8), 0 4px 12px rgba(0,0,0,0.3) !important;
      transform: scale(1.02);
      transition: transform 0.15s ease, box-shadow 0.15s ease;
    }

    /* Drop target styles for anchor dragging */
    .roadmap-drop-target {
      box-shadow: 0 1px 3px rgba(0,0,0,0.2);
    }
    .roadmap-drop-target.highlighted {
      background: #8a3ffc !important;
      transform: scale(1.5) !important;
      box-shadow: 0 0 10px rgba(138, 63, 252, 0.8) !important;
    }

    /* Indicate draggable endpoints on hover */
    .roadmap-item svg circle[data-edit-end] {
      cursor: grab;
    }
    .roadmap-item svg circle[data-edit-end]:active {
      cursor: grabbing;
    }

    /* Visual feedback during anchor drag */
    body.anchor-dragging {
      cursor: grabbing !important;
      user-select: none;
    }
    body.anchor-dragging .roadmap-item {
      pointer-events: none;
    }
    body.anchor-dragging .roadmap-drop-target {
      pointer-events: auto !important;
    }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- Side Navigation -->
    <nav class="side-nav" id="sideNav">
      <div class="side-nav__header">
        <div class="side-nav__logo">CS</div>
        <span class="side-nav__title">CS Tracker</span>
      </div>
      <ul class="side-nav__items">
        <li class="side-nav__item">
          <a href="index.html" class="side-nav__link">
            <svg viewBox="0 0 32 32"><path d="M16 2L2 12v18h10V18h8v12h10V12L16 2zm12 26h-6V16H10v12H4V13.21l12-9 12 9V28z"/></svg>
            <span>Dashboard</span>
          </a>
        </li>
        <li class="side-nav__item">
          <a href="customers.html" class="side-nav__link active">
            <svg viewBox="0 0 32 32"><path d="M28 10h-6V6c0-1.1-.9-2-2-2h-8c-1.1 0-2 .9-2 2v4H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h24c1.1 0 2-.9 2-2V12c0-1.1-.9-2-2-2zM12 6h8v4h-8V6zm16 20H4V12h24v14z"/></svg>
            <span>Customers</span>
          </a>
        </li>
        <li class="side-nav__item">
          <a href="tasks.html" class="side-nav__link">
            <svg viewBox="0 0 32 32"><path d="M14 21.5l-5-4.96L7.59 18 14 24.35 25.41 13 24 11.59 14 21.5z"/><path d="M16 2C8.27 2 2 8.27 2 16s6.27 14 14 14 14-6.27 14-14S23.73 2 16 2zm0 26C9.38 28 4 22.62 4 16S9.38 4 16 4s12 5.38 12 12-5.38 12-12 12z"/></svg>
            <span>Tasks</span>
          </a>
        </li>
        <li class="side-nav__divider"></li>
        <li class="side-nav__item">
          <a href="reports.html" class="side-nav__link">
            <svg viewBox="0 0 32 32"><path d="M10 18H6v8h4v-8zm12-8h-4v16h4V10zm-6 6h-4v10h4V16z"/></svg>
            <span>Reports</span>
          </a>
        </li>
        <li class="side-nav__item">
          <a href="assessment-builder.html" class="side-nav__link">
            <svg viewBox="0 0 32 32"><path d="M26 2H6a2 2 0 00-2 2v24a2 2 0 002 2h14l8-8V4a2 2 0 00-2-2zm0 2v14h-6a2 2 0 00-2 2v6H6V4zM20 24v3.17L25.17 22H22a2 2 0 00-2 2z"/></svg>
            <span>Assessment Builder</span>
          </a>
        </li>
        <li class="side-nav__item">
          <a href="admin.html" class="side-nav__link">
            <svg viewBox="0 0 32 32"><path d="M27 16.76V16v-.77l1.92-1.68a2 2 0 00.4-2.4l-2-3.46a2 2 0 00-1.94-1 2 2 0 00-.64.1l-2.43.82a11.35 11.35 0 00-1.31-.75l-.51-2.52a2 2 0 00-2-1.61h-4a2 2 0 00-2 1.61l-.51 2.52a11.48 11.48 0 00-1.32.75l-2.38-.86a2 2 0 00-.68-.09 2 2 0 00-1.72 1l-2 3.46a2 2 0 00.4 2.4l1.92 1.68V16v.77l-1.92 1.68a2 2 0 00-.4 2.4l2 3.46a2 2 0 00 1.72 1 2 2 0 00.68-.09l2.42-.82a11.35 11.35 0 001.31.75l.51 2.52a2 2 0 002 1.61h4a2 2 0 002-1.61l.51-2.52a11.48 11.48 0 001.32-.75l2.42.82a2 2 0 00.64.09 2 2 0 001.72-1l2-3.46a2 2 0 00-.4-2.4zM16 22a6 6 0 116-6 6 6 0 01-6 6z"/></svg>
            <span>Admin</span>
          </a>
        </li>
      </ul>
      <button class="side-nav__toggle" id="navToggleBtn" title="Collapse menu">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="11 17 6 12 11 7"></polyline>
          <polyline points="18 17 13 12 18 7"></polyline>
        </svg>
        <span class="side-nav__toggle-text">Collapse</span>
      </button>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Header -->
      <header class="header">
        <div class="header__left">
          <button class="hamburger" onclick="toggleNav()">
            <span></span>
            <span></span>
            <span></span>
          </button>
          <a href="customers.html" style="color: var(--cds-text-secondary); text-decoration: none; display: flex; align-items: center; gap: 8px;">
            <svg width="16" height="16" viewBox="0 0 32 32"><path d="M10 16L20 6l1.4 1.4-8.6 8.6 8.6 8.6L20 26z"/></svg>
            Back to Customers
          </a>
        </div>
        <div class="header__right">
          <button class="btn btn--tertiary">
            <svg width="16" height="16" viewBox="0 0 32 32" fill="currentColor"><path d="M4 4v2h2.586L2 10.586 3.414 12 8 7.414V10h2V4H4zm18 0v6h2V7.414L28.586 12 30 10.586 25.414 6H28V4H22z"/></svg>
            Export to PPT
          </button>
          <button class="btn btn--primary" onclick="openTaskModal()">
            <svg width="16" height="16" viewBox="0 0 32 32" fill="currentColor"><path d="M17 15V7h-2v8H7v2h8v8h2v-8h8v-2h-8z"/></svg>
            Add Task
          </button>
          <div class="user-menu">
            <div class="avatar user-avatar">CJ</div>
          </div>
        </div>
      </header>

      <!-- Page Content -->
      <div class="page-content">
        <!-- Customer Header -->
        <div class="customer-header">
          <div class="customer-header__top">
            <div>
              <h1 class="customer-header__name" id="customerName">Loading...</h1>
              <div class="customer-header__meta">
                <span id="customerSfId">-</span>
                <span>|</span>
                <span id="customerProducts">-</span>
                <span>|</span>
                <span id="customerSince"></span>
              </div>
            </div>
            <div style="display: flex; gap: 12px;">
              <span class="health-badge health-badge--gray" id="healthBadge" style="font-size: 14px; padding: 8px 16px;">-</span>
              <span class="tag tag--blue" id="partnerBadge" style="font-size: 14px; padding: 8px 16px; display: none;"></span>
            </div>
          </div>
          <div class="customer-header__stats">
            <div class="customer-header__stat">
              <div class="customer-header__stat-value" id="statArr">-</div>
              <div class="customer-header__stat-label">ARR</div>
            </div>
            <div class="customer-header__stat">
              <div class="customer-header__stat-value" id="statRenewal">-</div>
              <div class="customer-header__stat-label">Renewal</div>
            </div>
            <div class="customer-header__stat">
              <div class="customer-header__stat-value" id="statAdoption">-</div>
              <div class="customer-header__stat-label">Adoption</div>
            </div>
            <div class="customer-header__stat">
              <div class="customer-header__stat-value" id="statDaysToRenewal">-</div>
              <div class="customer-header__stat-label">Days to Renewal</div>
            </div>
          </div>
        </div>

        <!-- Tabs -->
        <nav class="tabs">
          <ul class="tabs__list">
            <li><a href="#" class="tabs__tab active">Overview</a></li>
            <li><a href="#" class="tabs__tab">Usage Framework</a></li>
            <li><a href="#" class="tabs__tab">Engagements</a></li>
            <li><a href="#" class="tabs__tab">Tasks</a></li>
            <li><a href="#" class="tabs__tab">Risks</a></li>
            <li><a href="#" class="tabs__tab">Assessments</a></li>
            <li><a href="#" class="tabs__tab">TargetProcess</a></li>
            <li><a href="#" class="tabs__tab">Roadmap</a></li>
            <li><a href="#" class="tabs__tab">Recommendations</a></li>
            <li><a href="#" class="tabs__tab">Journey</a></li>
            <li><a href="#" class="tabs__tab">Reports</a></li>
            <li><a href="#" class="tabs__tab">Documents</a></li>
          </ul>
        </nav>

        <div class="grid grid--2">
          <!-- Left Column -->
          <div>
            <!-- Account Details -->
            <div class="card">
              <div class="card__header" style="margin-bottom: 16px;">
                <h2 class="section-title" style="margin-bottom: 0;">
                  <svg width="20" height="20" viewBox="0 0 32 32"><path d="M28 10h-6V6c0-1.1-.9-2-2-2h-8c-1.1 0-2 .9-2 2v4H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h24c1.1 0 2-.9 2-2V12c0-1.1-.9-2-2-2z"/></svg>
                  Account Details
                </h2>
                <button class="btn btn--ghost btn--icon" onclick="openEditAccountModal()" title="Edit Account Details">
                  <svg width="16" height="16" viewBox="0 0 32 32" fill="currentColor"><path d="M2 26h28v2H2zM25.4 9c.8-.8.8-2 0-2.8l-3.6-3.6c-.8-.8-2-.8-2.8 0l-15 15V24h6.4l15-15zm-5-5L24 7.6l-3 3L17.4 7l3-3zM6 22v-3.6l10-10 3.6 3.6-10 10H6z"/></svg>
                </button>
              </div>
              <div class="grid grid--2" style="gap: 16px;">
                <div>
                  <div class="form-label">Account Manager</div>
                  <div style="font-weight: 500;" id="accountManager">-</div>
                </div>
                <div>
                  <div class="form-label">CSM Owner</div>
                  <div style="font-weight: 500;" id="csmOwner">-</div>
                </div>
                <div>
                  <div class="form-label">Industry</div>
                  <div id="customerIndustry">-</div>
                </div>
                <div>
                  <div class="form-label">Employees</div>
                  <div id="customerEmployees">-</div>
                </div>
                <div>
                  <div class="form-label">Contract Start</div>
                  <div id="contractStart">-</div>
                </div>
                <div>
                  <div class="form-label">Contract End</div>
                  <div id="contractEnd">-</div>
                </div>
              </div>
            </div>

            <!-- Adoption Journey -->
            <div class="card adoption-journey-card" onclick="openAdoptionStageModal()">
              <div class="adoption-journey-header">
                <h2 class="section-title" style="margin-bottom: 0;">
                  <svg width="20" height="20" viewBox="0 0 32 32"><path d="M12 29a1 1 0 01-.92-.62L6.33 17H2v-2h5a1 1 0 01.92.62L12 25.28l8.06-21.63A1 1 0 0121 3a1 1 0 01.93.68L25.74 15H30v2h-5a1 1 0 01-.95-.68L21 7.04l-8.05 21.34A1 1 0 0112 29z"/></svg>
                  Adoption Journey
                </h2>
                <span class="adoption-journey-edit-hint">
                  <svg width="14" height="14" viewBox="0 0 32 32" fill="currentColor"><path d="M2 26h28v2H2zM25.4 9c.8-.8.8-2 0-2.8l-3.6-3.6c-.8-.8-2-.8-2.8 0l-15 15V24h6.4l15-15zm-5-5L24 7.6l-3 3L17.4 7l3-3zM6 22v-3.6l10-10 3.6 3.6-10 10H6z"/></svg>
                  Click to edit
                </span>
              </div>
              <div class="adoption-stage">
                <div class="adoption-stage__step" id="stage-onboarding">
                  <strong>Onboarding</strong>
                  <div>-</div>
                </div>
                <div class="adoption-stage__step" id="stage-adoption">
                  <strong>Adoption</strong>
                  <div>-</div>
                </div>
                <div class="adoption-stage__step" id="stage-value_realization">
                  <strong>Value Realization</strong>
                  <div>-</div>
                </div>
                <div class="adoption-stage__step" id="stage-expansion">
                  <strong>Expansion</strong>
                  <div>-</div>
                </div>
                <div class="adoption-stage__step" id="stage-renewal">
                  <strong>Renewal</strong>
                  <div>-</div>
                </div>
              </div>
            </div>

            <!-- Use Case Tracker -->
            <div class="card">
              <div class="card__header">
                <h2 class="section-title" style="margin-bottom: 0;">
                  <svg width="20" height="20" viewBox="0 0 32 32"><path d="M14 21.5l-5-4.96L7.59 18 14 24.35 25.41 13 24 11.59 14 21.5z"/></svg>
                  Use Case Tracker
                </h2>
                <span id="useCaseProgress" class="tag tag--blue">Loading...</span>
              </div>
              <div class="progress mb-4" style="height: 12px;">
                <div id="useCaseProgressBar" class="progress__bar progress__bar--success" style="width: 0%;"></div>
              </div>

              <!-- Solution Area Tabs -->
              <div id="solutionAreaTabs" class="tabs mb-4" style="border-bottom: 1px solid var(--cds-border-subtle); display: flex; gap: 0;">
                <button class="tab-btn active" data-area="WFM" style="padding: 8px 16px; border: none; background: none; cursor: pointer; border-bottom: 2px solid var(--cds-interactive); font-weight: 500;">WFM</button>
                <button class="tab-btn" data-area="HPM" style="padding: 8px 16px; border: none; background: none; cursor: pointer; color: var(--cds-text-secondary);">HPM</button>
                <button class="tab-btn" data-area="EAP" style="padding: 8px 16px; border: none; background: none; cursor: pointer; color: var(--cds-text-secondary);">EAP</button>
                <button class="tab-btn" data-area="POM" style="padding: 8px 16px; border: none; background: none; cursor: pointer; color: var(--cds-text-secondary);">POM</button>
                <button class="tab-btn" data-area="FPM" style="padding: 8px 16px; border: none; background: none; cursor: pointer; color: var(--cds-text-secondary);">FPM</button>
              </div>

              <!-- Use Cases Container -->
              <div id="useCasesContainer">
                <div class="text-secondary text-center" style="padding: 24px;">Loading use cases...</div>
              </div>
            </div>
          </div>

          <!-- Right Column -->
          <div>
            <!-- Health Score -->
            <div class="card">
              <div class="card__header" style="padding: 0 0 16px 0; border-bottom: none;">
                <h2 class="section-title" style="margin-bottom: 0;">
                  <svg width="20" height="20" viewBox="0 0 32 32"><path d="M16 2a14 14 0 1014 14A14 14 0 0016 2zm0 26a12 12 0 1112-12 12 12 0 01-12 12z"/><path d="M16 8a8 8 0 108 8 8 8 0 00-8-8zm0 14a6 6 0 116-6 6 6 0 01-6 6z"/></svg>
                  Health Score
                </h2>
                <button class="btn btn--ghost btn--small" onclick="openEditHealthModal()" title="Edit Health Score">
                  <svg width="16" height="16" viewBox="0 0 32 32"><path d="M2 26h28v2H2zM25.4 9c.8-.8.8-2 0-2.8l-3.6-3.6c-.8-.8-2-.8-2.8 0l-15 15V24h6.4l15-15zm-5-5L24 7.6l-3 3L17.4 7l3-3zM6 22v-3.6l10-10 3.6 3.6-10 10H6z"/></svg>
                </button>
              </div>
              <div id="healthScoreContainer" class="flex gap-5 flex-center">
                <div style="text-align: center;">
                  <div id="healthScoreCircle" style="width: 100px; height: 100px; border-radius: 50%; background: conic-gradient(var(--health-green) 0deg 306deg, var(--cds-background-hover) 306deg 360deg); display: flex; align-items: center; justify-content: center;">
                    <div id="healthScoreValue" style="width: 70px; height: 70px; border-radius: 50%; background: white; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: 600; color: var(--health-green);">-</div>
                  </div>
                  <div class="text-secondary mt-2" style="font-size: 12px;">Score</div>
                </div>
                <div style="flex: 1;">
                  <div class="flex flex-between mb-2">
                    <span class="text-secondary">30-day trend</span>
                    <span id="healthTrend" class="text-success">-</span>
                  </div>
                  <div class="flex flex-between mb-2">
                    <span class="text-secondary">Product Usage</span>
                    <span id="productUsage">-</span>
                  </div>
                  <div class="flex flex-between mb-2">
                    <span class="text-secondary">Engagement</span>
                    <span id="engagementLevel">-</span>
                  </div>
                  <div class="flex flex-between">
                    <span class="text-secondary">Support Tickets</span>
                    <span id="supportTickets">-</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Multi-Assessment Maturity Dashboard -->
            <div class="maturity-dashboard" id="maturityDashboard">
              <div class="maturity-dashboard__header">
                <h2 class="maturity-dashboard__title">Maturity Dashboard</h2>
                <div class="maturity-dashboard__overall-score">
                  <span>Overall:</span>
                  <span class="maturity-dashboard__score-value" id="overallMaturityScore">-</span>
                  <span class="maturity-dashboard__score-max">/ 5.0</span>
                </div>
              </div>

              <!-- Overall Radar (3-type radar) -->
              <div class="overall-radar-container">
                <canvas id="overallRadarChart" class="overall-radar-chart"></canvas>
              </div>

              <!-- Mini Radar Cards -->
              <div class="mini-radar-grid" id="miniRadarGrid">
                <!-- SPM Card -->
                <div class="mini-radar-card" data-type="spm" onclick="showAssessmentTypeTab('spm')">
                  <div class="mini-radar-card__header">
                    <span class="mini-radar-card__type-indicator mini-radar-card__type-indicator--spm"></span>
                    SPM
                  </div>
                  <div class="mini-radar-card__chart">
                    <canvas id="miniRadarSpm"></canvas>
                  </div>
                  <div class="mini-radar-card__score" id="spmScore">-</div>
                  <div class="mini-radar-card__score-label">Overall Score</div>
                </div>

                <!-- TBM Card -->
                <div class="mini-radar-card" data-type="tbm" onclick="showAssessmentTypeTab('tbm')">
                  <div class="mini-radar-card__header">
                    <span class="mini-radar-card__type-indicator mini-radar-card__type-indicator--tbm"></span>
                    TBM
                  </div>
                  <div class="mini-radar-card__chart">
                    <canvas id="miniRadarTbm"></canvas>
                  </div>
                  <div class="mini-radar-card__score" id="tbmScore">-</div>
                  <div class="mini-radar-card__score-label">Overall Score</div>
                </div>

                <!-- FinOps Card -->
                <div class="mini-radar-card" data-type="finops" onclick="showAssessmentTypeTab('finops')">
                  <div class="mini-radar-card__header">
                    <span class="mini-radar-card__type-indicator mini-radar-card__type-indicator--finops"></span>
                    FinOps
                  </div>
                  <div class="mini-radar-card__chart">
                    <canvas id="miniRadarFinops"></canvas>
                  </div>
                  <div class="mini-radar-card__score" id="finopsScore">-</div>
                  <div class="mini-radar-card__score-label">Overall Score</div>
                </div>
              </div>
            </div>

            <!-- Cross-Type Insights Section -->
            <div class="card" id="crossTypeInsightsCard" style="display: none;">
              <div class="card__header">
                <h2 class="section-title" style="margin-bottom: 0;">
                  <svg width="20" height="20" viewBox="0 0 32 32"><path d="M16 2a14 14 0 1014 14A14 14 0 0016 2zm0 5a1.5 1.5 0 11-1.5 1.5A1.5 1.5 0 0116 7zm4 17h-8v-2h3v-7h-2v-2h4v9h3z"/></svg>
                  Cross-Type Insights
                </h2>
              </div>
              <div id="crossTypeInsightsContainer">
                <!-- Insights will be rendered here -->
              </div>
            </div>

            <!-- SPM Assessment Summary (Legacy - kept for backward compatibility) -->
            <div class="card" id="spmAssessmentSummaryCard">
              <div class="card__header">
                <h2 class="section-title" style="margin-bottom: 0;">
                  <svg width="20" height="20" viewBox="0 0 32 32"><path d="M16 2a14 14 0 1014 14A14 14 0 0016 2zm0 26a12 12 0 1112-12 12 12 0 01-12 12z"/><path d="M16 10a6 6 0 106 6 6 6 0 00-6-6zm0 10a4 4 0 114-4 4 4 0 01-4 4z"/></svg>
                  SPM Maturity
                </h2>
                <a href="#" class="btn btn--ghost" onclick="event.preventDefault(); showSection('spmAssessment');">View Details</a>
              </div>
              <div id="spmAssessmentSummaryContainer">
                <div class="text-secondary text-center" style="padding: 16px;">Loading...</div>
              </div>
            </div>

            <!-- Key Contacts -->
            <div class="card">
              <div class="card__header">
                <h2 class="section-title" style="margin-bottom: 0;">
                  <svg width="20" height="20" viewBox="0 0 32 32"><path d="M16 4a5 5 0 11-5 5 5 5 0 015-5m0-2a7 7 0 107 7 7 7 0 00-7-7zM26 30h-2v-5a5 5 0 00-5-5h-6a5 5 0 00-5 5v5H6v-5a7 7 0 017-7h6a7 7 0 017 7z"/></svg>
                  Key Contacts
                </h2>
                <button class="btn btn--ghost btn--icon">
                  <svg width="16" height="16" viewBox="0 0 32 32"><path d="M17 15V7h-2v8H7v2h8v8h2v-8h8v-2h-8z"/></svg>
                </button>
              </div>
              <div id="keyContactsContainer">
                <div class="text-secondary text-center" style="padding: 16px;">Loading contacts...</div>
              </div>
            </div>

            <!-- Open Tasks -->
            <div class="card">
              <div class="card__header">
                <h2 class="section-title" style="margin-bottom: 0;">
                  <svg width="20" height="20" viewBox="0 0 32 32"><path d="M14 21.5l-5-4.96L7.59 18 14 24.35 25.41 13 24 11.59 14 21.5z"/></svg>
                  Open Tasks
                </h2>
                <span id="openTasksCount" class="tag">- Tasks</span>
              </div>
              <div id="openTasksContainer">
                <div class="text-secondary text-center" style="padding: 16px;">Loading tasks...</div>
              </div>
            </div>

            <!-- Open Risks -->
            <div class="card">
              <div class="card__header">
                <h2 class="section-title" style="margin-bottom: 0;">
                  <svg width="20" height="20" viewBox="0 0 32 32"><path d="M16 2a14 14 0 1014 14A14 14 0 0016 2zm0 26a12 12 0 1112-12 12 12 0 01-12 12z"/><path d="M15 8h2v11h-2zm1 14a1.5 1.5 0 101.5 1.5A1.5 1.5 0 0016 22z"/></svg>
                  Open Risks
                </h2>
                <span id="openRisksCount" class="tag">- Risks</span>
              </div>
              <div id="openRisksContainer">
                <div class="text-secondary text-center" style="padding: 16px;">Loading risks...</div>
              </div>
            </div>

            <!-- Recent Engagements -->
            <div class="card">
              <div class="card__header">
                <h2 class="section-title" style="margin-bottom: 0;">
                  <svg width="20" height="20" viewBox="0 0 32 32"><path d="M17.74 30L16 29l4-7h6a2 2 0 002-2V8a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2h9v2H6a4 4 0 01-4-4V8a4 4 0 014-4h20a4 4 0 014 4v12a4 4 0 01-4 4h-4.84z"/></svg>
                  Recent Engagements
                </h2>
                <button class="btn btn--ghost">View All</button>
              </div>
              <div id="recentEngagementsContainer" class="timeline">
                <div class="text-secondary text-center" style="padding: 16px;">Loading engagements...</div>
              </div>
            </div>

            <!-- Meeting Notes -->
            <div class="card">
              <div class="card__header">
                <h2 class="section-title" style="margin-bottom: 0;">
                  <svg width="20" height="20" viewBox="0 0 32 32"><path d="M28 4H4a2 2 0 00-2 2v20a2 2 0 002 2h24a2 2 0 002-2V6a2 2 0 00-2-2zM4 26V6h24v20z"/><path d="M6 12h20v2H6zM6 18h20v2H6zM6 24h12v2H6z"/></svg>
                  Meeting Notes
                </h2>
                <button class="btn btn--primary btn--icon" onclick="openMeetingNoteModal()">
                  <svg width="16" height="16" viewBox="0 0 32 32"><path d="M17 15V7h-2v8H7v2h8v8h2v-8h8v-2h-8z"/></svg>
                  Add Note
                </button>
              </div>
              <div id="meetingNotesContainer">
                <div class="text-secondary text-center" style="padding: 16px;">Loading meeting notes...</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Tasks Section (shown when Tasks tab is active) -->
        <div class="card mt-5" id="tasksSection" style="display: none;">
          <div class="card__header">
            <h2 class="section-title" style="margin-bottom: 0;">
              <svg width="20" height="20" viewBox="0 0 32 32"><path d="M14 21.5l-5-4.96L7.59 18 14 24.35 25.41 13 24 11.59 14 21.5z"/><path d="M16 2C8.27 2 2 8.27 2 16s6.27 14 14 14 14-6.27 14-14S23.73 2 16 2zm0 26C9.38 28 4 22.62 4 16S9.38 4 16 4s12 5.38 12 12-5.38 12-12 12z"/></svg>
              Customer Tasks
            </h2>
            <div class="flex gap-3">
              <span class="tag" id="tasksTabCount">0 Tasks</span>
              <button class="btn btn--primary btn--icon" onclick="openTaskModal()">
                <svg width="16" height="16" viewBox="0 0 32 32"><path d="M17 15V7h-2v8H7v2h8v8h2v-8h8v-2h-8z"/></svg>
                Add Task
              </button>
            </div>
          </div>
          <div id="tasksTabContainer" style="padding: 16px;">
            <div class="text-secondary text-center">Loading tasks...</div>
          </div>
        </div>

        <!-- Risks Section (shown when Risks tab is active) -->
        <div class="card mt-5" id="risksSection" style="display: none;">
          <div class="card__header">
            <h2 class="section-title" style="margin-bottom: 0;">
              <svg width="20" height="20" viewBox="0 0 32 32"><path d="M16 2a14 14 0 1014 14A14 14 0 0016 2zm0 26a12 12 0 1112-12 12 12 0 01-12 12z"/><path d="M15 8h2v11h-2zm1 14a1.5 1.5 0 101.5 1.5A1.5 1.5 0 0016 22z"/></svg>
              Customer Risks
            </h2>
            <div class="flex gap-3">
              <span class="tag" id="risksTabCount">0 Risks</span>
              <button class="btn btn--primary btn--icon" onclick="openRiskModal()">
                <svg width="16" height="16" viewBox="0 0 32 32"><path d="M17 15V7h-2v8H7v2h8v8h2v-8h8v-2h-8z"/></svg>
                Add Risk
              </button>
            </div>
          </div>
          <div id="risksTabContainer" style="padding: 16px;">
            <div class="text-secondary text-center">Loading risks...</div>
          </div>
        </div>

        <!-- SPM Assessment Section (shown when SPM Assessment tab is active) -->
        <div class="card mt-5" id="spmAssessmentSection" style="display: none;">
          <div class="card__header">
            <h2 class="section-title" style="margin-bottom: 0;">
              <svg width="20" height="20" viewBox="0 0 32 32"><path d="M16 22a6 6 0 116-6 6 6 0 01-6 6zm0-10a4 4 0 104 4 4 4 0 00-4-4z"/><path d="M28 16a12 12 0 10-12 12 12 12 0 0012-12zM16 26a10 10 0 1110-10 10.011 10.011 0 01-10 10z"/></svg>
              Maturity Assessments
            </h2>
            <div class="flex gap-3">
              <button class="btn btn--secondary" onclick="openUploadAssessmentModal()">
                <svg width="16" height="16" viewBox="0 0 32 32" fill="currentColor"><path d="M6 17l1.41 1.41L15 10.83V30h2V10.83l7.59 7.58L26 17 16 7 6 17z"/><path d="M6 8V4h20v4h2V4a2 2 0 00-2-2H6a2 2 0 00-2 2v4z"/></svg>
                Upload Results
              </button>
              <button class="btn btn--primary" onclick="openNewAssessmentModal()">
                <svg width="16" height="16" viewBox="0 0 32 32" fill="currentColor"><path d="M17 15V7h-2v8H7v2h8v8h2v-8h8v-2h-8z"/></svg>
                New Assessment
              </button>
            </div>
          </div>

          <!-- Assessment Type Tabs -->
          <div class="assessment-type-tabs" id="assessmentTypeTabs">
            <button class="assessment-type-tab active" data-type="spm" onclick="switchAssessmentTypeTab('spm')">
              <span class="assessment-type-tab__indicator" style="background-color: var(--spm-color);"></span>
              <span>SPM</span>
              <span class="assessment-type-tab__score" id="tabSpmScore">-</span>
            </button>
            <button class="assessment-type-tab" data-type="tbm" onclick="switchAssessmentTypeTab('tbm')">
              <span class="assessment-type-tab__indicator" style="background-color: var(--tbm-color);"></span>
              <span>TBM</span>
              <span class="assessment-type-tab__score" id="tabTbmScore">-</span>
            </button>
            <button class="assessment-type-tab" data-type="finops" onclick="switchAssessmentTypeTab('finops')">
              <span class="assessment-type-tab__indicator" style="background-color: var(--finops-color);"></span>
              <span>FinOps</span>
              <span class="assessment-type-tab__score" id="tabFinopsScore">-</span>
            </button>
          </div>

          <!-- No Assessment State -->
          <div id="noAssessmentState" style="text-align: center; padding: 48px 24px;">
            <svg width="64" height="64" viewBox="0 0 32 32" style="color: var(--cds-text-secondary); margin-bottom: 16px;"><path d="M16 22a6 6 0 116-6 6 6 0 01-6 6zm0-10a4 4 0 104 4 4 4 0 00-4-4z"/><path d="M28 16a12 12 0 10-12 12 12 12 0 0012-12zM16 26a10 10 0 1110-10 10.011 10.011 0 01-10 10z"/></svg>
            <h3 style="margin-bottom: 8px; font-size: 16px;">No Assessment Yet</h3>
            <p style="color: var(--cds-text-secondary); margin-bottom: 16px;">Complete an SPM maturity assessment to track this customer's progress.</p>
            <button class="btn btn--primary" onclick="openNewAssessmentModal()">Start Assessment</button>
          </div>

          <!-- Assessment Content (hidden until assessment exists) -->
          <div id="assessmentContent" style="display: none;">
            <div class="grid grid--2" style="gap: 24px;">
              <!-- Left: Radar Chart -->
              <div>
                <div class="assessment-chart-container" id="radarChartContainer" onclick="openRadarChartModal()" style="cursor: pointer;" title="Click to enlarge">
                  <canvas id="spmRadarChart"></canvas>
                </div>
                <!-- Comparison Legend -->
                <div id="comparisonLegend" class="comparison-legend" style="display: none;"></div>
                <!-- Target Overlay Toggle -->
                <div id="targetOverlayToggle" style="display: none; margin: 8px 0; font-size: 12px;">
                  <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; color: var(--cds-text-secondary);">
                    <input type="checkbox" id="showTargetOverlay" checked onchange="toggleTargetOverlay()" style="cursor: pointer;">
                    <span style="display: flex; align-items: center; gap: 6px;">
                      <span style="width: 16px; height: 2px; background: rgba(255, 131, 0, 1); border-top: 2px dashed rgba(255, 131, 0, 1);"></span>
                      Show Target: <span id="activeTargetName">-</span>
                    </span>
                  </label>
                </div>
                <div class="assessment-overall-score" id="overallScoreDisplay">
                  <span class="score-value" id="overallScoreValue">-</span>
                  <span class="score-label">/ 5.0 Overall Maturity</span>
                </div>
              </div>

              <!-- Right: Dimension Scores -->
              <div>
                <h3 style="font-size: 14px; font-weight: 600; margin-bottom: 16px;">Dimension Scores</h3>
                <div id="dimensionScoreCards" class="dimension-scores-grid">
                  <!-- Cards populated by JS -->
                </div>

                <div style="margin-top: 24px;">
                  <h3 style="font-size: 14px; font-weight: 600; margin-bottom: 16px;">Assessment Details</h3>
                  <div class="assessment-details">
                    <div class="flex flex-between mb-2">
                      <span class="text-secondary">Assessment Date</span>
                      <span id="assessmentDate">-</span>
                    </div>
                    <div class="flex flex-between mb-2">
                      <span class="text-secondary">Template Version</span>
                      <span id="assessmentVersion">-</span>
                    </div>
                    <div class="flex flex-between mb-2">
                      <span class="text-secondary">Status</span>
                      <span id="assessmentStatus">-</span>
                    </div>
                    <div class="flex flex-between">
                      <span class="text-secondary">Completed By</span>
                      <span id="assessmentCompletedBy">-</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Trend Comparison (if history exists) -->
            <div id="assessmentTrendSection" style="display: none; margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--cds-border-subtle-01);">
              <h3 style="font-size: 14px; font-weight: 600; margin-bottom: 16px;">Progress vs Previous Assessment</h3>
              <div id="trendIndicators" class="grid grid--5 gap-3">
                <!-- Trend indicators populated by JS -->
              </div>
            </div>

            <!-- Assessment History -->
            <div style="margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--cds-border-subtle-01);">
              <div class="flex flex-between items-center mb-4">
                <h3 style="font-size: 14px; font-weight: 600; margin-bottom: 0;">Assessment History</h3>
                <button class="btn btn--ghost btn--sm" onclick="openEditScoresModal()" id="editScoresBtn" style="display: none;">
                  <svg width="14" height="14" viewBox="0 0 32 32" fill="currentColor"><path d="M2 26h28v2H2zM25.4 9c.8-.8.8-2 0-2.8l-3.6-3.6c-.8-.8-2-.8-2.8 0l-15 15V24h6.4l15-15zm-5-5L24 7.6l-3 3L17.4 7l3-3zM6 22v-3.6l10-10 3.6 3.6-10 10H6z"/></svg>
                  Edit Scores
                </button>
              </div>
              <div class="data-table-container">
                <table class="data-table" id="assessmentHistoryTable">
                  <thead id="assessmentHistoryTableHead">
                    <tr>
                      <th style="width: 50px;">Compare</th>
                      <th>Date</th>
                      <th>Version</th>
                      <th>Overall Score</th>
                      <th>Change</th>
                      <th>Status</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="assessmentHistoryTableBody">
                    <tr>
                      <td colspan="7" class="text-center text-secondary">Loading history...</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Assessment Targets Section -->
            <div id="assessmentTargetsSection" style="margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--cds-border-subtle-01);">
              <div class="flex flex-between items-center mb-4">
                <h3 style="font-size: 14px; font-weight: 600; margin-bottom: 0;">
                  <svg width="16" height="16" viewBox="0 0 32 32" fill="currentColor" style="vertical-align: middle; margin-right: 6px;"><path d="M16 2a14 14 0 1014 14A14.016 14.016 0 0016 2zm0 26a12 12 0 1112-12 12.014 12.014 0 01-12 12z"/><path d="M16 8a8 8 0 108 8 8.009 8.009 0 00-8-8zm0 14a6 6 0 116-6 6.007 6.007 0 01-6 6z"/><circle cx="16" cy="16" r="3"/></svg>
                  Assessment Targets
                </h3>
                <button class="btn btn--primary btn--sm" onclick="openTargetModal()">
                  <svg width="14" height="14" viewBox="0 0 32 32" fill="currentColor"><path d="M17 15V7h-2v8H7v2h8v8h2v-8h8v-2h-8z"/></svg>
                  Set Target
                </button>
              </div>
              <div id="targetsListContainer">
                <div class="text-secondary text-center" style="padding: 24px;">No targets set. Set a target to track progress toward goals.</div>
              </div>
            </div>

            <!-- Audit Trail Section (initially hidden) -->
            <div id="auditTrailSection" style="display: none; margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--cds-border-subtle-01);">
              <div class="flex flex-between items-center mb-4">
                <h3 style="font-size: 14px; font-weight: 600; margin-bottom: 0;">
                  <svg width="16" height="16" viewBox="0 0 32 32" fill="currentColor" style="vertical-align: middle; margin-right: 6px;"><path d="M16 2C8.3 2 2 8.3 2 16s6.3 14 14 14 14-6.3 14-14S23.7 2 16 2zm0 26C9.4 28 4 22.6 4 16S9.4 4 16 4s12 5.4 12 12-5.4 12-12 12z"/><path d="M17 16.59V8h-2v9.41l4.3 4.3 1.4-1.42z"/></svg>
                  Change History
                </h3>
                <button class="btn btn--ghost btn--sm" onclick="hideAuditTrail()">Hide</button>
              </div>
              <div id="auditTrailContainer" class="audit-trail">
                <div class="text-secondary text-center" style="padding: 24px;">Loading audit trail...</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Target Modal -->
        <div class="modal" id="targetModal">
          <div class="modal__overlay" onclick="closeTargetModal()"></div>
          <div class="modal__container" style="max-width: 700px; max-height: 90vh;">
            <div class="modal__header">
              <h2 class="modal__title" id="targetModalTitle">Set Assessment Target</h2>
              <button class="modal__close" onclick="closeTargetModal()">&times;</button>
            </div>
            <div class="modal__body" style="max-height: calc(90vh - 160px); overflow-y: auto;">
              <form id="targetForm">
                <div class="form-group">
                  <label class="form-label" for="targetName">Target Name *</label>
                  <input type="text" id="targetName" class="form-input" placeholder="e.g., Q4 2024 Goals" required>
                </div>
                <div class="form-group">
                  <label class="form-label" for="targetAssessmentType">Assessment Framework</label>
                  <select id="targetAssessmentType" class="form-select" onchange="onTargetAssessmentTypeChange()">
                    <option value="1">SPM</option>
                    <option value="2">TBM</option>
                    <option value="3">FinOps</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label" for="targetDescription">Description</label>
                  <textarea id="targetDescription" class="form-textarea" rows="2" placeholder="Describe this target..."></textarea>
                </div>
                <div class="form-group">
                  <label class="form-label" for="targetDate">Target Date</label>
                  <input type="date" id="targetDate" class="form-input">
                </div>
                <div class="form-group">
                  <label class="form-label">Target Scores by Dimension</label>
                  <p class="form-hint">Set the target score (1-5) for each dimension</p>
                  <div id="targetDimensionScores" class="target-dimension-scores">
                    <div class="text-secondary">Loading dimensions...</div>
                  </div>
                </div>
                <div class="form-group">
                  <label class="form-label">Overall Target</label>
                  <div class="flex items-center gap-3">
                    <input type="number" id="targetOverallScore" class="form-input" style="width: 100px;" min="1" max="5" step="0.1" placeholder="Auto">
                    <span class="text-secondary">Leave empty to auto-calculate from dimension scores</span>
                  </div>
                </div>
              </form>
            </div>
            <div class="modal__footer">
              <button type="button" class="btn btn--secondary" onclick="closeTargetModal()">Cancel</button>
              <button type="button" class="btn btn--primary" onclick="saveTarget()" id="saveTargetBtn">Save Target</button>
            </div>
          </div>
        </div>

        <!-- Edit Scores Modal -->
        <div class="modal" id="editScoresModal">
          <div class="modal__overlay" onclick="closeEditScoresModal()"></div>
          <div class="modal__container" style="max-width: 900px; max-height: 90vh;">
            <div class="modal__header">
              <h2 class="modal__title">Edit Assessment Scores</h2>
              <button class="modal__close" onclick="closeEditScoresModal()">&times;</button>
            </div>
            <div class="modal__body" style="max-height: calc(90vh - 160px); overflow-y: auto;">
              <div class="notification notification--warning mb-4">
                <svg width="20" height="20" viewBox="0 0 32 32" fill="var(--cds-support-warning)"><path d="M16 2C8.3 2 2 8.3 2 16s6.3 14 14 14 14-6.3 14-14S23.7 2 16 2zm-1 7h2v10h-2V9zm1 16c-.8 0-1.5-.7-1.5-1.5S15.2 22 16 22s1.5.7 1.5 1.5S16.8 25 16 25z"/></svg>
                <div>
                  <strong>Editing scores will be tracked in the audit trail.</strong>
                  <p style="margin: 4px 0 0 0; font-size: 13px;">You must provide a reason for any changes.</p>
                </div>
              </div>
              <div id="editScoresContainer">
                <div class="text-secondary text-center" style="padding: 24px;">Loading responses...</div>
              </div>
            </div>
            <div class="modal__footer" style="justify-content: space-between;">
              <button type="button" class="btn btn--ghost" onclick="viewAuditTrail()">
                <svg width="14" height="14" viewBox="0 0 32 32" fill="currentColor"><path d="M16 2C8.3 2 2 8.3 2 16s6.3 14 14 14 14-6.3 14-14S23.7 2 16 2zm0 26C9.4 28 4 22.6 4 16S9.4 4 16 4s12 5.4 12 12-5.4 12-12 12z"/><path d="M17 16.59V8h-2v9.41l4.3 4.3 1.4-1.42z"/></svg>
                View Change History
              </button>
              <div>
                <button type="button" class="btn btn--secondary" onclick="closeEditScoresModal()">Cancel</button>
                <button type="button" class="btn btn--primary" onclick="saveEditedScores()" id="saveEditedScoresBtn">Save Changes</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Edit Reason Modal -->
        <div class="modal" id="editReasonModal">
          <div class="modal__overlay" onclick="closeEditReasonModal()"></div>
          <div class="modal__container" style="max-width: 400px;">
            <div class="modal__header">
              <h2 class="modal__title">Reason for Change</h2>
              <button class="modal__close" onclick="closeEditReasonModal()">&times;</button>
            </div>
            <div class="modal__body">
              <div class="form-group">
                <label class="form-label" for="editChangeReason">Why are you making this change? *</label>
                <textarea id="editChangeReason" class="form-textarea" rows="3" placeholder="e.g., Correcting data entry error, Updated based on new information..." required></textarea>
              </div>
            </div>
            <div class="modal__footer">
              <button type="button" class="btn btn--secondary" onclick="closeEditReasonModal()">Cancel</button>
              <button type="button" class="btn btn--primary" onclick="confirmScoreEdit()">Confirm</button>
            </div>
          </div>
        </div>

        <!-- Radar Chart Modal -->
        <div class="modal" id="radarChartModal">
          <div class="modal__overlay" onclick="closeRadarChartModal()"></div>
          <div class="modal__container" style="max-width: 800px; max-height: 90vh;">
            <div class="modal__header">
              <h2 class="modal__title">SPM Maturity Assessment</h2>
              <button class="modal__close" onclick="closeRadarChartModal()">&times;</button>
            </div>
            <div class="modal__body" style="padding: 24px;">
              <div style="width: 100%; height: 500px; position: relative;">
                <canvas id="spmRadarChartLarge"></canvas>
              </div>
              <div class="modal__footer" style="margin-top: 16px; justify-content: center;">
                <button type="button" class="btn btn--secondary" onclick="copyRadarChartToClipboard()">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 6px;">
                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                  </svg>
                  Copy to Clipboard
                </button>
                <button type="button" class="btn btn--secondary" onclick="downloadRadarChart()">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 6px;">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="7 10 12 15 17 10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                  </svg>
                  Download
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- New Assessment Modal -->
        <div class="modal" id="newAssessmentModal">
          <div class="modal__overlay" onclick="closeNewAssessmentModal()"></div>
          <div class="modal__container" style="max-width: 800px; max-height: 90vh;">
            <div class="modal__header">
              <h2 class="modal__title" id="assessmentModalTitle">Select Assessment Template</h2>
              <button class="modal__close" onclick="closeNewAssessmentModal()">&times;</button>
            </div>
            <div class="modal__body" style="max-height: calc(90vh - 160px); overflow-y: auto;">
              <!-- Template Selection Step -->
              <div id="templateSelectionStep">
                <p class="text-secondary mb-4">Choose an assessment template to begin:</p>
                <div id="templateList" class="template-list">
                  <div class="text-secondary text-center" style="padding: 24px;">Loading templates...</div>
                </div>
              </div>

              <!-- Question Step (hidden initially) -->
              <div id="questionStep" style="display: none;">
                <!-- Progress Indicator -->
                <div class="assessment-wizard-progress">
                  <div class="wizard-progress__bar">
                    <div class="wizard-progress__fill" id="wizardProgressBar" style="width: 0%;"></div>
                  </div>
                  <div class="wizard-progress__text">
                    <span id="currentDimensionName">Loading...</span>
                    <span id="questionProgress">0 / 0</span>
                  </div>
                </div>

                <!-- Question Display -->
                <div class="assessment-question-container">
                  <h3 id="currentQuestionNumber" style="font-size: 12px; color: var(--cds-text-secondary); margin-bottom: 8px;">Question 1</h3>
                  <p id="currentQuestionText" style="font-size: 16px; font-weight: 500; margin-bottom: 24px;">Loading question...</p>

                  <!-- Rating Options -->
                  <div id="ratingOptions" class="rating-scale">
                    <!-- Options populated by JS -->
                  </div>

                  <!-- Notes -->
                  <div class="form-group" style="margin-top: 16px;">
                    <label class="form-label" for="questionNotes">Notes (optional)</label>
                    <textarea id="questionNotes" class="form-textarea" rows="2" placeholder="Add any comments about this rating..."></textarea>
                  </div>
                </div>
              </div>
            </div>
            <div class="modal__footer" style="justify-content: space-between;">
              <button type="button" class="btn btn--secondary" id="saveCloseBtn" onclick="saveAndCloseAssessment()" style="display: none;">
                Save & Close
              </button>
              <div class="flex gap-2">
                <button type="button" class="btn btn--ghost" id="backToTemplatesBtn" onclick="showTemplateSelection()" style="display: none;">
                  <svg width="16" height="16" viewBox="0 0 32 32"><path d="M10 16L20 6l1.4 1.4-8.6 8.6 8.6 8.6L20 26z"/></svg>
                  Back
                </button>
                <button type="button" class="btn btn--ghost" id="prevQuestionBtn" onclick="previousQuestion()" style="display: none;" disabled>
                  <svg width="16" height="16" viewBox="0 0 32 32"><path d="M10 16L20 6l1.4 1.4-8.6 8.6 8.6 8.6L20 26z"/></svg>
                  Previous
                </button>
                <button type="button" class="btn btn--primary" id="nextQuestionBtn" onclick="nextQuestion()" style="display: none;">
                  Next
                  <svg width="16" height="16" viewBox="0 0 32 32"><path d="M22 16L12 26l-1.4-1.4 8.6-8.6-8.6-8.6L12 6z"/></svg>
                </button>
                <button type="button" class="btn btn--primary" id="submitAssessmentBtn" onclick="submitAssessment()" style="display: none;">
                  Complete Assessment
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Upload Assessment Modal -->
        <div class="modal" id="uploadAssessmentModal">
          <div class="modal__overlay" onclick="closeUploadAssessmentModal()"></div>
          <div class="modal__container" style="max-width: 500px;">
            <div class="modal__header">
              <h2 class="modal__title">Upload Assessment Results</h2>
              <button class="modal__close" onclick="closeUploadAssessmentModal()">&times;</button>
            </div>
            <form id="uploadAssessmentForm" onsubmit="handleAssessmentUpload(event)">
              <div class="modal__body">
                <div class="notification notification--info mb-4">
                  <svg width="20" height="20" viewBox="0 0 32 32" fill="var(--cds-support-info)"><path d="M16 2C8.3 2 2 8.3 2 16s6.3 14 14 14 14-6.3 14-14S23.7 2 16 2zm-1 7h2v2h-2V9zm4 14h-6v-2h2v-5h-2v-2h4v7h2v2z"/></svg>
                  <span>Upload an Excel file with completed assessment scores.</span>
                </div>

                <div class="form-group">
                  <label class="form-label" for="assessmentUploadDate">Assessment Date</label>
                  <input type="date" id="assessmentUploadDate" class="form-input">
                </div>

                <div class="form-group">
                  <label class="form-label" for="assessmentUploadFile">Excel File *</label>
                  <input type="file" id="assessmentUploadFile" class="form-input" accept=".xlsx,.xls" required>
                  <span class="form-hint">File should contain Question Number and Score columns.</span>
                </div>
              </div>
              <div class="modal__footer">
                <button type="button" class="btn btn--secondary" onclick="closeUploadAssessmentModal()">Cancel</button>
                <button type="submit" class="btn btn--primary" id="uploadAssessmentBtn">Upload</button>
              </div>
            </form>
          </div>
        </div>

        <!-- Edit Assessment Type Modal -->
        <div class="modal" id="editAssessmentTypeModal">
          <div class="modal__overlay" onclick="closeEditAssessmentTypeModal()"></div>
          <div class="modal__container" style="max-width: 400px;">
            <div class="modal__header">
              <h2 class="modal__title">Change Assessment Type</h2>
              <button class="modal__close" onclick="closeEditAssessmentTypeModal()">&times;</button>
            </div>
            <div class="modal__body">
              <input type="hidden" id="editAssessmentTypeId">
              <div class="form-group">
                <label class="form-label" for="assessmentTypeSelect">Assessment Type</label>
                <select id="assessmentTypeSelect" class="form-select">
                  <option value="">-- Select Type --</option>
                </select>
                <span class="form-hint">Select the assessment type for this assessment.</span>
              </div>
            </div>
            <div class="modal__footer">
              <button type="button" class="btn btn--secondary" onclick="closeEditAssessmentTypeModal()">Cancel</button>
              <button type="button" class="btn btn--primary" onclick="saveAssessmentType()">Save</button>
            </div>
          </div>
        </div>

        <!-- Use Case Status Modal -->
        <div class="modal" id="useCaseStatusModal">
          <div class="modal__overlay" onclick="closeUseCaseStatusModal()"></div>
          <div class="modal__container" style="max-width: 600px;">
            <div class="modal__header">
              <h2 class="modal__title">Update Use Case Status</h2>
              <button class="modal__close" onclick="closeUseCaseStatusModal()">&times;</button>
            </div>
            <div class="modal__body">
              <div style="margin-bottom: 24px;">
                <h3 id="useCaseModalName" style="font-size: 16px; font-weight: 600; margin-bottom: 8px;">Use Case Name</h3>
                <p id="useCaseModalDescription" class="text-secondary" style="font-size: 14px; line-height: 1.5;">Description</p>
              </div>

              <div class="form-group">
                <label class="form-label">Status</label>
                <div class="use-case-status-options">
                  <div class="status-option" data-status="not_started" onclick="selectUseCaseStatus('not_started')">
                    <div class="status-option__icon status-option__icon--not-started"></div>
                    <div>
                      <div class="status-option__label">Not Started</div>
                      <div class="status-option__description">Use case has not been implemented</div>
                    </div>
                  </div>
                  <div class="status-option" data-status="in_progress" onclick="selectUseCaseStatus('in_progress')">
                    <div class="status-option__icon status-option__icon--in-progress"></div>
                    <div>
                      <div class="status-option__label">In Progress</div>
                      <div class="status-option__description">Currently being implemented</div>
                    </div>
                  </div>
                  <div class="status-option" data-status="implemented" onclick="selectUseCaseStatus('implemented')">
                    <div class="status-option__icon status-option__icon--implemented">
                      <svg width="12" height="12" viewBox="0 0 32 32" fill="currentColor"><path d="M13 24l-9-9 1.41-1.41L13 21.17 26.59 7.58 28 9 13 24z"/></svg>
                    </div>
                    <div>
                      <div class="status-option__label">Implemented</div>
                      <div class="status-option__description">Use case is live and in use</div>
                    </div>
                  </div>
                  <div class="status-option" data-status="optimized" onclick="selectUseCaseStatus('optimized')">
                    <div class="status-option__icon status-option__icon--optimized">
                      <svg width="12" height="12" viewBox="0 0 32 32" fill="currentColor"><path d="M30 10.68l-2-1.15L22 4H10L4 9.53l-2 1.15 14 8.09zm-5.18-.68L16 13.35 7.18 10 10.89 6h10.22zM2 14.43L16 22.54l14-8.11v1.14L16 23.68 2 15.57zM2 18.43L16 26.54l14-8.11v1.14L16 27.68 2 19.57z"/></svg>
                    </div>
                    <div>
                      <div class="status-option__label">Optimized</div>
                      <div class="status-option__description">Fully optimized and delivering value</div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label class="form-label" for="useCaseNotes">Notes</label>
                <textarea id="useCaseNotes" class="form-textarea" rows="3" placeholder="Add notes about this use case implementation..."></textarea>
              </div>

              <!-- Adoption History Chart -->
              <div style="margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--cds-border-subtle-01);">
                <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 16px;">Adoption Trend</h4>
                <div class="use-case-history-chart">
                  <canvas id="useCaseHistoryChart"></canvas>
                </div>
              </div>
            </div>
            <div class="modal__footer">
              <button type="button" class="btn btn--secondary" onclick="closeUseCaseStatusModal()">Cancel</button>
              <button type="button" class="btn btn--primary" id="saveUseCaseStatusBtn" onclick="saveUseCaseStatus()">Save Status</button>
            </div>
          </div>
        </div>

        <!-- Product Roadmap Section -->
        <div class="card mt-5" id="roadmapSection">
          <div class="card__header">
            <h2 class="section-title" style="margin-bottom: 0;">
              <svg width="20" height="20" viewBox="0 0 32 32"><path d="M28 4H4a2 2 0 00-2 2v20a2 2 0 002 2h24a2 2 0 002-2V6a2 2 0 00-2-2zM4 26V6h24v20z"/><path d="M6 12h4v2H6zm0 5h4v2H6zm0 5h4v2H6zm6-10h14v2H12zm0 5h14v2H12zm0 5h14v2H12z"/></svg>
              Product Roadmap
            </h2>
            <div class="flex gap-3">
              <span class="tag" id="roadmapTimeframe" style="display: none;">-</span>
              <button class="btn btn--ghost btn--icon" id="addRoadmapItemBtn" title="Add Item" onclick="openRoadmapItemModal()" style="display: none;">
                <svg width="16" height="16" viewBox="0 0 32 32"><path d="M17 15V7h-2v8H7v2h8v8h2v-8h8v-2h-8z"/></svg>
              </button>
              <button class="btn btn--ghost btn--icon" id="pushToTPBtn" title="Push to TargetProcess" onclick="openPushToTPModal()" style="display: none;">
                <svg width="16" height="16" viewBox="0 0 32 32"><path d="M12 10H6v2h6v6h2v-6h6v-2h-6V4h-2v6z"/><path d="M28 18v8H4V6h10V4H4a2 2 0 00-2 2v20a2 2 0 002 2h24a2 2 0 002-2v-8z"/></svg>
              </button>
              <button class="btn btn--ghost btn--icon" id="roadmapSettingsBtn" title="Roadmap Settings" onclick="openCreateRoadmapModal()">
                <svg width="16" height="16" viewBox="0 0 32 32"><path d="M27 16.76V16v-.77l1.92-1.68a2 2 0 00.4-2.4l-2-3.46a2 2 0 00-1.94-1 2 2 0 00-.64.1l-2.43.82a11.35 11.35 0 00-1.31-.75l-.51-2.52a2 2 0 00-2-1.61h-4a2 2 0 00-2 1.61l-.51 2.52a11.48 11.48 0 00-1.32.75l-2.38-.86a2 2 0 00-.68-.09 2 2 0 00-1.72 1l-2 3.46a2 2 0 00.4 2.4l1.92 1.68V16v.77l-1.92 1.68a2 2 0 00-.4 2.4l2 3.46a2 2 0 00 1.72 1 2 2 0 00.68-.09l2.42-.82a11.35 11.35 0 001.31.75l.51 2.52a2 2 0 002 1.61h4a2 2 0 002-1.61l.51-2.52a11.48 11.48 0 001.32-.75l2.42.82a2 2 0 00.64.09 2 2 0 001.72-1l2-3.46a2 2 0 00-.4-2.4zM16 22a6 6 0 116-6 6 6 0 01-6 6z"/></svg>
              </button>
            </div>
          </div>

          <!-- No Roadmap State -->
          <div id="noRoadmapState" style="display: none; text-align: center; padding: 48px 24px;">
            <svg width="48" height="48" viewBox="0 0 32 32" style="color: var(--cds-text-secondary); margin-bottom: 16px;"><path d="M28 4H4a2 2 0 00-2 2v20a2 2 0 002 2h24a2 2 0 002-2V6a2 2 0 00-2-2zM4 26V6h24v20z"/></svg>
            <h3 style="margin-bottom: 8px; font-size: 16px;">No Roadmap Created</h3>
            <p style="color: var(--cds-text-secondary); margin-bottom: 16px;">Create a product roadmap to track planned features and milestones.</p>
            <button class="btn btn--primary" onclick="openCreateRoadmapModal()">Create Roadmap</button>
          </div>

          <!-- Roadmap Content -->
          <div id="roadmapContent" style="display: none;">
            <!-- Zoom Controls -->
            <div style="display: flex; align-items: center; justify-content: space-between; padding: 8px 0 16px 0; border-bottom: 1px solid var(--cds-border-subtle-01); margin-bottom: 16px;">
              <div style="display: flex; align-items: center; gap: 8px;">
                <span style="font-size: 12px; color: var(--cds-text-secondary);">Timeline:</span>
                <button class="btn btn--ghost btn--sm" onclick="navigateRoadmapTime(-1)" title="Previous quarters" id="roadmapPrevBtn">
                  <svg width="16" height="16" viewBox="0 0 32 32"><path d="M10 16L20 6l1.4 1.4-8.6 8.6 8.6 8.6L20 26z"/></svg>
                </button>
                <span id="roadmapTimeRange" style="font-size: 13px; font-weight: 500; min-width: 140px; text-align: center;">Q1 2026 - Q4 2027</span>
                <button class="btn btn--ghost btn--sm" onclick="navigateRoadmapTime(1)" title="Next quarters" id="roadmapNextBtn">
                  <svg width="16" height="16" viewBox="0 0 32 32"><path d="M22 16L12 26l-1.4-1.4 8.6-8.6-8.6-8.6L12 6z"/></svg>
                </button>
              </div>
              <div style="display: flex; align-items: center; gap: 8px;">
                <span style="font-size: 12px; color: var(--cds-text-secondary);">Zoom:</span>
                <button class="btn btn--ghost btn--sm" onclick="zoomRoadmap(1)" title="Zoom in (fewer quarters)">
                  <svg width="16" height="16" viewBox="0 0 32 32"><path d="M19 13h-4V9h-2v4H9v2h4v4h2v-4h4v-2z"/><path d="M22.45 21A10.87 10.87 0 0025 14 11 11 0 1014 25a10.87 10.87 0 007-2.55L28.59 30 30 28.59zM14 23a9 9 0 119-9 9 9 0 01-9 9z"/></svg>
                </button>
                <span id="roadmapZoomLevel" style="font-size: 13px; font-weight: 500; min-width: 80px; text-align: center;">8 quarters</span>
                <button class="btn btn--ghost btn--sm" onclick="zoomRoadmap(-1)" title="Zoom out (more quarters)">
                  <svg width="16" height="16" viewBox="0 0 32 32"><path d="M9 13h10v2H9z"/><path d="M22.45 21A10.87 10.87 0 0025 14 11 11 0 1014 25a10.87 10.87 0 007-2.55L28.59 30 30 28.59zM14 23a9 9 0 119-9 9 9 0 01-9 9z"/></svg>
                </button>
                <button class="btn btn--ghost btn--sm" onclick="setCurrentZoomAsDefault()" title="Set current zoom as default view" style="margin-left: 8px; padding: 4px 8px;">
                  <svg width="14" height="14" viewBox="0 0 32 32" style="margin-right: 4px;"><path d="M28.7 9.3l-5-5a1 1 0 00-.7-.3H8a2 2 0 00-2 2v20a2 2 0 002 2h16a2 2 0 002-2V10a1 1 0 00-.3-.7zM22 8.6l3.4 3.4H22zM8 26V6h12v6a2 2 0 002 2h4v12z"/><path d="M11 19h10v2H11zM11 15h10v2H11z"/></svg>
                  <span style="font-size: 11px;">Set Default</span>
                </button>
                <button id="roadmapUndoBtn" class="btn btn--ghost btn--sm" onclick="undoLastRoadmapAction()" title="Nothing to undo" style="margin-left: 8px; padding: 4px 8px; opacity: 0.5;" disabled>
                  <svg width="14" height="14" viewBox="0 0 32 32" style="margin-right: 4px;"><path d="M20 10H7.8l3.6-3.6L10 5l-6 6 6 6 1.4-1.4L7.8 12H20c3.3 0 6 2.7 6 6s-2.7 6-6 6h-8v2h8c4.4 0 8-3.6 8-8s-3.6-8-8-8z"/></svg>
                  <span style="font-size: 11px;">Undo</span>
                </button>
              </div>
            </div>
            <!-- Roadmap Timeline -->
            <div style="overflow-x: auto; overflow-y: visible; padding: 0 50px 0 0;">
              <div style="min-width: 900px; position: relative;">
                <!-- Quarter Headers -->
                <div id="quarterHeaders" style="display: grid; grid-template-columns: 150px repeat(8, 1fr); gap: 4px; margin-bottom: 16px;">
                  <div style="font-weight: 600; font-size: 12px; color: var(--cds-text-secondary);">Category</div>
                </div>

                <!-- Roadmap Items Container -->
                <div id="roadmapItemsContainer" style="position: relative; overflow: visible;"></div>

                <!-- Dependency Action Popover -->
                <div id="dependencyPopover" class="dependency-popover" style="display: none;">
                  <div class="dependency-popover__header">
                    <span class="dependency-popover__title">Dependency</span>
                    <button class="dependency-popover__close" onclick="closeDependencyPopover()" title="Close (Esc)">&times;</button>
                  </div>
                  <div class="dependency-popover__body">
                    <div class="dependency-popover__items">
                      <div class="dependency-popover__from">
                        <span class="dependency-popover__label">Item</span>
                        <span class="dependency-popover__item-name" id="dependencyFromName">-</span>
                      </div>
                      <div class="dependency-popover__arrow">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <path d="M5 12h14M12 5l7 7-7 7"/>
                        </svg>
                      </div>
                      <div class="dependency-popover__to">
                        <span class="dependency-popover__label">Depends On</span>
                        <span class="dependency-popover__item-name" id="dependencyToName">-</span>
                      </div>
                    </div>
                  </div>
                  <div class="dependency-popover__footer">
                    <button class="btn btn--danger btn--sm" onclick="deleteSelectedDependency()" id="deleteDependencyBtn">
                      <svg width="14" height="14" viewBox="0 0 32 32" fill="currentColor" style="margin-right: 4px;">
                        <path d="M12 12h2v12h-2zm6 0h2v12h-2z"/>
                        <path d="M4 6v2h2v20a2 2 0 002 2h16a2 2 0 002-2V8h2V6zm4 22V8h16v20zm4-26h8v2h-8z"/>
                      </svg>
                      Delete Dependency
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Legend -->
            <div style="display: flex; gap: 24px; padding-top: 16px; border-top: 1px solid var(--cds-border-subtle-01); flex-wrap: wrap;">
              <div style="display: flex; align-items: center; gap: 8px; font-size: 12px;">
                <div style="width: 12px; height: 12px; background: var(--cds-interactive); border-radius: 2px;"></div>
                <span>In Progress</span>
              </div>
              <div style="display: flex; align-items: center; gap: 8px; font-size: 12px;">
                <div style="width: 12px; height: 12px; background: #8a3ffc; border-radius: 2px;"></div>
                <span>Planned</span>
              </div>
              <div style="display: flex; align-items: center; gap: 8px; font-size: 12px;">
                <div style="width: 12px; height: 12px; background: var(--cds-support-success); border-radius: 2px;"></div>
                <span>Completed</span>
              </div>
              <div style="display: flex; align-items: center; gap: 8px; font-size: 12px;">
                <div style="width: 12px; height: 12px; background: var(--cds-support-warning); border-radius: 2px;"></div>
                <span>Delayed</span>
              </div>
              <div style="display: flex; align-items: center; gap: 8px; font-size: 12px;">
                <div style="width: 12px; height: 12px; background: var(--cds-support-error); border-radius: 2px;"></div>
                <span>Cancelled</span>
              </div>
            </div>

            <!-- Last Updated -->
            <div id="roadmapLastUpdated" style="margin-top: 16px; font-size: 12px; color: var(--cds-text-secondary);"></div>
          </div>
        </div>

        <!-- Engagements Section (shown when Engagements tab is active) -->
        <div class="card mt-5" id="engagementsSection" style="display: none;">
          <div class="card__header">
            <h2 class="section-title" style="margin-bottom: 0;">
              <svg width="20" height="20" viewBox="0 0 32 32"><path d="M17.74 30L16 29l4-7h6a2 2 0 002-2V8a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2h9v2H6a4 4 0 01-4-4V8a4 4 0 014-4h20a4 4 0 014 4v12a4 4 0 01-4 4h-4.84z"/></svg>
              Customer Engagements
            </h2>
            <div class="flex gap-3">
              <select id="engagementFilter" class="form-select" style="min-width: 120px;" onchange="filterEngagements()">
                <option value="all">All Types</option>
                <option value="meeting">Meetings</option>
                <option value="call">Calls</option>
                <option value="email">Emails</option>
                <option value="qbr">QBRs</option>
                <option value="training">Training</option>
                <option value="support">Support</option>
              </select>
              <button class="btn btn--primary btn--icon" onclick="openEngagementModal()">
                <svg width="16" height="16" viewBox="0 0 32 32"><path d="M17 15V7h-2v8H7v2h8v8h2v-8h8v-2h-8z"/></svg>
                Log Engagement
              </button>
            </div>
          </div>
          <!-- Engagement Drop Zone -->
          <div class="drop-zone" id="engagementDropZone" data-drop-type="engagement">
            <div class="drop-zone__icon">
              <svg width="32" height="32" viewBox="0 0 32 32"><path d="M17.74 30L16 29l4-7h6a2 2 0 002-2V8a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2h9v2H6a4 4 0 01-4-4V8a4 4 0 014-4h20a4 4 0 014 4v12a4 4 0 01-4 4h-4.84z"/></svg>
            </div>
            <div class="drop-zone__content">
              <strong>Drop Outlook emails or calendar events here</strong>
              <span>Or <button type="button" class="btn-link" onclick="document.getElementById('engagementFileInput').click()">browse files</button> (.eml, .ics)</span>
            </div>
            <input type="file" id="engagementFileInput" accept=".eml,.ics,.ical" style="display:none" onchange="handleEngagementFileSelect(event)">
            <div class="drop-zone__hint" id="engagementDropHint"></div>
          </div>

          <div id="engagementsTabContainer" style="padding: 16px;">
            <div class="text-secondary text-center">Loading engagements...</div>
          </div>
        </div>

        <!-- TargetProcess Section (shown when TargetProcess tab is active) -->
        <div class="card mt-5" id="targetprocessSection" style="display: none;">
          <div class="card__header">
            <h2 class="section-title" style="margin-bottom: 0;">
              <svg width="20" height="20" viewBox="0 0 32 32"><path d="M28 4H4a2 2 0 00-2 2v20a2 2 0 002 2h24a2 2 0 002-2V6a2 2 0 00-2-2zM4 26V6h24v20z"/><path d="M6 12h4v2H6zm0 5h4v2H6zm0 5h4v2H6zm6-10h14v2H12zm0 5h14v2H12zm0 5h14v2H12z"/></svg>
              TargetProcess Integration
            </h2>
            <div class="flex gap-3">
              <button class="btn btn--ghost" onclick="refreshTPData()">
                <svg width="16" height="16" viewBox="0 0 32 32"><path d="M12 10H6.78A11 11 0 0127 16h2A13 13 0 006 7.68V4H4v8h8zm8 12h5.22A11 11 0 015 16H3a13 13 0 0023 8.32V28h2v-8h-8z"/></svg>
                Refresh
              </button>
            </div>
          </div>
          <div id="tpTabContainer" style="padding: 16px;">
            <!-- TP Stats Row -->
            <div class="grid grid--4 mb-5" id="tpStatsRow">
              <div class="metric-card">
                <div class="metric-card__label">User Stories</div>
                <div class="metric-card__value" id="tpUserStories">-</div>
              </div>
              <div class="metric-card">
                <div class="metric-card__label">Features</div>
                <div class="metric-card__value" id="tpFeatures">-</div>
              </div>
              <div class="metric-card">
                <div class="metric-card__label">Bugs</div>
                <div class="metric-card__value" id="tpBugs">-</div>
              </div>
              <div class="metric-card">
                <div class="metric-card__label">In Progress</div>
                <div class="metric-card__value" id="tpInProgress">-</div>
              </div>
            </div>
            <!-- TP Items List -->
            <div id="tpItemsList">
              <div class="text-secondary text-center" style="padding: 24px;">Loading TargetProcess data...</div>
            </div>
          </div>
        </div>

        <!-- Documents Section (shown when Documents tab is active) -->
        <div class="card mt-5" id="documentsSection" style="display: none;">
          <div class="card__header">
            <h2 class="section-title" style="margin-bottom: 0;">
              <svg width="20" height="20" viewBox="0 0 32 32"><path d="M25.7 9.3l-7-7A.91.91 0 0018 2H8a2 2 0 00-2 2v24a2 2 0 002 2h16a2 2 0 002-2V10a.91.91 0 00-.3-.7zM18 4.4l5.6 5.6H18zM24 28H8V4h8v6a2 2 0 002 2h6z"/><path d="M10 22h12v2H10zm0-6h12v2H10z"/></svg>
              Customer Documents
            </h2>
            <div class="flex gap-3">
              <select id="documentFilter" class="form-select" style="min-width: 120px;" onchange="filterDocuments()">
                <option value="all">All Types</option>
                <option value="contract">Contracts</option>
                <option value="sow">SOWs</option>
                <option value="presentation">Presentations</option>
                <option value="report">Reports</option>
                <option value="other">Other</option>
              </select>
              <button class="btn btn--primary btn--icon" onclick="openDocumentModal()">
                <svg width="16" height="16" viewBox="0 0 32 32"><path d="M17 15V7h-2v8H7v2h8v8h2v-8h8v-2h-8z"/></svg>
                Upload Document
              </button>
            </div>
          </div>
          <!-- Document Drop Zone -->
          <div class="drop-zone" id="documentDropZone" data-drop-type="document">
            <div class="drop-zone__icon">
              <svg width="32" height="32" viewBox="0 0 32 32"><path d="M25.7 9.3l-7-7A.91.91 0 0018 2H8a2 2 0 00-2 2v24a2 2 0 002 2h16a2 2 0 002-2V10a.91.91 0 00-.3-.7zM18 4.4l5.6 5.6H18zM24 28H8V4h8v6a2 2 0 002 2h6z"/><path d="M10 22h12v2H10zm0-6h12v2H10z"/></svg>
            </div>
            <div class="drop-zone__content">
              <strong>Drop files to attach</strong>
              <span>Or <button type="button" class="btn-link" onclick="document.getElementById('documentFileInput').click()">browse files</button></span>
            </div>
            <input type="file" id="documentFileInput" multiple style="display:none" onchange="handleDocumentFileSelect(event)">
            <div class="drop-zone__hint" id="documentDropHint"></div>
          </div>

          <div id="documentsTabContainer" style="padding: 16px;">
            <div class="text-secondary text-center">Loading documents...</div>
          </div>
        </div>

        <!-- Recommendations Section (shown when Recommendations tab is active) -->
        <div class="card mt-5" id="recommendationsSection" style="display: none;">
          <div class="card__header">
            <h2 class="section-title" style="margin-bottom: 0;">
              <svg width="20" height="20" viewBox="0 0 32 32"><path d="M16 2l4 8 8 1.5-6 5.5 1.5 8.5-7.5-4-7.5 4 1.5-8.5-6-5.5L12 10l4-8z"/></svg>
              Recommendations
            </h2>
            <div class="flex gap-3">
              <button class="btn btn--secondary" id="generateRecsBtn" onclick="generateRecommendations()" style="display: none;">
                <svg width="16" height="16" viewBox="0 0 32 32" fill="currentColor"><path d="M16 4l-2 6-6 2 6 2 2 6 2-6 6-2-6-2-2-6z"/><path d="M6 14l-1.5 4.5L0 20l4.5 1.5L6 26l1.5-4.5L12 20l-4.5-1.5L6 14z"/><path d="M26 6l-1 3-3 1 3 1 1 3 1-3 3-1-3-1-1-3z"/></svg>
                Generate Recommendations
              </button>
              <button class="btn btn--primary" id="addCustomRecBtn" onclick="openCustomRecommendationModal()">
                <svg width="16" height="16" viewBox="0 0 32 32" fill="currentColor"><path d="M17 15V7h-2v8H7v2h8v8h2v-8h8v-2h-8z"/></svg>
                Add Recommendation
              </button>
            </div>
          </div>

          <!-- Recommendation Type Tabs -->
          <div class="rec-type-tabs" style="display: flex; gap: 0; border-bottom: 1px solid var(--cds-border-subtle-01); padding: 0 16px;">
            <button class="rec-type-tab active" data-rec-type="all" onclick="switchRecTypeTab('all')" style="padding: 12px 20px; border: none; background: none; cursor: pointer; font-weight: 500; border-bottom: 2px solid var(--cds-interactive);">
              All
              <span class="rec-count-badge" id="allRecCount" style="background: var(--cds-interactive); color: white; padding: 2px 8px; border-radius: 10px; font-size: 11px; margin-left: 8px;">0</span>
            </button>
            <button class="rec-type-tab" data-rec-type="custom" onclick="switchRecTypeTab('custom')" style="padding: 12px 20px; border: none; background: none; cursor: pointer; color: var(--cds-text-secondary); border-bottom: 2px solid transparent;">
              Custom
              <span class="rec-count-badge" id="customRecCount" style="background: var(--cds-layer-02); padding: 2px 8px; border-radius: 10px; font-size: 11px; margin-left: 8px;">0</span>
            </button>
            <button class="rec-type-tab" data-rec-type="generated" onclick="switchRecTypeTab('generated')" style="padding: 12px 20px; border: none; background: none; cursor: pointer; color: var(--cds-text-secondary); border-bottom: 2px solid transparent;">
              AI Generated
              <span class="rec-count-badge" id="generatedRecCount" style="background: var(--cds-layer-02); padding: 2px 8px; border-radius: 10px; font-size: 11px; margin-left: 8px;">0</span>
            </button>
          </div>

          <!-- Filter by Assessment Type -->
          <div style="padding: 16px; border-bottom: 1px solid var(--cds-border-subtle-01);">
            <div class="flex gap-3 items-center flex-wrap">
              <label style="font-size: 13px; font-weight: 500;">Framework:</label>
              <select id="recAssessmentTypeFilter" class="form-select" style="width: auto; min-width: 130px;" onchange="filterRecommendations()">
                <option value="">All</option>
                <option value="1">SPM</option>
                <option value="2">TBM</option>
                <option value="3">FinOps</option>
              </select>
              <label style="font-size: 13px; font-weight: 500; margin-left: 12px;">Status:</label>
              <select id="recStatusFilter" class="form-select" style="width: auto; min-width: 120px;" onchange="filterRecommendations()">
                <option value="">All</option>
                <option value="open">Open</option>
                <option value="in_progress">In Progress</option>
                <option value="completed">Completed</option>
                <option value="dismissed">Dismissed</option>
              </select>
              <label style="font-size: 13px; font-weight: 500; margin-left: 12px;">Tool:</label>
              <select id="recToolFilter" class="form-select" style="width: auto; min-width: 140px;" onchange="filterRecommendations()">
                <option value="">All Tools</option>
                <option value="Targetprocess">Targetprocess</option>
                <option value="Costing">Costing</option>
                <option value="Planning">Planning</option>
                <option value="Cloudability">Cloudability</option>
              </select>
              <button class="btn btn--ghost btn--sm" onclick="clearRecFilters()" style="margin-left: 8px;" title="Clear filters">
                <svg width="14" height="14" viewBox="0 0 32 32" fill="currentColor"><path d="M24 9.4L22.6 8 16 14.6 9.4 8 8 9.4 14.6 16 8 22.6 9.4 24 16 17.4 22.6 24 24 22.6 17.4 16 24 9.4z"/></svg>
                Clear
              </button>

              <!-- View Toggle -->
              <div class="rec-view-toggle" style="margin-left: auto;">
                <button class="view-toggle-btn active" id="recViewCards" onclick="switchRecView('cards')" title="Card View">
                  <svg width="16" height="16" viewBox="0 0 32 32" fill="currentColor"><path d="M26 6v4H6V6h20m0-2H6a2 2 0 00-2 2v4a2 2 0 002 2h20a2 2 0 002-2V6a2 2 0 00-2-2zM26 16v4H6v-4h20m0-2H6a2 2 0 00-2 2v4a2 2 0 002 2h20a2 2 0 002-2v-4a2 2 0 00-2-2zM26 26v-4H6v4h20m0-6H6a2 2 0 00-2 2v4a2 2 0 002 2h20a2 2 0 002-2v-4a2 2 0 00-2-2z"/></svg>
                  Cards
                </button>
                <button class="view-toggle-btn" id="recViewTable" onclick="switchRecView('table')" title="Table View">
                  <svg width="16" height="16" viewBox="0 0 32 32" fill="currentColor"><path d="M12 4H6a2 2 0 00-2 2v6a2 2 0 002 2h6a2 2 0 002-2V6a2 2 0 00-2-2zm0 8H6V6h6zm14-8h-6a2 2 0 00-2 2v6a2 2 0 002 2h6a2 2 0 002-2V6a2 2 0 00-2-2zm0 8h-6V6h6zM12 18H6a2 2 0 00-2 2v6a2 2 0 002 2h6a2 2 0 002-2v-6a2 2 0 00-2-2zm0 8H6v-6h6zm14-8h-6a2 2 0 00-2 2v6a2 2 0 002 2h6a2 2 0 002-2v-6a2 2 0 00-2-2zm0 8h-6v-6h6z"/></svg>
                  Table
                </button>
              </div>
            </div>
          </div>

          <!-- All Recommendations Panel (shown by default) -->
          <div id="allRecommendationsPanel" style="padding: 16px;">
            <div id="noAllRecsState" style="text-align: center; padding: 32px;">
              <svg width="48" height="48" viewBox="0 0 32 32" style="color: var(--cds-text-secondary); margin-bottom: 12px;"><path d="M16 2l4 8 8 1.5-6 5.5 1.5 8.5-7.5-4-7.5 4 1.5-8.5-6-5.5L12 10l4-8z"/></svg>
              <h3 style="margin-bottom: 8px; font-size: 15px;">No Recommendations</h3>
              <p style="color: var(--cds-text-secondary); margin-bottom: 16px; font-size: 13px;">Add custom recommendations or generate AI recommendations from assessments.</p>
              <div style="display: flex; gap: 12px; justify-content: center;">
                <button class="btn btn--primary btn--sm" onclick="openCustomRecommendationModal()">Add Custom</button>
                <button class="btn btn--secondary btn--sm" onclick="switchRecTypeTab('generated'); generateRecommendations();">Generate AI Recommendations</button>
              </div>
            </div>
            <div id="allRecsList">
              <!-- All recommendations populated by JS (Card View) -->
            </div>

            <!-- Table View Container (hidden by default) -->
            <div id="allRecsTableView" style="display: none;">
              <!-- Import/Export Toolbar -->
              <div class="rec-import-export-toolbar">
                <div class="rec-import-export-toolbar__left">
                  <span class="rec-import-export-toolbar__label">Data:</span>
                  <button class="btn btn--ghost btn--sm" onclick="exportRecsToExcel()">
                    <svg width="14" height="14" viewBox="0 0 32 32" fill="currentColor"><path d="M26 24v4H6v-4H4v4a2 2 0 002 2h20a2 2 0 002-2v-4zM26 14l-1.41-1.41L17 20.17V2h-2v18.17l-7.59-7.58L6 14l10 10 10-10z"/></svg>
                    Export Excel
                  </button>
                  <button class="btn btn--ghost btn--sm" onclick="document.getElementById('recImportFile').click()">
                    <svg width="14" height="14" viewBox="0 0 32 32" fill="currentColor"><path d="M26 24v4H6v-4H4v4a2 2 0 002 2h20a2 2 0 002-2v-4zM6 12l1.41 1.41L15 5.83V24h2V5.83l7.59 7.58L26 12 16 2 6 12z"/></svg>
                    Import Excel
                  </button>
                  <input type="file" id="recImportFile" accept=".xlsx,.xls,.csv" style="display: none;" onchange="handleRecImportFile(event)">
                </div>
                <div class="rec-import-export-toolbar__right">
                  <a href="#" onclick="downloadRecTemplate(event)" class="rec-template-link">
                    <svg width="12" height="12" viewBox="0 0 32 32" fill="currentColor"><path d="M26 24v4H6v-4H4v4a2 2 0 002 2h20a2 2 0 002-2v-4zM26 14l-1.41-1.41L17 20.17V2h-2v18.17l-7.59-7.58L6 14l10 10 10-10z"/></svg>
                    Download Template
                  </a>
                </div>
              </div>

              <!-- Bulk Action Bar -->
              <div id="recBulkActionBar" class="bulk-action-bar" style="display: none;">
                <div class="bulk-action-bar__info">
                  <span id="recSelectedCount">0</span> selected
                </div>
                <div class="bulk-action-bar__actions">
                  <button class="btn btn--ghost btn--sm" onclick="openBulkEditStatusModal()">
                    <svg width="14" height="14" viewBox="0 0 32 32" fill="currentColor"><path d="M16 4c6.6 0 12 5.4 12 12s-5.4 12-12 12S4 22.6 4 16 9.4 4 16 4m0-2C8.3 2 2 8.3 2 16s6.3 14 14 14 14-6.3 14-14S23.7 2 16 2z"/><path d="M14 10h4v8h-4z"/><path d="M14 22h4v2h-4z"/></svg>
                    Edit Status
                  </button>
                  <button class="btn btn--ghost btn--sm" onclick="openBulkEditPriorityModal()">
                    <svg width="14" height="14" viewBox="0 0 32 32" fill="currentColor"><path d="M4 4v24h2V4H4zm8 10v14h2V14h-2zm8 4v10h2V18h-2zm8-4v14h2V14h-2z"/></svg>
                    Edit Priority
                  </button>
                  <button class="btn btn--ghost btn--sm" onclick="openBulkEditToolsModal()">
                    <svg width="14" height="14" viewBox="0 0 32 32" fill="currentColor"><path d="M27 16.76v-1.53l1.92-1.68a2 2 0 00.46-2.32l-1.99-3.4a2 2 0 00-2.17-1l-2.54.51a11 11 0 00-1.32-.77l-.52-2.54a2 2 0 00-1.95-1.59h-3.95a2 2 0 00-1.95 1.59l-.52 2.54a11 11 0 00-1.32.77l-2.54-.51a2 2 0 00-2.17 1l-1.99 3.4a2 2 0 00.46 2.32L5 15.23v1.53l-1.92 1.68a2 2 0 00-.46 2.32l1.99 3.4a2 2 0 002.17 1l2.54-.51a11 11 0 001.32.77l.52 2.54a2 2 0 001.95 1.59h3.95a2 2 0 001.95-1.59l.52-2.54a11 11 0 001.32-.77l2.54.51a2 2 0 002.17-1l1.99-3.4a2 2 0 00-.46-2.32zM16 22a6 6 0 110-12 6 6 0 010 12z"/></svg>
                    Edit Tools
                  </button>
                  <button class="btn btn--primary btn--sm" onclick="openBulkSendToRoadmapModal()">
                    <svg width="14" height="14" viewBox="0 0 32 32" fill="currentColor"><path d="M17 15V7h-2v8H7v2h8v8h2v-8h8v-2h-8z"/></svg>
                    Add to Roadmap
                  </button>
                  <button class="btn btn--ghost btn--sm" onclick="bulkDismissRecommendations()" style="color: var(--cds-support-error);">
                    <svg width="14" height="14" viewBox="0 0 32 32" fill="currentColor"><path d="M24 9.4L22.6 8 16 14.6 9.4 8 8 9.4 14.6 16 8 22.6 9.4 24 16 17.4 22.6 24 24 22.6 17.4 16 24 9.4z"/></svg>
                    Dismiss
                  </button>
                  <button class="btn btn--ghost btn--sm" onclick="bulkDeleteRecommendations()" style="color: var(--cds-support-error);">
                    <svg width="14" height="14" viewBox="0 0 32 32" fill="currentColor"><path d="M12 12h2v12h-2zM18 12h2v12h-2z"/><path d="M4 6v2h2v20a2 2 0 002 2h16a2 2 0 002-2V8h2V6zm4 22V8h16v20zm4-26h8v2h-8z"/></svg>
                    Delete
                  </button>
                </div>
              </div>

              <!-- Data Table -->
              <div class="rec-table-wrapper">
                <table class="rec-data-table" id="recDataTable">
                  <thead>
                    <!-- Sortable Header Row -->
                    <tr class="rec-table-header-row">
                      <th style="width: 40px;">
                        <label class="rec-table-checkbox">
                          <input type="checkbox" id="recSelectAll" onchange="toggleAllRecSelections(this.checked)">
                          <span class="rec-table-checkbox__mark"></span>
                        </label>
                      </th>
                      <th class="rec-th-sortable" data-sort-key="title" style="min-width: 200px;" onclick="sortRecTable('title')">
                        <span class="rec-th-content">
                          Title
                          <span class="rec-sort-icon" data-sort-key="title"></span>
                        </span>
                      </th>
                      <th class="rec-th-sortable" data-sort-key="priority" style="width: 100px;" onclick="sortRecTable('priority')">
                        <span class="rec-th-content">
                          Priority
                          <span class="rec-sort-icon" data-sort-key="priority"></span>
                        </span>
                      </th>
                      <th class="rec-th-sortable" data-sort-key="status" style="width: 120px;" onclick="sortRecTable('status')">
                        <span class="rec-th-content">
                          Status
                          <span class="rec-sort-icon" data-sort-key="status"></span>
                        </span>
                      </th>
                      <th style="width: 180px;">Tools</th>
                      <th class="rec-th-sortable" data-sort-key="category" style="width: 120px;" onclick="sortRecTable('category')">
                        <span class="rec-th-content">
                          Category
                          <span class="rec-sort-icon" data-sort-key="category"></span>
                        </span>
                      </th>
                      <th style="width: 80px;">Framework</th>
                      <th class="rec-th-sortable" data-sort-key="score" style="width: 80px;" onclick="sortRecTable('score')">
                        <span class="rec-th-content">
                          Score
                          <span class="rec-sort-icon" data-sort-key="score"></span>
                        </span>
                      </th>
                      <th style="width: 100px;">Actions</th>
                    </tr>
                    <!-- Filter Row (Excel-style) -->
                    <tr class="rec-table-filter-row">
                      <th>
                        <button class="rec-filter-clear-btn" onclick="clearAllTableFilters()" title="Clear all filters">
                          <svg width="12" height="12" viewBox="0 0 32 32" fill="currentColor"><path d="M24 9.4L22.6 8 16 14.6 9.4 8 8 9.4 14.6 16 8 22.6 9.4 24 16 17.4 22.6 24 24 22.6 17.4 16 24 9.4z"/></svg>
                        </button>
                      </th>
                      <th>
                        <input type="text" class="rec-filter-input" id="recFilterTitle" placeholder="Filter title..." oninput="applyTableFilters()">
                      </th>
                      <th>
                        <select class="rec-filter-select" id="recFilterPriority" onchange="applyTableFilters()">
                          <option value="">All</option>
                          <option value="high">High</option>
                          <option value="medium">Medium</option>
                          <option value="low">Low</option>
                        </select>
                      </th>
                      <th>
                        <select class="rec-filter-select" id="recFilterStatus" onchange="applyTableFilters()">
                          <option value="">All</option>
                          <option value="open">Open</option>
                          <option value="in_progress">In Progress</option>
                          <option value="completed">Completed</option>
                          <option value="dismissed">Dismissed</option>
                        </select>
                      </th>
                      <th>
                        <select class="rec-filter-select" id="recFilterTools" onchange="applyTableFilters()">
                          <option value="">All Tools</option>
                          <option value="Targetprocess">Targetprocess</option>
                          <option value="Costing">Costing</option>
                          <option value="Planning">Planning</option>
                          <option value="Cloudability">Cloudability</option>
                        </select>
                      </th>
                      <th>
                        <input type="text" class="rec-filter-input" id="recFilterCategory" placeholder="Filter..." oninput="applyTableFilters()">
                      </th>
                      <th>
                        <select class="rec-filter-select" id="recFilterFramework" onchange="applyTableFilters()">
                          <option value="">All</option>
                          <option value="spm">SPM</option>
                          <option value="tbm">TBM</option>
                          <option value="finops">FinOps</option>
                        </select>
                      </th>
                      <th>
                        <input type="number" class="rec-filter-input" id="recFilterScoreMin" placeholder="Min" style="width: 50%;" oninput="applyTableFilters()">
                      </th>
                      <th>
                        <select class="rec-filter-select" id="recFilterSource" onchange="applyTableFilters()">
                          <option value="">All</option>
                          <option value="custom">Custom</option>
                          <option value="generated">AI</option>
                        </select>
                      </th>
                    </tr>
                  </thead>
                  <tbody id="recTableBody">
                    <!-- Table rows populated by JS -->
                  </tbody>
                </table>
              </div>
              <!-- Active Filters Display -->
              <div id="recActiveFilters" class="rec-active-filters" style="display: none;">
                <span class="rec-active-filters__label">Active filters:</span>
                <div id="recActiveFilterChips" class="rec-active-filters__chips">
                  <!-- Filter chips populated by JS -->
                </div>
                <button class="btn btn--ghost btn--sm" onclick="clearAllTableFilters()">Clear All</button>
              </div>
            </div>
          </div>

          <!-- Custom Recommendations Panel (hidden by default) -->
          <div id="customRecommendationsPanel" style="display: none; padding: 16px;">
            <div id="noCustomRecsState" style="text-align: center; padding: 32px;">
              <svg width="48" height="48" viewBox="0 0 32 32" style="color: var(--cds-text-secondary); margin-bottom: 12px;"><path d="M16 2l4 8 8 1.5-6 5.5 1.5 8.5-7.5-4-7.5 4 1.5-8.5-6-5.5L12 10l4-8z"/></svg>
              <h3 style="margin-bottom: 8px; font-size: 15px;">No Custom Recommendations</h3>
              <p style="color: var(--cds-text-secondary); margin-bottom: 16px; font-size: 13px;">Add recommendations to track improvement actions for this customer.</p>
              <button class="btn btn--primary btn--sm" onclick="openCustomRecommendationModal()">Add First Recommendation</button>
            </div>
            <div id="customRecsList">
              <!-- Custom recommendations populated by JS -->
            </div>
          </div>

          <!-- Generated Recommendations Panel (hidden by default) -->
          <div id="generatedRecommendationsPanel" style="display: none; padding: 16px;">
            <!-- No Recommendations State -->
            <div id="noGeneratedRecsState" style="text-align: center; padding: 32px;">
              <svg width="48" height="48" viewBox="0 0 32 32" style="color: var(--cds-text-secondary); margin-bottom: 12px;"><path d="M16 2l4 8 8 1.5-6 5.5 1.5 8.5-7.5-4-7.5 4 1.5-8.5-6-5.5L12 10l4-8z"/></svg>
              <h3 style="margin-bottom: 8px; font-size: 15px;">No Generated Recommendations</h3>
              <p style="color: var(--cds-text-secondary); margin-bottom: 16px; font-size: 13px;">Complete an assessment to get AI-powered recommendations.</p>
              <button class="btn btn--secondary btn--sm" onclick="generateRecommendations()">Generate Recommendations</button>
            </div>

            <!-- Weak Dimensions Summary -->
            <div id="weakDimensionsSummary" style="margin-bottom: 24px; display: none;">
              <h3 style="font-size: 14px; font-weight: 600; margin-bottom: 12px;">Areas for Improvement</h3>
              <div id="weakDimensionsChips" style="display: flex; gap: 8px; flex-wrap: wrap;">
                <!-- Chips populated by JS -->
              </div>
            </div>

            <!-- Recommendations List -->
            <div id="recommendationsList">
              <!-- Recommendations populated by JS -->
            </div>
          </div>
        </div>

        <!-- Custom Recommendation Modal -->
        <div class="modal" id="customRecommendationModal">
          <div class="modal__overlay" onclick="closeCustomRecommendationModal()"></div>
          <div class="modal__container" style="max-width: 600px;">
            <div class="modal__header">
              <h2 class="modal__title" id="customRecModalTitle">Add Recommendation</h2>
              <button class="modal__close" onclick="closeCustomRecommendationModal()">&times;</button>
            </div>
            <div class="modal__body">
              <form id="customRecForm">
                <div class="form-group">
                  <label class="form-label" for="recTitle">Title *</label>
                  <input type="text" id="recTitle" class="form-input" placeholder="e.g., Implement resource capacity planning" required>
                </div>
                <div class="grid grid--2" style="gap: 16px;">
                  <div class="form-group">
                    <label class="form-label" for="recAssessmentType">Assessment Framework</label>
                    <select id="recAssessmentType" class="form-select">
                      <option value="">Not specific to a framework</option>
                      <option value="1">SPM - Strategic Portfolio Management</option>
                      <option value="2">TBM - Technology Business Management</option>
                      <option value="3">FinOps - Financial Operations</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label class="form-label" for="recPriority">Priority</label>
                    <select id="recPriority" class="form-select">
                      <option value="high">High</option>
                      <option value="medium" selected>Medium</option>
                      <option value="low">Low</option>
                    </select>
                  </div>
                </div>
                <div class="grid grid--2" style="gap: 16px;">
                  <div class="form-group">
                    <label class="form-label" for="recStatus">Status</label>
                    <select id="recStatus" class="form-select">
                      <option value="open" selected>Open</option>
                      <option value="in_progress">In Progress</option>
                      <option value="completed">Completed</option>
                      <option value="dismissed">Dismissed</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label class="form-label" for="recDueDate">Due Date</label>
                    <input type="date" id="recDueDate" class="form-input">
                  </div>
                </div>
                <div class="form-group">
                  <label class="form-label" for="recCategory">Category</label>
                  <input type="text" id="recCategory" class="form-input" placeholder="e.g., Process Improvement, Technology, Training">
                </div>
                <div class="form-group">
                  <label class="form-label">Tools</label>
                  <div class="tools-multiselect" style="display: flex; flex-wrap: wrap; gap: 8px;">
                    <label class="checkbox-chip">
                      <input type="checkbox" name="recTools" value="Targetprocess">
                      <span class="checkbox-chip__label">Targetprocess</span>
                    </label>
                    <label class="checkbox-chip">
                      <input type="checkbox" name="recTools" value="Costing">
                      <span class="checkbox-chip__label">Costing</span>
                    </label>
                    <label class="checkbox-chip">
                      <input type="checkbox" name="recTools" value="Planning">
                      <span class="checkbox-chip__label">Planning</span>
                    </label>
                    <label class="checkbox-chip">
                      <input type="checkbox" name="recTools" value="Cloudability">
                      <span class="checkbox-chip__label">Cloudability</span>
                    </label>
                  </div>
                </div>
                <div class="form-group">
                  <label class="form-label" for="recExpectedImpact">Expected Maturity Impact</label>
                  <input type="number" id="recExpectedImpact" class="form-input" min="0" max="2" step="0.1" placeholder="e.g., 0.5">
                  <p class="form-hint">Estimated improvement to maturity score (0-2 points)</p>
                </div>
                <div class="form-group">
                  <label class="form-label" for="recDescription">Description</label>
                  <textarea id="recDescription" class="form-textarea" rows="4" placeholder="Detailed description of the recommendation..."></textarea>
                </div>
              </form>
            </div>
            <div class="modal__footer">
              <button type="button" class="btn btn--secondary" onclick="closeCustomRecommendationModal()">Cancel</button>
              <button type="button" class="btn btn--primary" onclick="saveCustomRecommendation()" id="saveRecBtn">Save Recommendation</button>
            </div>
          </div>
        </div>

        <!-- Journey Section (shown when Journey tab is active) -->
        <div class="card mt-5" id="implementationFlowSection" style="display: none;">
          <div class="card__header" style="flex-direction: column; align-items: stretch; gap: 16px;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <h2 class="section-title" style="margin-bottom: 0;">
                <svg width="20" height="20" viewBox="0 0 32 32"><path d="M28 2H4a2 2 0 00-2 2v24a2 2 0 002 2h24a2 2 0 002-2V4a2 2 0 00-2-2zM4 28V4h11v24zm13 0V4h11v24z"/><path d="M8 8h4v2H8zm0 4h4v2H8zm0 4h4v2H8zm12-8h4v2h-4zm0 4h4v2h-4zm0 4h4v2h-4z"/></svg>
                Journey Visualization
              </h2>
              <div class="flex gap-3" style="align-items: center;">
                <div class="flow-assessment-selector" style="display: flex; align-items: center; gap: 8px;">
                  <label style="font-size: 12px; font-weight: 500; color: var(--cds-text-secondary); white-space: nowrap;">Assessment:</label>
                  <select id="flowAssessmentSelect" class="form-select" style="min-width: 220px; padding: 6px 12px; border-radius: 4px; border: 1px solid var(--cds-border-strong); font-size: 13px;" onchange="onFlowAssessmentChange()">
                    <option value="">Loading...</option>
                  </select>
                </div>
                <button class="btn btn--secondary" onclick="refreshFlowVisualization()">
                  <svg width="16" height="16" viewBox="0 0 32 32" fill="currentColor"><path d="M12 10H6.78A11 11 0 0127 16h2A13 13 0 006 7.68V4H4v8h8zm8 12h5.22A11 11 0 015 16H3a13 13 0 0023 8.32V28h2v-8h-8z"/></svg>
                  Refresh
                </button>
              </div>
            </div>
            <!-- Framework Type Tabs -->
            <div class="assessment-type-tabs" id="flowAssessmentTypeTabs">
              <button class="assessment-type-tab active" data-type="spm" onclick="switchFlowAssessmentType('spm')">
                <span class="assessment-type-tab__indicator" style="background-color: var(--spm-color);"></span>
                <span>SPM</span>
                <span class="assessment-type-tab__score" id="flowTabSpmScore">-</span>
              </button>
              <button class="assessment-type-tab" data-type="tbm" onclick="switchFlowAssessmentType('tbm')">
                <span class="assessment-type-tab__indicator" style="background-color: var(--tbm-color);"></span>
                <span>TBM</span>
                <span class="assessment-type-tab__score" id="flowTabTbmScore">-</span>
              </button>
              <button class="assessment-type-tab" data-type="finops" onclick="switchFlowAssessmentType('finops')">
                <span class="assessment-type-tab__indicator" style="background-color: var(--finops-color);"></span>
                <span>FinOps</span>
                <span class="assessment-type-tab__score" id="flowTabFinopsScore">-</span>
              </button>
            </div>
          </div>

          <!-- No Flow Data State -->
          <div id="noFlowState" style="text-align: center; padding: 48px 24px;">
            <svg width="64" height="64" viewBox="0 0 32 32" style="color: var(--cds-text-secondary); margin-bottom: 16px;"><path d="M28 2H4a2 2 0 00-2 2v24a2 2 0 002 2h24a2 2 0 002-2V4a2 2 0 00-2-2zM4 28V4h11v24zm13 0V4h11v24z"/></svg>
            <h3 style="margin-bottom: 8px; font-size: 16px;">No Journey Data</h3>
            <p style="color: var(--cds-text-secondary); margin-bottom: 16px;">Complete an assessment (SPM, TBM, or FinOps) with scores below threshold to see the journey from dimensions to use cases to product solutions.</p>
          </div>

          <!-- Flow Visualization Content -->
          <div id="flowVisualizationContent" style="display: none; padding: 16px;">
            <!-- Summary Statistics -->
            <div class="grid grid--3" style="margin-bottom: 24px;">
              <div class="metric-card">
                <div class="metric-card__label">Weak Dimensions</div>
                <div class="metric-card__value" id="flowWeakDimensionsCount">-</div>
              </div>
              <div class="metric-card">
                <div class="metric-card__label">Recommended Use Cases</div>
                <div class="metric-card__value" id="flowUseCasesCount">-</div>
              </div>
              <div class="metric-card">
                <div class="metric-card__label">TP Features to Implement</div>
                <div class="metric-card__value" id="flowTPFeaturesCount">-</div>
              </div>
            </div>

            <!-- Flow Visualization Card -->
            <div class="card" style="margin-bottom: 24px;">
              <div class="card__header">
                <h3 id="flowChartTitle" style="font-size: 14px; font-weight: 600; margin-bottom: 0;">Assessment Gap -> Use Case -> TP Feature Flow</h3>
                <button class="btn btn--ghost btn--sm" onclick="openFlowChartModal()">
                  <svg width="14" height="14" viewBox="0 0 32 32" fill="currentColor"><path d="M28 4H10a2 2 0 00-2 2v14a2 2 0 002 2h18a2 2 0 002-2V6a2 2 0 00-2-2zm0 16H10V6h18zM2 24V10H0v14a2 2 0 002 2h18v-2z"/></svg>
                  Expand
                </button>
              </div>
              <div class="card__body">
                <!-- Filter Controls -->
                <div class="flow-filters" style="display: flex; gap: 16px; margin-bottom: 16px; flex-wrap: wrap; align-items: center;">
                  <div class="flow-filter-group">
                    <label style="font-size: 12px; font-weight: 500; color: var(--cds-text-secondary); margin-right: 8px;">Filter by Dimension:</label>
                    <select id="flowDimensionFilter" class="form-select" style="min-width: 180px; padding: 6px 12px; border-radius: 4px; border: 1px solid var(--cds-border-strong); font-size: 13px;" onchange="applyFlowFilters()">
                      <option value="all">All Dimensions</option>
                    </select>
                  </div>
                  <div class="flow-filter-group">
                    <label style="font-size: 12px; font-weight: 500; color: var(--cds-text-secondary); margin-right: 8px;">Filter by Use Case:</label>
                    <select id="flowUseCaseFilter" class="form-select" style="min-width: 200px; padding: 6px 12px; border-radius: 4px; border: 1px solid var(--cds-border-strong); font-size: 13px;" onchange="applyFlowFilters()">
                      <option value="all">All Use Cases</option>
                    </select>
                  </div>
                  <button class="btn btn--ghost btn--sm" onclick="resetFlowFilters()" style="font-size: 12px;">
                    <svg width="12" height="12" viewBox="0 0 32 32" fill="currentColor"><path d="M12 10H6.78A11 11 0 0127 16h2A13 13 0 006 7.68V4H4v8h8zm8 12h5.22A11 11 0 015 16H3a13 13 0 0023 8.32V28h2v-8h-8z"/></svg>
                    Reset
                  </button>
                </div>
                <div class="sankey-column-headers" style="display: flex; justify-content: space-between; padding: 0 80px 8px 100px; font-size: 12px; font-weight: 600; color: #525252;">
                  <span>Dimensions</span>
                  <span>Use Cases</span>
                  <span>Solutions</span>
                </div>
                <div class="flow-chart-container" onclick="openFlowChartModal()" style="height: 580px; cursor: pointer; border-radius: 8px; transition: all 0.2s ease;">
                  <canvas id="flowSankeyChart"></canvas>
                </div>
                <div class="flow-legend" style="display: flex; justify-content: center; gap: 24px; margin-top: 16px; padding: 12px; background: var(--cds-layer-02); border-radius: 6px;">
                  <span style="display: flex; align-items: center; gap: 6px; font-size: 12px;">
                    <span style="width: 12px; height: 12px; border-radius: 50%; background: #da1e28;"></span> Critical (&lt; 2.0)
                  </span>
                  <span style="display: flex; align-items: center; gap: 6px; font-size: 12px;">
                    <span style="width: 12px; height: 12px; border-radius: 50%; background: #ff832b;"></span> Needs Work (&lt; 3.0)
                  </span>
                  <span style="display: flex; align-items: center; gap: 6px; font-size: 12px;">
                    <span style="width: 12px; height: 12px; border-radius: 50%; background: #f1c21b;"></span> Below Target (&lt; 4.0)
                  </span>
                  <span style="display: flex; align-items: center; gap: 6px; font-size: 12px;">
                    <span style="width: 12px; height: 12px; border-radius: 50%; background: #0f62fe;"></span> Use Cases
                  </span>
                  <span style="display: flex; align-items: center; gap: 6px; font-size: 12px;">
                    <span style="width: 12px; height: 12px; border-radius: 50%; background: #8a3ffc;"></span> TP Features
                  </span>
                </div>
              </div>
            </div>

            <!-- Data Table: Dimensions with Gaps -->
            <div style="margin-bottom: 24px;">
              <h3 style="font-size: 14px; font-weight: 600; margin-bottom: 12px;">Weak Dimensions</h3>
              <div class="data-table-container">
                <table class="data-table" id="flowDimensionsTable">
                  <thead>
                    <tr>
                      <th>Dimension</th>
                      <th>Score</th>
                      <th>Gap to Target (3.5)</th>
                      <th>Status</th>
                    </tr>
                  </thead>
                  <tbody id="flowDimensionsTableBody">
                    <tr><td colspan="4" class="text-center text-secondary">Loading...</td></tr>
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Data Table: Recommended Use Cases -->
            <div style="margin-bottom: 24px;">
              <h3 style="font-size: 14px; font-weight: 600; margin-bottom: 12px;">Recommended Use Cases</h3>
              <div class="data-table-container">
                <table class="data-table" id="flowUseCasesTable">
                  <thead>
                    <tr>
                      <th>Use Case</th>
                      <th>Solution Area</th>
                      <th>Improves</th>
                      <th>TP Features</th>
                    </tr>
                  </thead>
                  <tbody id="flowUseCasesTableBody">
                    <tr><td colspan="4" class="text-center text-secondary">Loading...</td></tr>
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Data Table: TP Features -->
            <div>
              <h3 style="font-size: 14px; font-weight: 600; margin-bottom: 12px;">TP Features to Implement</h3>
              <div class="data-table-container">
                <table class="data-table" id="flowTPFeaturesTable">
                  <thead>
                    <tr>
                      <th>Feature Name</th>
                      <th>For Use Case</th>
                      <th>Required</th>
                      <th>TP Link</th>
                    </tr>
                  </thead>
                  <tbody id="flowTPFeaturesTableBody">
                    <tr><td colspan="4" class="text-center text-secondary">Loading...</td></tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- Flow Chart Modal -->
        <div class="modal" id="flowChartModal">
          <div class="modal__overlay" onclick="closeFlowChartModal()"></div>
          <div class="modal__container" style="max-width: 1100px; max-height: 90vh;">
            <div class="modal__header">
              <h2 class="modal__title">Assessment -> Use Case -> TP Feature Flow</h2>
              <button class="modal__close" onclick="closeFlowChartModal()">&times;</button>
            </div>
            <div class="modal__body" style="padding: 24px;">
              <!-- Modal Filter Controls -->
              <div class="flow-filters" style="display: flex; gap: 16px; margin-bottom: 16px; flex-wrap: wrap; align-items: center;">
                <div class="flow-filter-group">
                  <label style="font-size: 12px; font-weight: 500; color: var(--cds-text-secondary); margin-right: 8px;">Filter by Dimension:</label>
                  <select id="flowDimensionFilterModal" class="form-select" style="min-width: 180px; padding: 6px 12px; border-radius: 4px; border: 1px solid var(--cds-border-strong); font-size: 13px;" onchange="applyFlowFilters(true)">
                    <option value="all">All Dimensions</option>
                  </select>
                </div>
                <div class="flow-filter-group">
                  <label style="font-size: 12px; font-weight: 500; color: var(--cds-text-secondary); margin-right: 8px;">Filter by Use Case:</label>
                  <select id="flowUseCaseFilterModal" class="form-select" style="min-width: 200px; padding: 6px 12px; border-radius: 4px; border: 1px solid var(--cds-border-strong); font-size: 13px;" onchange="applyFlowFilters(true)">
                    <option value="all">All Use Cases</option>
                  </select>
                </div>
                <button class="btn btn--ghost btn--sm" onclick="resetFlowFilters(true)" style="font-size: 12px;">
                  <svg width="12" height="12" viewBox="0 0 32 32" fill="currentColor"><path d="M12 10H6.78A11 11 0 0127 16h2A13 13 0 006 7.68V4H4v8h8zm8 12h5.22A11 11 0 015 16H3a13 13 0 0023 8.32V28h2v-8h-8z"/></svg>
                  Reset
                </button>
              </div>

              <!-- Exportable Container (includes title, chart, and legend) -->
              <div id="flowExportContainer" style="background: white; padding: 20px; border-radius: 8px;">
                <!-- Title for export -->
                <div id="flowExportTitle" style="text-align: center; margin-bottom: 16px;">
                  <h3 style="font-size: 18px; font-weight: 600; color: #161616; margin: 0;" id="flowExportTitleText">Journey Visualization</h3>
                  <p style="font-size: 12px; color: #525252; margin: 4px 0 0 0;" id="flowExportSubtitle">Assessment Gaps  Recommended Use Cases  TP Features</p>
                </div>

                <!-- Chart Container -->
                <div class="sankey-column-headers" style="display: flex; justify-content: space-between; padding: 0 60px 8px 80px; font-size: 12px; font-weight: 600; color: #525252;">
                  <span>Dimensions</span>
                  <span>Use Cases</span>
                  <span>Solutions</span>
                </div>
                <div style="height: 430px;">
                  <canvas id="flowSankeyChartLarge"></canvas>
                </div>

                <!-- Legend for export -->
                <div id="flowExportLegend" style="display: flex; justify-content: center; gap: 24px; margin-top: 16px; padding: 12px; background: #f4f4f4; border-radius: 6px;">
                  <span style="display: flex; align-items: center; gap: 6px; font-size: 12px;">
                    <span style="width: 12px; height: 12px; border-radius: 50%; background: #da1e28;"></span> Critical (&lt; 2.0)
                  </span>
                  <span style="display: flex; align-items: center; gap: 6px; font-size: 12px;">
                    <span style="width: 12px; height: 12px; border-radius: 50%; background: #ff832b;"></span> Needs Work (&lt; 3.0)
                  </span>
                  <span style="display: flex; align-items: center; gap: 6px; font-size: 12px;">
                    <span style="width: 12px; height: 12px; border-radius: 50%; background: #f1c21b;"></span> Below Target (&lt; 4.0)
                  </span>
                  <span style="display: flex; align-items: center; gap: 6px; font-size: 12px;">
                    <span style="width: 12px; height: 12px; border-radius: 50%; background: #0f62fe;"></span> Use Cases
                  </span>
                  <span style="display: flex; align-items: center; gap: 6px; font-size: 12px;">
                    <span style="width: 12px; height: 12px; border-radius: 50%; background: #8a3ffc;"></span> TP Features
                  </span>
                </div>
              </div>
            </div>
            <div class="modal__footer" style="justify-content: center;">
              <button type="button" class="btn btn--primary" onclick="copyFlowVisualToClipboard()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 6px;">
                  <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                  <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                </svg>
                Copy for PowerPoint
              </button>
              <button type="button" class="btn btn--secondary" onclick="downloadFlowVisual()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 6px;">
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                  <polyline points="7 10 12 15 17 10"></polyline>
                  <line x1="12" y1="15" x2="12" y2="3"></line>
                </svg>
                Download Image
              </button>
            </div>
          </div>
        </div>

        <!-- Reports Section (shown when Reports tab is active) -->
        <div class="card mt-5" id="reportsSection" style="display: none;">
          <div class="card__header">
            <h2 class="section-title" style="margin-bottom: 0;">
              <svg width="20" height="20" viewBox="0 0 32 32"><path d="M10 18h8v2h-8zm0-5h12v2H10zm0 10h5v2h-5z"/><path d="M25 5h-3V4a2 2 0 00-2-2h-8a2 2 0 00-2 2v1H7a2 2 0 00-2 2v21a2 2 0 002 2h18a2 2 0 002-2V7a2 2 0 00-2-2zM12 4h8v4h-8zM25 28H7V7h3v3h12V7h3z"/></svg>
              Report Builder
            </h2>
            <div class="flex gap-2">
              <button class="btn btn--primary" onclick="generateReport()">
                <svg width="16" height="16" viewBox="0 0 32 32" fill="currentColor" style="margin-right: 6px;"><path d="M26 24v4H6v-4H4v4a2 2 0 002 2h20a2 2 0 002-2v-4zM6 12l1.41-1.41L15 18.17V2h2v16.17l7.59-7.58L26 12 16 22 6 12z"/></svg>
                Generate Preview
              </button>
              <button class="btn btn--secondary" onclick="printReport()" id="reportPrintBtn" disabled>
                <svg width="16" height="16" viewBox="0 0 32 32" fill="currentColor" style="margin-right: 6px;"><path d="M28 9h-4V5H8v4H4a2 2 0 00-2 2v10a2 2 0 002 2h4v4h16v-4h4a2 2 0 002-2V11a2 2 0 00-2-2zM10 7h12v2H10zm12 18H10v-8h12zm6-6h-4v-2H8v2H4V11h24z"/></svg>
                Print / PDF
              </button>
            </div>
          </div>

          <!-- Component Selector -->
          <div class="report-builder">
            <!-- Quick Presets -->
            <div class="report-presets">
              <span class="report-presets__label">Quick Presets:</span>
              <button class="btn btn--ghost btn--sm" onclick="selectReportPreset('executive')">Executive</button>
              <button class="btn btn--ghost btn--sm" onclick="selectReportPreset('full')">Full Report</button>
              <button class="btn btn--ghost btn--sm" onclick="selectReportPreset('assessment')">Assessment Only</button>
              <button class="btn btn--ghost btn--sm" onclick="selectReportPreset('planning')">Planning</button>
              <button class="btn btn--ghost btn--sm" onclick="selectReportPreset('clear')">Clear All</button>
            </div>

            <!-- Component Groups -->
            <div class="report-component-groups">
              <!-- Executive & Overview -->
              <div class="report-component-group">
                <h4 class="report-component-group__title">Overview</h4>
                <div class="report-component-group__options">
                  <label class="checkbox-chip">
                    <input type="checkbox" name="reportComponent" value="executiveSummary" checked>
                    <span class="checkbox-chip__label">Executive Summary</span>
                  </label>
                  <label class="checkbox-chip">
                    <input type="checkbox" name="reportComponent" value="accountOverview">
                    <span class="checkbox-chip__label">Account Overview</span>
                  </label>
                </div>
              </div>

              <!-- Assessment Information -->
              <div class="report-component-group">
                <h4 class="report-component-group__title">Assessment Information</h4>
                <div class="report-component-group__options">
                  <label class="checkbox-chip">
                    <input type="checkbox" name="reportComponent" value="assessmentDetails" checked>
                    <span class="checkbox-chip__label">Assessment Details</span>
                  </label>
                  <label class="checkbox-chip">
                    <input type="checkbox" name="reportComponent" value="assessmentScores" checked>
                    <span class="checkbox-chip__label">Assessment Scores</span>
                  </label>
                  <label class="checkbox-chip">
                    <input type="checkbox" name="reportComponent" value="scoreTargets">
                    <span class="checkbox-chip__label">Score Targets Comparison</span>
                  </label>
                </div>
              </div>

              <!-- Framework Assessments -->
              <div class="report-component-group">
                <h4 class="report-component-group__title">Framework Assessments</h4>
                <div class="report-component-group__options">
                  <label class="checkbox-chip">
                    <input type="checkbox" name="reportComponent" value="spmAssessment" checked>
                    <span class="checkbox-chip__label">SPM Assessment</span>
                  </label>
                  <label class="checkbox-chip">
                    <input type="checkbox" name="reportComponent" value="tbmAssessment">
                    <span class="checkbox-chip__label">TBM Assessment</span>
                  </label>
                  <label class="checkbox-chip">
                    <input type="checkbox" name="reportComponent" value="finopsAssessment">
                    <span class="checkbox-chip__label">FinOps Assessment</span>
                  </label>
                </div>
              </div>

              <!-- Planning & Execution -->
              <div class="report-component-group">
                <h4 class="report-component-group__title">Planning & Execution</h4>
                <div class="report-component-group__options">
                  <label class="checkbox-chip">
                    <input type="checkbox" name="reportComponent" value="recommendations" checked>
                    <span class="checkbox-chip__label">Recommendations</span>
                  </label>
                  <label class="checkbox-chip">
                    <input type="checkbox" name="reportComponent" value="flowDiagram">
                    <span class="checkbox-chip__label">Flow Diagram</span>
                  </label>
                  <label class="checkbox-chip">
                    <input type="checkbox" name="reportComponent" value="roadmap">
                    <span class="checkbox-chip__label">Roadmap</span>
                  </label>
                </div>
              </div>

              <!-- Additional Sections -->
              <div class="report-component-group">
                <h4 class="report-component-group__title">Additional Sections</h4>
                <div class="report-component-group__options">
                  <label class="checkbox-chip">
                    <input type="checkbox" name="reportComponent" value="gapAnalysis">
                    <span class="checkbox-chip__label">Gap Analysis</span>
                  </label>
                  <label class="checkbox-chip">
                    <input type="checkbox" name="reportComponent" value="riskSummary">
                    <span class="checkbox-chip__label">Risk Summary</span>
                  </label>
                </div>
              </div>
            </div>

            <!-- Report Preview -->
            <div class="report-preview" id="reportPreviewContainer">
              <div class="report-preview__placeholder">
                <svg width="48" height="48" viewBox="0 0 32 32" style="opacity: 0.3; margin-bottom: 12px;">
                  <path d="M10 18h8v2h-8zm0-5h12v2H10zm0 10h5v2h-5z"/>
                  <path d="M25 5h-3V4a2 2 0 00-2-2h-8a2 2 0 00-2 2v1H7a2 2 0 00-2 2v21a2 2 0 002 2h18a2 2 0 002-2V7a2 2 0 00-2-2zM12 4h8v4h-8zM25 28H7V7h3v3h12V7h3z"/>
                </svg>
                <p>Select components and click "Generate Preview" to see your report</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Accept Recommendation Modal -->
        <div class="modal" id="acceptRecommendationModal">
          <div class="modal__overlay" onclick="closeAcceptRecommendationModal()"></div>
          <div class="modal__container" style="max-width: 500px;">
            <div class="modal__header">
              <h2 class="modal__title">Add to Roadmap</h2>
              <button class="modal__close" onclick="closeAcceptRecommendationModal()">&times;</button>
            </div>
            <form id="acceptRecommendationForm" onsubmit="handleAddToRoadmap(event)">
              <input type="hidden" id="acceptRecId" value="">
              <div class="modal__body">
                <p class="text-secondary mb-4" id="acceptRecTitle">Loading...</p>

                <div class="form-group">
                  <label class="form-label">How relevant was this recommendation? (optional)</label>
                  <div class="star-rating" id="acceptRecRating">
                    <button type="button" class="star-btn" data-rating="1" onclick="setAcceptRating(1)" title="1 - Poor match">
                      <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor"><path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/></svg>
                    </button>
                    <button type="button" class="star-btn" data-rating="2" onclick="setAcceptRating(2)" title="2 - Below average">
                      <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor"><path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/></svg>
                    </button>
                    <button type="button" class="star-btn" data-rating="3" onclick="setAcceptRating(3)" title="3 - Acceptable">
                      <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor"><path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/></svg>
                    </button>
                    <button type="button" class="star-btn" data-rating="4" onclick="setAcceptRating(4)" title="4 - Good match">
                      <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor"><path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/></svg>
                    </button>
                    <button type="button" class="star-btn" data-rating="5" onclick="setAcceptRating(5)" title="5 - Excellent match">
                      <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor"><path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/></svg>
                    </button>
                  </div>
                  <input type="hidden" id="acceptRecRatingValue" value="">
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label class="form-label" for="acceptRecQuarter">Target Quarter *</label>
                    <select id="acceptRecQuarter" class="select-input" required>
                      <option value="Q1">Q1</option>
                      <option value="Q2">Q2</option>
                      <option value="Q3">Q3</option>
                      <option value="Q4">Q4</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label class="form-label" for="acceptRecYear">Year *</label>
                    <select id="acceptRecYear" class="select-input" required>
                      <!-- Options populated by JS -->
                    </select>
                  </div>
                </div>

                <div class="form-group">
                  <label class="form-label">Tools</label>
                  <div class="tools-multiselect" style="display: flex; flex-wrap: wrap; gap: 8px;">
                    <label class="checkbox-chip">
                      <input type="checkbox" name="acceptRecTools" value="Targetprocess">
                      <span class="checkbox-chip__label">Targetprocess</span>
                    </label>
                    <label class="checkbox-chip">
                      <input type="checkbox" name="acceptRecTools" value="Costing">
                      <span class="checkbox-chip__label">Costing</span>
                    </label>
                    <label class="checkbox-chip">
                      <input type="checkbox" name="acceptRecTools" value="Planning">
                      <span class="checkbox-chip__label">Planning</span>
                    </label>
                    <label class="checkbox-chip">
                      <input type="checkbox" name="acceptRecTools" value="Cloudability">
                      <span class="checkbox-chip__label">Cloudability</span>
                    </label>
                  </div>
                </div>

                <div class="form-group">
                  <label class="form-label" for="acceptRecNotes">Notes (optional)</label>
                  <textarea id="acceptRecNotes" class="text-input" rows="2" placeholder="Add any notes about this roadmap item..."></textarea>
                </div>
              </div>
              <div class="modal__footer">
                <button type="button" class="btn btn--ghost" onclick="closeAcceptRecommendationModal()">Cancel</button>
                <button type="submit" class="btn btn--primary" id="acceptRecSubmitBtn">Add to Roadmap</button>
              </div>
            </form>
          </div>
        </div>

        <!-- Dismiss Recommendation Modal -->
        <div class="modal" id="dismissRecommendationModal">
          <div class="modal__overlay" onclick="closeDismissRecommendationModal()"></div>
          <div class="modal__container" style="max-width: 480px;">
            <div class="modal__header">
              <h2 class="modal__title">Dismiss Recommendation</h2>
              <button class="modal__close" onclick="closeDismissRecommendationModal()">&times;</button>
            </div>
            <form id="dismissRecommendationForm" onsubmit="handleDismissRecommendation(event)">
              <input type="hidden" id="dismissRecId" value="">
              <div class="modal__body">
                <p class="text-secondary mb-4" id="dismissRecTitle">Loading...</p>

                <div class="form-group">
                  <label class="form-label" for="dismissRecReason">Why are you dismissing this? *</label>
                  <select id="dismissRecReason" class="select-input" required>
                    <option value="">Select a reason...</option>
                    <option value="not_relevant">Not relevant for this customer</option>
                    <option value="already_planned">Already planned or in progress</option>
                    <option value="too_expensive">Too expensive / budget constraints</option>
                    <option value="customer_declined">Customer declined</option>
                    <option value="wrong_timing">Wrong timing</option>
                    <option value="other">Other</option>
                  </select>
                </div>

                <div class="form-group">
                  <label class="form-label" for="dismissRecFeedback">Additional feedback (optional)</label>
                  <textarea id="dismissRecFeedback" class="text-input" rows="2" placeholder="Any additional details..."></textarea>
                </div>

                <div class="form-group">
                  <label class="form-label">How relevant was this recommendation? (optional)</label>
                  <div class="star-rating" id="dismissRecRating">
                    <button type="button" class="star-btn" data-rating="1" onclick="setDismissRating(1)" title="1 - Poor match">
                      <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor"><path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/></svg>
                    </button>
                    <button type="button" class="star-btn" data-rating="2" onclick="setDismissRating(2)" title="2 - Below average">
                      <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor"><path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/></svg>
                    </button>
                    <button type="button" class="star-btn" data-rating="3" onclick="setDismissRating(3)" title="3 - Acceptable">
                      <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor"><path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/></svg>
                    </button>
                    <button type="button" class="star-btn" data-rating="4" onclick="setDismissRating(4)" title="4 - Good match">
                      <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor"><path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/></svg>
                    </button>
                    <button type="button" class="star-btn" data-rating="5" onclick="setDismissRating(5)" title="5 - Excellent match">
                      <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor"><path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/></svg>
                    </button>
                  </div>
                  <input type="hidden" id="dismissRecRatingValue" value="">
                </div>
              </div>
              <div class="modal__footer">
                <button type="button" class="btn btn--ghost" onclick="closeDismissRecommendationModal()">Cancel</button>
                <button type="submit" class="btn btn--danger" id="dismissRecSubmitBtn">Dismiss</button>
              </div>
            </form>
          </div>
        </div>

        <!-- Bulk Edit Status Modal -->
        <div class="modal" id="bulkEditStatusModal">
          <div class="modal__overlay" onclick="closeBulkEditStatusModal()"></div>
          <div class="modal__container" style="max-width: 420px;">
            <div class="modal__header">
              <h2 class="modal__title">Edit Status</h2>
              <button class="modal__close" onclick="closeBulkEditStatusModal()">&times;</button>
            </div>
            <div class="modal__body">
              <p class="text-secondary mb-3">Change status for <strong id="bulkStatusCount">0</strong> selected recommendations</p>
              <div class="form-group">
                <label class="form-label" for="bulkStatusSelect">New Status</label>
                <select id="bulkStatusSelect" class="form-select">
                  <option value="open">Open</option>
                  <option value="in_progress">In Progress</option>
                  <option value="completed">Completed</option>
                </select>
              </div>
            </div>
            <div class="modal__footer">
              <button type="button" class="btn btn--ghost" onclick="closeBulkEditStatusModal()">Cancel</button>
              <button type="button" class="btn btn--primary" onclick="applyBulkStatusChange()">Apply Changes</button>
            </div>
          </div>
        </div>

        <!-- Bulk Edit Priority Modal -->
        <div class="modal" id="bulkEditPriorityModal">
          <div class="modal__overlay" onclick="closeBulkEditPriorityModal()"></div>
          <div class="modal__container" style="max-width: 420px;">
            <div class="modal__header">
              <h2 class="modal__title">Edit Priority</h2>
              <button class="modal__close" onclick="closeBulkEditPriorityModal()">&times;</button>
            </div>
            <div class="modal__body">
              <p class="text-secondary mb-3">Change priority for <strong id="bulkPriorityCount">0</strong> selected recommendations</p>
              <div class="form-group">
                <label class="form-label" for="bulkPrioritySelect">New Priority</label>
                <select id="bulkPrioritySelect" class="form-select">
                  <option value="high">High</option>
                  <option value="medium">Medium</option>
                  <option value="low">Low</option>
                </select>
              </div>
            </div>
            <div class="modal__footer">
              <button type="button" class="btn btn--ghost" onclick="closeBulkEditPriorityModal()">Cancel</button>
              <button type="button" class="btn btn--primary" onclick="applyBulkPriorityChange()">Apply Changes</button>
            </div>
          </div>
        </div>

        <!-- Bulk Edit Tools Modal -->
        <div class="modal" id="bulkEditToolsModal">
          <div class="modal__overlay" onclick="closeBulkEditToolsModal()"></div>
          <div class="modal__container" style="max-width: 480px;">
            <div class="modal__header">
              <h2 class="modal__title">Edit Tools</h2>
              <button class="modal__close" onclick="closeBulkEditToolsModal()">&times;</button>
            </div>
            <div class="modal__body">
              <p class="text-secondary mb-3">Set tools for <strong id="bulkToolsCount">0</strong> selected recommendations</p>
              <div class="form-group">
                <label class="form-label">Select Tools</label>
                <p class="text-secondary text-sm mb-2">Selected tools will replace any existing tools on these recommendations</p>
                <div class="tools-multiselect" style="display: flex; flex-wrap: wrap; gap: 8px;">
                  <label class="checkbox-chip">
                    <input type="checkbox" name="bulkTools" value="Targetprocess">
                    <span class="checkbox-chip__label">Targetprocess</span>
                  </label>
                  <label class="checkbox-chip">
                    <input type="checkbox" name="bulkTools" value="Costing">
                    <span class="checkbox-chip__label">Costing</span>
                  </label>
                  <label class="checkbox-chip">
                    <input type="checkbox" name="bulkTools" value="Planning">
                    <span class="checkbox-chip__label">Planning</span>
                  </label>
                  <label class="checkbox-chip">
                    <input type="checkbox" name="bulkTools" value="Cloudability">
                    <span class="checkbox-chip__label">Cloudability</span>
                  </label>
                </div>
              </div>
            </div>
            <div class="modal__footer">
              <button type="button" class="btn btn--ghost" onclick="closeBulkEditToolsModal()">Cancel</button>
              <button type="button" class="btn btn--primary" onclick="applyBulkToolsChange()">Apply Changes</button>
            </div>
          </div>
        </div>

        <!-- Bulk Send to Roadmap Modal -->
        <div class="modal" id="bulkSendToRoadmapModal">
          <div class="modal__overlay" onclick="closeBulkSendToRoadmapModal()"></div>
          <div class="modal__container" style="max-width: 600px;">
            <div class="modal__header">
              <h2 class="modal__title">Add to Roadmap</h2>
              <button class="modal__close" onclick="closeBulkSendToRoadmapModal()">&times;</button>
            </div>
            <div class="modal__body">
              <p class="text-secondary mb-3">Add <strong id="bulkRoadmapCount">0</strong> recommendations to the roadmap</p>

              <div class="form-group">
                <label class="form-label">Selected Items</label>
                <div id="bulkRoadmapItemsList" class="bulk-items-list" style="max-height: 180px; overflow-y: auto; border: 1px solid var(--cds-border-subtle-01); border-radius: 6px; padding: 8px;">
                  <!-- Items populated by JS -->
                </div>
              </div>

              <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                <div class="form-group">
                  <label class="form-label" for="bulkRoadmapQuarter">Target Quarter</label>
                  <select id="bulkRoadmapQuarter" class="form-select">
                    <option value="Q1">Q1</option>
                    <option value="Q2">Q2</option>
                    <option value="Q3">Q3</option>
                    <option value="Q4">Q4</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label" for="bulkRoadmapYear">Year</label>
                  <select id="bulkRoadmapYear" class="form-select">
                    <!-- Options populated by JS -->
                  </select>
                </div>
              </div>

              <div class="form-group">
                <label class="form-label">Tools</label>
                <div class="tools-multiselect" style="display: flex; flex-wrap: wrap; gap: 8px;">
                  <label class="checkbox-chip">
                    <input type="checkbox" name="bulkRoadmapTools" value="Targetprocess">
                    <span class="checkbox-chip__label">Targetprocess</span>
                  </label>
                  <label class="checkbox-chip">
                    <input type="checkbox" name="bulkRoadmapTools" value="Costing">
                    <span class="checkbox-chip__label">Costing</span>
                  </label>
                  <label class="checkbox-chip">
                    <input type="checkbox" name="bulkRoadmapTools" value="Planning">
                    <span class="checkbox-chip__label">Planning</span>
                  </label>
                  <label class="checkbox-chip">
                    <input type="checkbox" name="bulkRoadmapTools" value="Cloudability">
                    <span class="checkbox-chip__label">Cloudability</span>
                  </label>
                </div>
              </div>
            </div>
            <div class="modal__footer">
              <button type="button" class="btn btn--ghost" onclick="closeBulkSendToRoadmapModal()">Cancel</button>
              <button type="button" class="btn btn--primary" id="bulkRoadmapSubmitBtn" onclick="handleBulkSendToRoadmap()">Add to Roadmap</button>
            </div>
          </div>
        </div>

        <!-- Import Recommendations Modal -->
        <div class="modal" id="recImportModal">
          <div class="modal__overlay" onclick="closeRecImportModal()"></div>
          <div class="modal__container" style="max-width: 800px;">
            <div class="modal__header">
              <h2 class="modal__title">Import Recommendations</h2>
              <button class="modal__close" onclick="closeRecImportModal()">&times;</button>
            </div>
            <div class="modal__body">
              <div id="recImportStatus" class="rec-import-status">
                <div class="rec-import-status__icon">
                  <svg width="24" height="24" viewBox="0 0 32 32" fill="currentColor"><path d="M11 7a1 1 0 00-1 1v7.59l-2.29-2.3a1 1 0 00-1.42 1.42l4 4a1 1 0 001.42 0l4-4a1 1 0 00-1.42-1.42L12 15.59V8a1 1 0 00-1-1z"/><path d="M23 22H9a1 1 0 000 2h14a1 1 0 000-2z"/></svg>
                </div>
                <div class="rec-import-status__text">
                  <strong id="recImportFileName">No file selected</strong>
                  <span id="recImportRowCount"></span>
                </div>
              </div>

              <div class="form-group">
                <label class="form-label">Preview (first 10 rows)</label>
                <div class="rec-import-preview-wrapper">
                  <table class="rec-import-preview-table" id="recImportPreviewTable">
                    <thead>
                      <tr id="recImportPreviewHeader">
                        <!-- Headers populated by JS -->
                      </tr>
                    </thead>
                    <tbody id="recImportPreviewBody">
                      <!-- Preview rows populated by JS -->
                    </tbody>
                  </table>
                </div>
              </div>

              <div class="rec-import-options">
                <div class="form-group">
                  <label class="form-label">Import Mode</label>
                  <div class="rec-import-mode-options">
                    <label class="radio-option">
                      <input type="radio" name="recImportMode" value="create" checked>
                      <span class="radio-option__label">
                        <strong>Create new recommendations</strong>
                        <span class="text-secondary">All rows will be added as new recommendations</span>
                      </span>
                    </label>
                    <label class="radio-option">
                      <input type="radio" name="recImportMode" value="upsert">
                      <span class="radio-option__label">
                        <strong>Update existing or create new</strong>
                        <span class="text-secondary">Match by title - update if exists, create if new</span>
                      </span>
                    </label>
                  </div>
                </div>
              </div>

              <div id="recImportErrors" class="rec-import-errors" style="display: none;">
                <div class="rec-import-errors__header">
                  <svg width="16" height="16" viewBox="0 0 32 32" fill="currentColor"><path d="M16 2C8.3 2 2 8.3 2 16s6.3 14 14 14 14-6.3 14-14S23.7 2 16 2zm-1.1 6h2.2v11h-2.2V8zM16 25c-.8 0-1.5-.7-1.5-1.5S15.2 22 16 22s1.5.7 1.5 1.5S16.8 25 16 25z"/></svg>
                  <span>Validation Issues</span>
                </div>
                <ul id="recImportErrorsList">
                  <!-- Error messages populated by JS -->
                </ul>
              </div>
            </div>
            <div class="modal__footer">
              <button type="button" class="btn btn--ghost" onclick="closeRecImportModal()">Cancel</button>
              <button type="button" class="btn btn--primary" id="recImportSubmitBtn" onclick="executeRecImport()" disabled>
                Import <span id="recImportSubmitCount">0</span> Recommendations
              </button>
            </div>
          </div>
        </div>

        <!-- Edit AI-Generated Recommendation Modal -->
        <div class="modal" id="editRecGeneratedModal">
          <div class="modal__overlay" onclick="closeEditRecommendationGeneratedModal()"></div>
          <div class="modal__container" style="max-width: 600px;">
            <div class="modal__header">
              <h2 class="modal__title">Edit Recommendation</h2>
              <button class="modal__close" onclick="closeEditRecommendationGeneratedModal()">&times;</button>
            </div>
            <form id="editRecGeneratedForm" onsubmit="handleEditRecommendationGeneratedSubmit(event)">
              <input type="hidden" id="editRecGeneratedId" value="">
              <div class="modal__body">
                <div class="form-group">
                  <label class="form-label" for="editRecGeneratedTitle">Title <span class="text-danger">*</span></label>
                  <input type="text" id="editRecGeneratedTitle" class="text-input" required
                         placeholder="Enter recommendation title">
                </div>

                <div class="form-group">
                  <label class="form-label" for="editRecGeneratedDescription">Description</label>
                  <textarea id="editRecGeneratedDescription" class="text-input" rows="6"
                            placeholder="Enter recommendation details. Supports markdown: **bold**, *italic*, [link](url), - list items"></textarea>
                  <small style="color: var(--cds-text-secondary); font-size: 11px;">Supports markdown formatting: **bold**, *italic*, [link](url), - lists</small>
                </div>

                <div class="form-group" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                  <div>
                    <label class="form-label" for="editRecGeneratedPriority">Priority</label>
                    <select id="editRecGeneratedPriority" class="select-input">
                      <option value="high">High</option>
                      <option value="medium" selected>Medium</option>
                      <option value="low">Low</option>
                    </select>
                  </div>
                  <div>
                    <label class="form-label" for="editRecGeneratedCategory">Category</label>
                    <input type="text" id="editRecGeneratedCategory" class="text-input"
                           placeholder="e.g., Process, Technology, People">
                  </div>
                </div>

                <div class="form-group">
                  <label class="form-label">Tools</label>
                  <div class="tools-multiselect" style="display: flex; flex-wrap: wrap; gap: 8px;">
                    <label class="checkbox-chip">
                      <input type="checkbox" name="editRecGeneratedTools" value="Targetprocess">
                      <span class="checkbox-chip__label">Targetprocess</span>
                    </label>
                    <label class="checkbox-chip">
                      <input type="checkbox" name="editRecGeneratedTools" value="Costing">
                      <span class="checkbox-chip__label">Costing</span>
                    </label>
                    <label class="checkbox-chip">
                      <input type="checkbox" name="editRecGeneratedTools" value="Planning">
                      <span class="checkbox-chip__label">Planning</span>
                    </label>
                    <label class="checkbox-chip">
                      <input type="checkbox" name="editRecGeneratedTools" value="Cloudability">
                      <span class="checkbox-chip__label">Cloudability</span>
                    </label>
                  </div>
                </div>

                <div class="form-group" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                  <div>
                    <label class="form-label" for="editRecGeneratedDimension">Dimension</label>
                    <select id="editRecGeneratedDimension" class="select-input">
                      <option value="">Select dimension...</option>
                      <option value="Adoption">Adoption</option>
                      <option value="Efficiency">Efficiency</option>
                      <option value="Process">Process</option>
                      <option value="People">People</option>
                      <option value="Technology">Technology</option>
                      <option value="Governance">Governance</option>
                      <option value="Data Quality">Data Quality</option>
                      <option value="Integration">Integration</option>
                      <option value="Reporting">Reporting</option>
                    </select>
                  </div>
                  <div>
                    <label class="form-label" for="editRecGeneratedScore">Priority Score</label>
                    <input type="number" id="editRecGeneratedScore" class="text-input"
                           min="0" max="100" step="1" value="50" placeholder="0-100">
                    <small style="color: var(--cds-text-secondary); font-size: 11px;">AI-calculated score (0-100)</small>
                  </div>
                </div>
              </div>
              <div class="modal__footer">
                <button type="button" class="btn btn--ghost" onclick="closeEditRecommendationGeneratedModal()">Cancel</button>
                <button type="submit" class="btn btn--primary">Save Changes</button>
              </div>
            </form>
          </div>
        </div>

        <!-- Usage Framework Section (shown when Usage Framework tab is active) -->
        <div class="card mt-5" id="usageFrameworkSection" style="display: none;">
          <div class="card__header">
            <h2 class="section-title" style="margin-bottom: 0;">
              <svg width="20" height="20" viewBox="0 0 32 32"><path d="M10 18H6v8h4v-8zm12-8h-4v16h4V10zm-6 6h-4v10h4V16z"/></svg>
              Usage Framework
            </h2>
            <div class="flex gap-3">
              <select id="usageTimeframe" class="form-select" style="min-width: 120px;" onchange="updateUsageTimeframe()">
                <option value="30">Last 30 Days</option>
                <option value="90" selected>Last 90 Days</option>
                <option value="180">Last 6 Months</option>
                <option value="365">Last Year</option>
              </select>
            </div>
          </div>
          <div id="usageFrameworkContainer" style="padding: 16px;">
            <!-- Usage Metrics Row -->
            <div class="grid grid--4 mb-5">
              <div class="metric-card">
                <div class="metric-card__label">Active Users</div>
                <div class="metric-card__value" id="ufActiveUsers">-</div>
                <div class="metric-card__trend" id="ufActiveUsersTrend">-</div>
              </div>
              <div class="metric-card">
                <div class="metric-card__label">Login Frequency</div>
                <div class="metric-card__value" id="ufLoginFreq">-</div>
                <div class="metric-card__trend" id="ufLoginFreqTrend">-</div>
              </div>
              <div class="metric-card">
                <div class="metric-card__label">Feature Adoption</div>
                <div class="metric-card__value" id="ufFeatureAdoption">-</div>
                <div class="metric-card__trend" id="ufFeatureAdoptionTrend">-</div>
              </div>
              <div class="metric-card">
                <div class="metric-card__label">Engagement Score</div>
                <div class="metric-card__value" id="ufEngagementScore">-</div>
                <div class="metric-card__trend" id="ufEngagementScoreTrend">-</div>
              </div>
            </div>

            <!-- Feature Usage Breakdown -->
            <h3 style="font-size: 14px; font-weight: 600; margin-bottom: 16px;">Feature Usage Breakdown</h3>
            <div id="featureUsageList">
              <div class="text-secondary text-center" style="padding: 24px;">Loading usage data...</div>
            </div>
          </div>
        </div>

        <!-- Roadmap Item Modal -->
        <div class="modal" id="roadmapItemModal">
          <div class="modal__overlay" onclick="closeRoadmapItemModal()"></div>
          <div class="modal__container" style="max-width: 600px;">
            <div class="modal__header">
              <h2 class="modal__title" id="roadmapItemModalTitle">Add Roadmap Item</h2>
              <button class="modal__close" onclick="closeRoadmapItemModal()">&times;</button>
            </div>
            <form id="roadmapItemForm" onsubmit="handleRoadmapItemSubmit(event)">
              <div class="modal__body">
                <input type="hidden" id="roadmapItemId" value="">

                <div class="form-group">
                  <label class="form-label" for="roadmapItemTitle">Title *</label>
                  <input type="text" id="roadmapItemTitle" class="text-input" required placeholder="e.g., Executive Dashboard">
                </div>

                <div class="form-group">
                  <label class="form-label" for="roadmapItemDescription">Description</label>
                  <textarea id="roadmapItemDescription" class="text-input" rows="3" placeholder="Brief description of this item"></textarea>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label class="form-label" for="roadmapItemCategory">Category *</label>
                    <select id="roadmapItemCategory" class="select-input" required>
                      <option value="feature">Feature</option>
                      <option value="enhancement">Enhancement</option>
                      <option value="integration">Integration</option>
                      <option value="migration">Migration</option>
                      <option value="optimization">Optimization</option>
                      <option value="other">Other</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label class="form-label" for="roadmapItemStatus">Status *</label>
                    <select id="roadmapItemStatus" class="select-input" required>
                      <option value="planned">Planned</option>
                      <option value="in_progress">In Progress</option>
                      <option value="completed">Completed</option>
                      <option value="delayed">Delayed</option>
                      <option value="cancelled">Cancelled</option>
                    </select>
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label class="form-label" for="roadmapItemStartDate">Start Date *</label>
                    <input type="date" id="roadmapItemStartDate" class="text-input" required>
                  </div>
                  <div class="form-group">
                    <label class="form-label" for="roadmapItemDuration">Duration</label>
                    <select id="roadmapItemDuration" class="select-input" onchange="updateEndDateFromDuration()">
                      <option value="">Custom end date</option>
                      <option value="1">1 month</option>
                      <option value="2">2 months</option>
                      <option value="3">3 months (1 quarter)</option>
                      <option value="6">6 months (2 quarters)</option>
                      <option value="9">9 months (3 quarters)</option>
                      <option value="12">12 months (1 year)</option>
                    </select>
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label class="form-label" for="roadmapItemEndDate">End Date *</label>
                    <input type="date" id="roadmapItemEndDate" class="text-input" required>
                  </div>
                  <div class="form-group">
                    <label class="form-label" for="roadmapItemProgress">Progress (%)</label>
                    <input type="number" id="roadmapItemProgress" class="text-input" min="0" max="100" value="0">
                  </div>
                </div>

                <div class="form-group">
                  <label class="form-label" for="roadmapItemNotes">Notes</label>
                  <textarea id="roadmapItemNotes" class="text-input" rows="2" placeholder="Additional notes or updates"></textarea>
                </div>

                <div class="form-group">
                  <label class="form-label">Dependencies</label>
                  <p style="font-size: 12px; color: var(--cds-text-secondary); margin-bottom: 8px;">Select items that must be completed before this item can start</p>
                  <div id="roadmapItemDependencies" style="max-height: 150px; overflow-y: auto; border: 1px solid var(--cds-border-subtle-01); border-radius: 4px; padding: 8px;">
                    <div style="color: var(--cds-text-secondary); font-size: 13px;">No other roadmap items available</div>
                  </div>
                </div>
              </div>
              <div class="modal__footer">
                <button type="button" class="btn btn--danger" id="roadmapItemDeleteBtn" style="display: none; margin-right: auto;" onclick="deleteRoadmapItem(document.getElementById('roadmapItemId').value)">Delete</button>
                <button type="button" class="btn btn--secondary" onclick="closeRoadmapItemModal()">Cancel</button>
                <button type="submit" class="btn btn--primary" id="roadmapItemSubmitBtn">Add Item</button>
              </div>
            </form>
          </div>
        </div>

        <!-- Create Roadmap Modal -->
        <div class="modal" id="createRoadmapModal">
          <div class="modal__overlay" onclick="closeCreateRoadmapModal()"></div>
          <div class="modal__container" style="max-width: 500px;">
            <div class="modal__header">
              <h2 class="modal__title">Create Product Roadmap</h2>
              <button class="modal__close" onclick="closeCreateRoadmapModal()">&times;</button>
            </div>
            <form id="createRoadmapForm" onsubmit="handleCreateRoadmap(event)">
              <div class="modal__body">
                <div class="form-group">
                  <label class="form-label" for="roadmapName">Roadmap Name</label>
                  <input type="text" id="roadmapName" class="text-input" value="Product Roadmap" placeholder="Product Roadmap">
                </div>

                <div class="form-group">
                  <label class="form-label" for="roadmapDescription">Description</label>
                  <textarea id="roadmapDescription" class="text-input" rows="2" placeholder="Optional description"></textarea>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label class="form-label" for="roadmapStartDate">Start Date *</label>
                    <input type="date" id="roadmapStartDate" class="text-input" required>
                  </div>
                  <div class="form-group">
                    <label class="form-label" for="roadmapEndDate">End Date *</label>
                    <input type="date" id="roadmapEndDate" class="text-input" required>
                  </div>
                </div>
              </div>
              <div class="modal__footer">
                <button type="button" class="btn btn--secondary" onclick="closeCreateRoadmapModal()">Cancel</button>
                <button type="submit" class="btn btn--primary">Create Roadmap</button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Push to TargetProcess Modal -->
      <div class="modal" id="pushToTPModal">
        <div class="modal__overlay" onclick="closePushToTPModal()"></div>
        <div class="modal__container" style="max-width: 600px;">
          <div class="modal__header">
            <h2 class="modal__title">Push Roadmap to TargetProcess</h2>
            <button class="modal__close" onclick="closePushToTPModal()">&times;</button>
          </div>
          <div class="modal__body">
            <p style="margin-bottom: 16px; color: var(--cds-text-secondary);">
              The following roadmap items will be created as Features in TargetProcess:
            </p>

            <!-- Items to Push -->
            <div id="tpPushItemsList" style="max-height: 300px; overflow-y: auto; margin-bottom: 16px;">
              <!-- Items will be populated by JS -->
            </div>

            <!-- Project Selection -->
            <div class="form-group">
              <label class="form-label" for="tpProjectSelect">Target Project *</label>
              <select id="tpProjectSelect" class="select-input" required>
                <option value="">Select a project...</option>
                <option value="roadmap">Product Roadmap</option>
                <option value="customer-features">Customer Features</option>
                <option value="platform">Platform Development</option>
              </select>
            </div>

            <!-- Options -->
            <div class="form-group">
              <label class="form-label">Options</label>
              <div style="display: flex; flex-direction: column; gap: 8px;">
                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                  <input type="checkbox" id="tpLinkToCustomer" checked>
                  <span>Link features to customer</span>
                </label>
                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                  <input type="checkbox" id="tpIncludeDates" checked>
                  <span>Include planned dates</span>
                </label>
                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                  <input type="checkbox" id="tpSkipExisting">
                  <span>Skip items already in TargetProcess</span>
                </label>
              </div>
            </div>

            <!-- Status Message -->
            <div id="tpPushStatus" style="display: none; padding: 12px; border-radius: 4px; margin-top: 16px;">
            </div>
          </div>
          <div class="modal__footer">
            <button type="button" class="btn btn--secondary" onclick="closePushToTPModal()">Cancel</button>
            <button type="button" class="btn btn--primary" id="tpPushBtn" onclick="handlePushToTP()">
              <svg width="16" height="16" viewBox="0 0 32 32" style="margin-right: 8px;"><path d="M12 10H6v2h6v6h2v-6h6v-2h-6V4h-2v6z"/><path d="M28 18v8H4V6h10V4H4a2 2 0 00-2 2v20a2 2 0 002 2h24a2 2 0 002-2v-8z"/></svg>
              Push to TargetProcess
            </button>
          </div>
        </div>
      </div>

      <!-- Risk Modal -->
      <div class="modal" id="riskModal">
        <div class="modal__overlay" onclick="closeRiskModal()"></div>
        <div class="modal__container" style="max-width: 600px;">
          <div class="modal__header">
            <h2 class="modal__title" id="riskModalTitle">Add Risk</h2>
            <button class="modal__close" onclick="closeRiskModal()">&times;</button>
          </div>
          <form id="riskForm" onsubmit="handleRiskSubmit(event)">
            <input type="hidden" id="riskId" value="">
            <div class="modal__body">
              <div class="form-group">
                <label class="form-label" for="riskTitle">Title *</label>
                <input type="text" id="riskTitle" class="form-input" required placeholder="Brief description of the risk">
              </div>

              <div class="grid grid--2" style="gap: 16px;">
                <div class="form-group">
                  <label class="form-label" for="riskSeverity">Severity</label>
                  <select id="riskSeverity" class="form-select">
                    <option value="low">Low</option>
                    <option value="medium" selected>Medium</option>
                    <option value="high">High</option>
                    <option value="critical">Critical</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label" for="riskCategory">Category</label>
                  <select id="riskCategory" class="form-select">
                    <option value="">Select category...</option>
                    <option value="adoption">Adoption</option>
                    <option value="renewal">Renewal</option>
                    <option value="technical">Technical</option>
                    <option value="relationship">Relationship</option>
                    <option value="financial">Financial</option>
                    <option value="other">Other</option>
                  </select>
                </div>
              </div>

              <div class="grid grid--2" style="gap: 16px;">
                <div class="form-group">
                  <label class="form-label" for="riskProbability">Probability (1-5)</label>
                  <select id="riskProbability" class="form-select">
                    <option value="">Not rated</option>
                    <option value="1">1 - Very Unlikely</option>
                    <option value="2">2 - Unlikely</option>
                    <option value="3">3 - Possible</option>
                    <option value="4">4 - Likely</option>
                    <option value="5">5 - Very Likely</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label" for="riskImpactRating">Impact (1-5)</label>
                  <select id="riskImpactRating" class="form-select">
                    <option value="">Not rated</option>
                    <option value="1">1 - Minimal</option>
                    <option value="2">2 - Minor</option>
                    <option value="3">3 - Moderate</option>
                    <option value="4">4 - Major</option>
                    <option value="5">5 - Severe</option>
                  </select>
                </div>
              </div>

              <div class="form-group">
                <label class="form-label" for="riskDescription">Description</label>
                <textarea id="riskDescription" class="form-textarea" rows="2" placeholder="Detailed description of the risk"></textarea>
              </div>

              <div class="form-group">
                <label class="form-label" for="riskImpact">Potential Impact</label>
                <textarea id="riskImpact" class="form-textarea" rows="2" placeholder="What could happen if this risk materializes?"></textarea>
              </div>

              <div class="form-group">
                <label class="form-label" for="riskMitigation">Mitigation Plan</label>
                <textarea id="riskMitigation" class="form-textarea" rows="2" placeholder="Steps being taken to address this risk"></textarea>
              </div>

              <div class="grid grid--2" style="gap: 16px;">
                <div class="form-group">
                  <label class="form-label" for="riskOwner">Owner</label>
                  <select id="riskOwner" class="form-select">
                    <option value="">Unassigned</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label" for="riskDueDate">Target Resolution Date</label>
                  <input type="date" id="riskDueDate" class="form-input">
                </div>
              </div>

              <!-- Status (only shown when editing) -->
              <div class="form-group" id="riskStatusGroup" style="display: none;">
                <label class="form-label" for="riskStatus">Status</label>
                <select id="riskStatus" class="form-select">
                  <option value="open">Open</option>
                  <option value="mitigating">Mitigating</option>
                  <option value="resolved">Resolved</option>
                  <option value="accepted">Accepted</option>
                </select>
              </div>
            </div>
            <div class="modal__footer">
              <button type="button" class="btn btn--ghost btn--danger" id="riskDeleteBtn" onclick="deleteRisk()" style="display: none; margin-right: auto;">Delete</button>
              <button type="button" class="btn btn--secondary" onclick="closeRiskModal()">Cancel</button>
              <button type="submit" class="btn btn--primary" id="riskSubmitBtn">Add Risk</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Resolve Risk Modal -->
      <div class="modal" id="resolveRiskModal">
        <div class="modal__overlay" onclick="closeResolveRiskModal()"></div>
        <div class="modal__container" style="max-width: 500px;">
          <div class="modal__header">
            <h2 class="modal__title">Resolve Risk</h2>
            <button class="modal__close" onclick="closeResolveRiskModal()">&times;</button>
          </div>
          <form id="resolveRiskForm" onsubmit="handleResolveRisk(event)">
            <input type="hidden" id="resolveRiskId" value="">
            <div class="modal__body">
              <p id="resolveRiskTitle" style="margin-bottom: 16px; font-weight: 500;"></p>
              <div class="form-group">
                <label class="form-label" for="resolutionNotes">Resolution Notes</label>
                <textarea id="resolutionNotes" class="form-textarea" rows="3" placeholder="Describe how the risk was resolved..."></textarea>
              </div>
            </div>
            <div class="modal__footer">
              <button type="button" class="btn btn--secondary" onclick="closeResolveRiskModal()">Cancel</button>
              <button type="submit" class="btn btn--primary">Mark as Resolved</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Task Modal -->
      <div class="modal" id="taskModal">
        <div class="modal__overlay" onclick="closeTaskModal()"></div>
        <div class="modal__container" style="max-width: 600px;">
          <div class="modal__header">
            <h2 class="modal__title" id="taskModalTitle">Add Task</h2>
            <button class="modal__close" onclick="closeTaskModal()">&times;</button>
          </div>
          <form id="taskForm" onsubmit="handleTaskSubmit(event)">
            <input type="hidden" id="taskId" value="">
            <div class="modal__body">
              <div class="form-group">
                <label class="form-label" for="taskTitle">Title *</label>
                <input type="text" id="taskTitle" class="form-input" required placeholder="Task title">
              </div>

              <div class="form-group">
                <label class="form-label" for="taskDescription">Description</label>
                <textarea id="taskDescription" class="form-textarea" rows="2" placeholder="Task details"></textarea>
              </div>

              <div class="grid grid--2" style="gap: 16px;">
                <div class="form-group">
                  <label class="form-label" for="taskPriority">Priority</label>
                  <select id="taskPriority" class="form-select">
                    <option value="low">Low</option>
                    <option value="medium" selected>Medium</option>
                    <option value="high">High</option>
                    <option value="urgent">Urgent</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label" for="taskDueDate">Due Date</label>
                  <input type="date" id="taskDueDate" class="form-input">
                </div>
              </div>

              <div class="grid grid--2" style="gap: 16px;">
                <div class="form-group">
                  <label class="form-label" for="taskAssignee">Assignee</label>
                  <select id="taskAssignee" class="form-select">
                    <option value="">Unassigned</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label" for="taskCustomer">Customer</label>
                  <select id="taskCustomer" class="form-select">
                    <option value="">No customer</option>
                  </select>
                </div>
              </div>

              <!-- Status (only shown when editing) -->
              <div class="form-group" id="taskStatusGroup" style="display: none;">
                <label class="form-label" for="taskStatus">Status</label>
                <select id="taskStatus" class="form-select">
                  <option value="open">Open</option>
                  <option value="in_progress">In Progress</option>
                  <option value="completed">Completed</option>
                  <option value="cancelled">Cancelled</option>
                </select>
              </div>
            </div>
            <div class="modal__footer">
              <button type="button" class="btn btn--ghost btn--danger" id="taskDeleteBtn" onclick="deleteTask()" style="display: none; margin-right: auto;">Delete</button>
              <button type="button" class="btn btn--secondary" onclick="closeTaskModal()">Cancel</button>
              <button type="submit" class="btn btn--primary" id="taskSubmitBtn">Add Task</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Engagement Modal -->
      <div class="modal" id="engagementModal">
        <div class="modal__overlay" onclick="closeEngagementModal()"></div>
        <div class="modal__container" style="max-width: 600px;">
          <div class="modal__header">
            <h2 class="modal__title" id="engagementModalTitle">Log Engagement</h2>
            <button class="modal__close" onclick="closeEngagementModal()">&times;</button>
          </div>
          <form id="engagementForm" onsubmit="handleEngagementSubmit(event)">
            <input type="hidden" id="engagementId" value="">
            <div class="modal__body">
              <div class="form-group">
                <label class="form-label" for="engagementType">Type *</label>
                <select id="engagementType" class="form-select" required>
                  <option value="meeting">Meeting</option>
                  <option value="call">Call</option>
                  <option value="email">Email</option>
                  <option value="qbr">QBR</option>
                  <option value="training">Training</option>
                  <option value="support">Support</option>
                  <option value="other">Other</option>
                </select>
              </div>

              <div class="form-group">
                <label class="form-label" for="engagementSubject">Subject *</label>
                <input type="text" id="engagementSubject" class="form-input" required placeholder="Brief subject of the engagement">
              </div>

              <div class="grid grid--2" style="gap: 16px;">
                <div class="form-group">
                  <label class="form-label" for="engagementDate">Date *</label>
                  <input type="date" id="engagementDate" class="form-input" required>
                </div>
                <div class="form-group">
                  <label class="form-label" for="engagementDuration">Duration (minutes)</label>
                  <input type="number" id="engagementDuration" class="form-input" min="1" placeholder="30">
                </div>
              </div>

              <div class="form-group">
                <label class="form-label" for="engagementAttendees">Attendees</label>
                <input type="text" id="engagementAttendees" class="form-input" placeholder="Names separated by commas">
              </div>

              <div class="form-group">
                <label class="form-label" for="engagementNotes">Notes</label>
                <textarea id="engagementNotes" class="form-textarea" rows="4" placeholder="Key discussion points, outcomes, action items..."></textarea>
              </div>

              <div class="form-group">
                <label class="form-label" for="engagementOutcome">Outcome</label>
                <select id="engagementOutcome" class="form-select">
                  <option value="">Select outcome...</option>
                  <option value="positive">Positive</option>
                  <option value="neutral">Neutral</option>
                  <option value="negative">Negative</option>
                  <option value="follow_up_required">Follow-up Required</option>
                </select>
              </div>
            </div>
            <div class="modal__footer">
              <button type="button" class="btn btn--ghost btn--danger" id="engagementDeleteBtn" onclick="deleteEngagement()" style="display: none; margin-right: auto;">Delete</button>
              <button type="button" class="btn btn--secondary" onclick="closeEngagementModal()">Cancel</button>
              <button type="submit" class="btn btn--primary" id="engagementSubmitBtn">Log Engagement</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Adoption Stage Modal -->
      <div class="modal" id="adoptionStageModal">
        <div class="modal__overlay" onclick="closeAdoptionStageModal()"></div>
        <div class="modal__container" style="max-width: 600px;">
          <div class="modal__header">
            <h2 class="modal__title">Update Adoption Stage</h2>
            <button class="modal__close" onclick="closeAdoptionStageModal()">&times;</button>
          </div>
          <form id="adoptionStageForm" onsubmit="handleAdoptionStageSubmit(event)">
            <div class="modal__body">
              <!-- Current Stage Display -->
              <div style="margin-bottom: 20px; padding: 12px; background: var(--cds-layer-02); border-radius: 8px;">
                <div style="font-size: 12px; color: var(--cds-text-secondary); margin-bottom: 4px;">Current Stage</div>
                <div id="currentStageDisplay" style="font-weight: 600; font-size: 16px;">-</div>
              </div>

              <!-- Stage Selector -->
              <div class="form-group">
                <label class="form-label">Select New Stage</label>
                <div class="stage-selector">
                  <div class="stage-selector__option" data-stage="onboarding" onclick="selectAdoptionStage('onboarding')">
                    <div class="stage-selector__number">1</div>
                    <div class="stage-selector__content">
                      <div class="stage-selector__name">Onboarding</div>
                      <div class="stage-selector__desc">Initial setup and configuration</div>
                    </div>
                    <div class="stage-selector__check">
                      <svg width="16" height="16" viewBox="0 0 32 32"><path d="M13 24l-9-9 1.41-1.41L13 21.17 26.59 7.58 28 9 13 24z"/></svg>
                    </div>
                  </div>
                  <div class="stage-selector__option" data-stage="adoption" onclick="selectAdoptionStage('adoption')">
                    <div class="stage-selector__number">2</div>
                    <div class="stage-selector__content">
                      <div class="stage-selector__name">Adoption</div>
                      <div class="stage-selector__desc">Active user adoption and training</div>
                    </div>
                    <div class="stage-selector__check">
                      <svg width="16" height="16" viewBox="0 0 32 32"><path d="M13 24l-9-9 1.41-1.41L13 21.17 26.59 7.58 28 9 13 24z"/></svg>
                    </div>
                  </div>
                  <div class="stage-selector__option" data-stage="value_realization" onclick="selectAdoptionStage('value_realization')">
                    <div class="stage-selector__number">3</div>
                    <div class="stage-selector__content">
                      <div class="stage-selector__name">Value Realization</div>
                      <div class="stage-selector__desc">Achieving business outcomes</div>
                    </div>
                    <div class="stage-selector__check">
                      <svg width="16" height="16" viewBox="0 0 32 32"><path d="M13 24l-9-9 1.41-1.41L13 21.17 26.59 7.58 28 9 13 24z"/></svg>
                    </div>
                  </div>
                  <div class="stage-selector__option" data-stage="expansion" onclick="selectAdoptionStage('expansion')">
                    <div class="stage-selector__number">4</div>
                    <div class="stage-selector__content">
                      <div class="stage-selector__name">Expansion</div>
                      <div class="stage-selector__desc">Growing usage and capabilities</div>
                    </div>
                    <div class="stage-selector__check">
                      <svg width="16" height="16" viewBox="0 0 32 32"><path d="M13 24l-9-9 1.41-1.41L13 21.17 26.59 7.58 28 9 13 24z"/></svg>
                    </div>
                  </div>
                  <div class="stage-selector__option" data-stage="renewal" onclick="selectAdoptionStage('renewal')">
                    <div class="stage-selector__number">5</div>
                    <div class="stage-selector__content">
                      <div class="stage-selector__name">Renewal</div>
                      <div class="stage-selector__desc">Contract renewal and optimization</div>
                    </div>
                    <div class="stage-selector__check">
                      <svg width="16" height="16" viewBox="0 0 32 32"><path d="M13 24l-9-9 1.41-1.41L13 21.17 26.59 7.58 28 9 13 24z"/></svg>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Notes -->
              <div class="form-group">
                <label class="form-label" for="adoptionStageNotes">Notes (optional)</label>
                <textarea id="adoptionStageNotes" class="form-textarea" rows="2" placeholder="Reason for stage change..."></textarea>
              </div>
            </div>
            <div class="modal__footer">
              <button type="button" class="btn btn--secondary" onclick="closeAdoptionStageModal()">Cancel</button>
              <button type="submit" class="btn btn--primary" id="adoptionStageSubmitBtn">Update Stage</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Edit Account Details Modal -->
      <div class="modal" id="editAccountModal">
        <div class="modal__overlay" onclick="closeEditAccountModal()"></div>
        <div class="modal__container" style="max-width: 600px;">
          <div class="modal__header">
            <h2 class="modal__title">Edit Account Details</h2>
            <button class="modal__close" onclick="closeEditAccountModal()">&times;</button>
          </div>
          <form id="editAccountForm" onsubmit="handleEditAccountSubmit(event)">
            <div class="modal__body">
              <div class="grid grid--2" style="gap: 16px;">
                <div class="form-group">
                  <label class="form-label" for="editAccountManager">Account Manager</label>
                  <select id="editAccountManager" class="form-select">
                    <option value="">Select Account Manager</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label" for="editCsmOwner">CSM Owner</label>
                  <select id="editCsmOwner" class="form-select">
                    <option value="">Select CSM Owner</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label" for="editPartner">Partner</label>
                  <select id="editPartner" class="form-select">
                    <option value="">No Partner</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label" for="editIndustry">Industry</label>
                  <select id="editIndustry" class="form-select">
                    <option value="">Select industry</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label" for="editEmployees">Employee Count</label>
                  <select id="editEmployees" class="form-select">
                    <option value="">Select range</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label" for="editContractStart">Contract Start Date</label>
                  <input type="date" id="editContractStart" class="form-input">
                </div>
                <div class="form-group">
                  <label class="form-label" for="editContractEnd">Contract End Date</label>
                  <input type="date" id="editContractEnd" class="form-input">
                </div>
                <div class="form-group">
                  <label class="form-label" for="editRenewalDate">Renewal Date</label>
                  <input type="date" id="editRenewalDate" class="form-input">
                </div>
                <div class="form-group">
                  <label class="form-label" for="editArr">ARR ($)</label>
                  <input type="number" id="editArr" class="form-input" placeholder="e.g., 450000" step="1000">
                </div>
              </div>
            </div>
            <div class="modal__footer">
              <button type="button" class="btn btn--secondary" onclick="closeEditAccountModal()">Cancel</button>
              <button type="submit" class="btn btn--primary" id="editAccountSubmitBtn">Save Changes</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Edit Health Score Modal -->
      <div class="modal" id="editHealthModal">
        <div class="modal__overlay" onclick="closeEditHealthModal()"></div>
        <div class="modal__container" style="max-width: 500px;">
          <div class="modal__header">
            <h2 class="modal__title">Edit Health Score</h2>
            <button class="modal__close" onclick="closeEditHealthModal()">&times;</button>
          </div>
          <form id="editHealthForm" onsubmit="handleEditHealthSubmit(event)">
            <div class="modal__body">
              <div class="form-group">
                <label class="form-label" for="editHealthStatus">Health Status *</label>
                <select id="editHealthStatus" class="form-select" required>
                  <option value="green">Green - Healthy</option>
                  <option value="yellow">Yellow - Needs Attention</option>
                  <option value="red">Red - At Risk</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label" for="editHealthScore">Health Score (0-100)</label>
                <input type="number" id="editHealthScore" class="form-input" min="0" max="100" placeholder="e.g., 85">
                <span class="form-hint">Overall health score from 0 to 100</span>
              </div>
              <div class="form-group">
                <label class="form-label" for="editHealthTrend">Trend</label>
                <select id="editHealthTrend" class="form-select">
                  <option value="">Select trend</option>
                  <option value="improving">Improving</option>
                  <option value="stable">Stable</option>
                  <option value="declining">Declining</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label" for="editHealthOverrideReason">Override Reason</label>
                <textarea id="editHealthOverrideReason" class="form-input" rows="3" placeholder="Explain why the health status was manually set (optional)"></textarea>
                <span class="form-hint">Document the reason for any manual health status override</span>
              </div>
            </div>
            <div class="modal__footer">
              <button type="button" class="btn btn--secondary" onclick="closeEditHealthModal()">Cancel</button>
              <button type="submit" class="btn btn--primary" id="editHealthSubmitBtn">Save Changes</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Meeting Note Modal -->
      <div class="modal" id="meetingNoteModal">
        <div class="modal__overlay" onclick="closeMeetingNoteModal()"></div>
        <div class="modal__container" style="max-width: 600px;">
          <div class="modal__header">
            <h2 class="modal__title" id="meetingNoteModalTitle">Add Meeting Note</h2>
            <button class="modal__close" onclick="closeMeetingNoteModal()">&times;</button>
          </div>
          <form id="meetingNoteForm" onsubmit="handleMeetingNoteSubmit(event)">
            <input type="hidden" id="meetingNoteId" value="">
            <div class="modal__body">
              <div class="grid grid--2" style="gap: 16px;">
                <div class="form-group">
                  <label class="form-label" for="meetingNoteDate">Meeting Date *</label>
                  <input type="date" id="meetingNoteDate" class="form-input" required>
                </div>
                <div class="form-group">
                  <label class="form-label" for="meetingNoteTitle">Title *</label>
                  <input type="text" id="meetingNoteTitle" class="form-input" required placeholder="e.g., Weekly Check-in">
                </div>
              </div>
              <div class="form-group">
                <label class="form-label" for="meetingNoteAttendees">Attendees</label>
                <input type="text" id="meetingNoteAttendees" class="form-input" placeholder="e.g., John Doe, Jane Smith">
                <span class="form-hint">Comma-separated list of attendees</span>
              </div>
              <div class="form-group">
                <label class="form-label" for="meetingNoteNotes">Notes</label>
                <textarea id="meetingNoteNotes" class="form-input" rows="4" placeholder="Key discussion points..."></textarea>
              </div>
              <div class="form-group">
                <label class="form-label" for="meetingNoteActionItems">Action Items</label>
                <textarea id="meetingNoteActionItems" class="form-input" rows="3" placeholder="List action items from the meeting..."></textarea>
              </div>
              <div class="form-group">
                <label class="form-label" for="meetingNoteNextSteps">Next Steps</label>
                <textarea id="meetingNoteNextSteps" class="form-input" rows="2" placeholder="Follow-up actions and next meeting plans..."></textarea>
              </div>
            </div>
            <div class="modal__footer">
              <button type="button" class="btn btn--secondary" onclick="closeMeetingNoteModal()">Cancel</button>
              <button type="submit" class="btn btn--primary" id="meetingNoteSubmitBtn">Save Note</button>
            </div>
          </form>
        </div>
      </div>

      <!-- View Meeting Note Modal -->
      <div class="modal" id="viewMeetingNoteModal">
        <div class="modal__overlay" onclick="closeViewMeetingNoteModal()"></div>
        <div class="modal__container" style="max-width: 600px;">
          <div class="modal__header">
            <h2 class="modal__title" id="viewMeetingNoteTitle">Meeting Note</h2>
            <button class="modal__close" onclick="closeViewMeetingNoteModal()">&times;</button>
          </div>
          <div class="modal__body" id="viewMeetingNoteContent">
            <!-- Content populated by JavaScript -->
          </div>
          <div class="modal__footer">
            <button type="button" class="btn btn--ghost" id="deleteMeetingNoteBtn" onclick="deleteMeetingNote()">Delete</button>
            <div style="flex: 1;"></div>
            <button type="button" class="btn btn--secondary" onclick="createTaskFromMeetingNote()">
              <svg width="14" height="14" viewBox="0 0 32 32" fill="currentColor" style="margin-right: 4px;"><path d="M17 15V7h-2v8H7v2h8v8h2v-8h8v-2h-8z"/></svg>
              Add Task
            </button>
            <button type="button" class="btn btn--secondary" onclick="closeViewMeetingNoteModal()">Close</button>
            <button type="button" class="btn btn--primary" id="editMeetingNoteBtn" onclick="editMeetingNote()">Edit</button>
          </div>
        </div>
      </div>

      <!-- Drop Action Modal (for choosing engagement vs document) -->
      <div class="modal" id="dropActionModal">
        <div class="modal__overlay" onclick="closeDropActionModal()"></div>
        <div class="modal__container" style="max-width: 500px;">
          <div class="modal__header">
            <h2 class="modal__title">Save Dropped Item</h2>
            <button class="modal__close" onclick="closeDropActionModal()">&times;</button>
          </div>
          <div class="modal__body">
            <p style="margin-bottom: 16px;" id="dropActionDescription">How would you like to save this item?</p>

            <!-- Preview of dropped content -->
            <div class="drop-preview" id="dropPreview" style="background: var(--cds-layer-02); padding: 12px; border-radius: 4px; margin-bottom: 16px;">
              <div id="dropPreviewContent"></div>
            </div>

            <div class="drop-action-options">
              <button type="button" class="drop-action-btn" onclick="saveDropAsEngagement()">
                <div class="drop-action-btn__icon">
                  <svg width="24" height="24" viewBox="0 0 32 32"><path d="M17.74 30L16 29l4-7h6a2 2 0 002-2V8a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2h9v2H6a4 4 0 01-4-4V8a4 4 0 014-4h20a4 4 0 014 4v12a4 4 0 01-4 4h-4.84z"/></svg>
                </div>
                <div class="drop-action-btn__content">
                  <strong>Create Engagement</strong>
                  <span>Log as an email, meeting, or call interaction</span>
                </div>
              </button>
              <button type="button" class="drop-action-btn" onclick="saveDropAsDocument()">
                <div class="drop-action-btn__icon">
                  <svg width="24" height="24" viewBox="0 0 32 32"><path d="M25.7 9.3l-7-7A.91.91 0 0018 2H8a2 2 0 00-2 2v24a2 2 0 002 2h16a2 2 0 002-2V10a.91.91 0 00-.3-.7zM18 4.4l5.6 5.6H18zM24 28H8V4h8v6a2 2 0 002 2h6z"/></svg>
                </div>
                <div class="drop-action-btn__content">
                  <strong>Save as Document</strong>
                  <span>Store in customer documents for reference</span>
                </div>
              </button>
            </div>
          </div>
          <div class="modal__footer">
            <button type="button" class="btn btn--ghost" onclick="closeDropActionModal()">Cancel</button>
          </div>
        </div>
      </div>

      <!-- Browser Warning Modal -->
      <div class="modal" id="browserWarningModal">
        <div class="modal__overlay" onclick="closeBrowserWarningModal()"></div>
        <div class="modal__container" style="max-width: 500px;">
          <div class="modal__header">
            <h2 class="modal__title">Browser Compatibility Note</h2>
            <button class="modal__close" onclick="closeBrowserWarningModal()">&times;</button>
          </div>
          <div class="modal__body">
            <div style="display: flex; align-items: flex-start; gap: 12px; margin-bottom: 16px;">
              <svg width="24" height="24" viewBox="0 0 32 32" fill="#f1c21b"><path d="M16 2C8.3 2 2 8.3 2 16s6.3 14 14 14 14-6.3 14-14S23.7 2 16 2zm-1 6h2v12h-2V8zm1 17c-.8 0-1.5-.7-1.5-1.5S15.2 22 16 22s1.5.7 1.5 1.5S16.8 25 16 25z"/></svg>
              <div>
                <p style="margin-bottom: 12px;"><strong>Direct drag-and-drop from Mac Outlook may not work in this browser.</strong></p>
                <p style="margin-bottom: 12px;">This is a known limitation with Chrome and Firefox on macOS.</p>
                <p><strong>Workaround:</strong> First drag the email or calendar event to your Desktop to create a file, then drag that file here.</p>
              </div>
            </div>
            <div style="background: var(--cds-layer-02); padding: 12px; border-radius: 4px;">
              <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                <input type="checkbox" id="dontShowBrowserWarning" style="width: 16px; height: 16px;">
                <span>Don't show this message again</span>
              </label>
            </div>
          </div>
          <div class="modal__footer">
            <button type="button" class="btn btn--primary" onclick="closeBrowserWarningModal()">Got it</button>
          </div>
        </div>
      </div>
    </main>

    <!-- Mobile Bottom Navigation -->
    <nav class="bottom-nav">
      <ul class="bottom-nav__items">
        <li>
          <a href="index.html" class="bottom-nav__link">
            <svg viewBox="0 0 32 32"><path d="M16 2L2 12v18h10V18h8v12h10V12L16 2z"/></svg>
            Home
          </a>
        </li>
        <li>
          <a href="customers.html" class="bottom-nav__link active">
            <svg viewBox="0 0 32 32"><path d="M28 10h-6V6c0-1.1-.9-2-2-2h-8c-1.1 0-2 .9-2 2v4H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h24c1.1 0 2-.9 2-2V12c0-1.1-.9-2-2-2z"/></svg>
            Customers
          </a>
        </li>
        <li>
          <a href="#" class="bottom-nav__link">
            <svg viewBox="0 0 32 32"><path d="M17 15V7h-2v8H7v2h8v8h2v-8h8v-2h-8z"/></svg>
            Add
          </a>
        </li>
        <li>
          <a href="tasks.html" class="bottom-nav__link">
            <svg viewBox="0 0 32 32"><path d="M14 21.5l-5-4.96L7.59 18 14 24.35 25.41 13 24 11.59 14 21.5z"/></svg>
            Tasks
          </a>
        </li>
        <li>
          <a href="#" class="bottom-nav__link">
            <svg viewBox="0 0 32 32"><path d="M4 6h24v2H4zm0 9h24v2H4zm0 9h24v2H4z"/></svg>
            More
          </a>
        </li>
      </ul>
    </nav>
  </div>

  <!-- Chat Widget -->
  <button class="chat-trigger" id="chatTrigger" onclick="toggleChatPanel()" title="CS Assistant">
    <svg viewBox="0 0 24 24" fill="currentColor">
      <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H5.17L4 17.17V4h16v12z"/>
      <path d="M7 9h10v2H7zm0-3h10v2H7zm0 6h7v2H7z"/>
    </svg>
  </button>

  <div class="chat-panel" id="chatPanel">
    <div class="chat-header">
      <div class="chat-header__title">
        <div class="chat-header__status"></div>
        <h3>CS Assistant</h3>
      </div>
      <div class="chat-header__actions">
        <button class="chat-header__btn" onclick="clearChat()" title="Clear chat">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
          </svg>
        </button>
        <button class="chat-header__btn" onclick="toggleChatPanel()" title="Close">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 6L6 18M6 6l12 12"/>
          </svg>
        </button>
      </div>
    </div>
    <div class="chat-messages" id="chatMessages"></div>
    <div class="chat-input-area">
      <div class="chat-input-wrapper">
        <textarea id="chatInput" placeholder="Ask about customers, tasks, risks..." rows="1"></textarea>
      </div>
      <button id="chatSendBtn" onclick="sendMessage()" title="Send">
        <svg viewBox="0 0 24 24" fill="currentColor">
          <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- Assessment Report Modal -->
  <div class="modal" id="assessmentReportModal">
    <div class="modal__overlay" onclick="closeAssessmentReportModal()"></div>
    <div class="modal__container" style="max-width: 900px; max-height: 90vh;">
      <div class="modal__header">
        <h2 class="modal__title">Assessment Report</h2>
        <div style="display: flex; gap: 8px; align-items: center;">
          <button class="btn btn--secondary btn--sm" onclick="exportAssessmentExcel()" title="Export to Excel">
            <svg width="16" height="16" viewBox="0 0 32 32" fill="currentColor" style="margin-right: 4px;">
              <path d="M28.781 4.405h-10.13V2.018L2 4.588v22.527l16.651 2.868v-3.538h10.13A1.162 1.162 0 0030 25.349V5.5a1.162 1.162 0 00-1.219-1.095zm-12.282 2.81h1.544v5.395h-1.544zm0 6.165h1.544v5.395h-1.544zm-9.252 8.312l2.574-4.308-2.326-4.2h2.596l1.198 2.544c.11.237.193.44.251.606h.018c.088-.235.175-.44.261-.618l1.286-2.532h2.392l-2.392 4.262 2.492 4.246h-2.591l-1.426-2.858a2.078 2.078 0 01-.157-.387h-.023a1.81 1.81 0 01-.158.387l-1.405 2.858zm9.252-.77h1.544v5.395h-1.544zm2.522-13.707h1.544v5.395h-1.544zm0 6.165h1.544v5.395h-1.544zm0 6.165h1.544v5.395h-1.544zm2.522-12.33h1.544v5.395h-1.544zm0 6.165h1.544v5.395h-1.544zm0 6.165h1.544v5.395h-1.544zm2.522-12.33H26v5.395h-1.544zm0 6.165H26v5.395h-1.544zm0 6.165H26v5.395h-1.544z"/>
            </svg>
            Excel
          </button>
          <button class="btn btn--secondary btn--sm" onclick="exportAssessmentFillablePdf()" title="Export Fillable PDF">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 4px;">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6zM6 20V4h7v5h5v11H6zm2-6h8v2H8v-2zm0-3h8v2H8v-2zm0 6h5v2H8v-2z"/>
            </svg>
            Fillable PDF
          </button>
          <button class="btn btn--secondary btn--sm" onclick="document.getElementById('pdfImportInput').click()" title="Import Filled PDF">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 4px;">
              <path d="M9 16h6v-6h4l-7-7-7 7h4v6zm-4 2h14v2H5v-2z"/>
            </svg>
            Import PDF
          </button>
          <input type="file" id="pdfImportInput" accept=".pdf" style="display:none" onchange="handlePdfImport(event)">
          <button class="btn btn--secondary btn--sm" onclick="printAssessmentReport()" title="Print / Save as PDF">
            <svg width="16" height="16" viewBox="0 0 32 32" fill="currentColor" style="margin-right: 4px;">
              <path d="M28 9h-4V5H8v4H4a2 2 0 00-2 2v10a2 2 0 002 2h4v4h16v-4h4a2 2 0 002-2V11a2 2 0 00-2-2zM10 7h12v2H10zm12 18H10v-6h12zm4-8h-2v-2h2z"/>
            </svg>
            Print/PDF
          </button>
          <button class="modal__close" onclick="closeAssessmentReportModal()">&times;</button>
        </div>
      </div>
      <div class="modal__body" id="assessmentReportContent" style="max-height: calc(90vh - 120px); overflow-y: auto;">
        <div class="text-secondary text-center" style="padding: 48px;">Loading report...</div>
      </div>
    </div>
  </div>

  <!-- Recommendation Modal -->
  <div class="modal" id="recommendationModal">
    <div class="modal__overlay" onclick="closeRecommendationModal()"></div>
    <div class="modal__container" style="max-width: 600px;">
      <div class="modal__header">
        <h2 class="modal__title" id="recommendationModalTitle">Add Recommendation</h2>
        <button class="modal__close" onclick="closeRecommendationModal()">&times;</button>
      </div>
      <form id="recommendationForm" onsubmit="event.preventDefault(); saveRecommendation();">
        <div class="modal__body">
          <div class="form__group">
            <label class="form__label" for="recTitle">Title <span class="text-danger">*</span></label>
            <input type="text" id="recTitle" class="form__input" required placeholder="Enter recommendation title">
          </div>

          <div class="form__group">
            <label class="form__label" for="recDescription">Description</label>
            <textarea id="recDescription" class="form__input form__textarea" rows="6" placeholder="Enter recommendation details. Supports markdown: **bold**, *italic*, [link](url), - list items"></textarea>
            <span class="form__helper">Supports markdown formatting: **bold**, *italic*, [link](url), - lists</span>
          </div>

          <div class="form__row">
            <div class="form__group" style="flex: 1;">
              <label class="form__label" for="recPriority">Priority</label>
              <select id="recPriority" class="form__input">
                <option value="high">High</option>
                <option value="medium" selected>Medium</option>
                <option value="low">Low</option>
              </select>
            </div>

            <div class="form__group" style="flex: 1;">
              <label class="form__label" for="recCategory">Category</label>
              <input type="text" id="recCategory" class="form__input" placeholder="e.g., Process, Technology, People">
            </div>
          </div>
        </div>

        <div class="modal__footer">
          <button type="button" class="btn btn--ghost" onclick="closeRecommendationModal()">Cancel</button>
          <button type="submit" class="btn btn--primary">Save Recommendation</button>
        </div>
      </form>
    </div>
  </div>

  <script src="js/auth.js?v=5"></script>
  <script src="js/api.js?v=16"></script>
  <script src="js/chat.js?v=1"></script>
  <script src="js/table-sort.js?v=1"></script>
  <script src="js/customer-detail.js?v=65"></script>
</body>
</html>
