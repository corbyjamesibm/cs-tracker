<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Customer Detail - CS Tracker</title>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css?v=29">
  <link rel="stylesheet" href="css/chat.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-sankey@0.12.0/dist/chartjs-chart-sankey.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <style>
    .customer-header {
      background: linear-gradient(135deg, #161616 0%, #393939 100%);
      color: white;
      padding: var(--cds-spacing-06);
      margin: 0 calc(-1 * var(--cds-spacing-06)) var(--cds-spacing-05);
    }
    .customer-header__top {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: var(--cds-spacing-05);
    }
    .customer-header__name {
      font-size: 2rem;
      font-weight: 600;
      margin-bottom: var(--cds-spacing-02);
    }
    .customer-header__meta {
      display: flex;
      gap: var(--cds-spacing-05);
      font-size: 0.875rem;
      opacity: 0.8;
    }
    .customer-header__stats {
      display: flex;
      gap: var(--cds-spacing-07);
    }
    .customer-header__stat {
      text-align: center;
    }
    .customer-header__stat-value {
      font-size: 1.5rem;
      font-weight: 600;
    }
    .customer-header__stat-label {
      font-size: 0.75rem;
      opacity: 0.7;
      text-transform: uppercase;
    }
    .section-title {
      font-size: 1.125rem;
      font-weight: 600;
      margin-bottom: var(--cds-spacing-04);
      display: flex;
      align-items: center;
      gap: var(--cds-spacing-03);
    }
    .adoption-stage {
      display: flex;
      gap: var(--cds-spacing-02);
      margin-bottom: var(--cds-spacing-05);
    }
    .adoption-stage__step {
      flex: 1;
      text-align: center;
      padding: var(--cds-spacing-03);
      background: var(--cds-layer-02);
      border-radius: 4px;
      font-size: 0.75rem;
      position: relative;
    }
    .adoption-stage__step::after {
      content: '';
      position: absolute;
      right: -8px;
      top: 50%;
      transform: translateY(-50%);
      border: 6px solid transparent;
      border-left-color: var(--cds-layer-02);
      z-index: 1;
    }
    .adoption-stage__step:last-child::after {
      display: none;
    }
    .adoption-stage__step.completed {
      background: var(--cds-support-success);
      color: white;
    }
    .adoption-stage__step.completed::after {
      border-left-color: var(--cds-support-success);
    }
    .adoption-stage__step.current {
      background: var(--cds-interactive);
      color: white;
    }
    .adoption-stage__step.current::after {
      border-left-color: var(--cds-interactive);
    }
    .checklist {
      list-style: none;
    }
    .checklist__item {
      display: flex;
      align-items: center;
      gap: var(--cds-spacing-03);
      padding: var(--cds-spacing-03) 0;
      border-bottom: 1px solid var(--cds-border-subtle-01);
    }
    .checklist__checkbox {
      width: 20px;
      height: 20px;
      border: 2px solid var(--cds-border-strong-01);
      border-radius: 2px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    .checklist__checkbox.checked {
      background: var(--cds-support-success);
      border-color: var(--cds-support-success);
      color: white;
    }
    .checklist__checkbox.in-progress {
      background: var(--cds-support-warning);
      border-color: var(--cds-support-warning);
    }
    .contact-card {
      display: flex;
      align-items: center;
      gap: var(--cds-spacing-04);
      padding: var(--cds-spacing-04);
      background: var(--cds-layer-02);
      border-radius: 4px;
      margin-bottom: var(--cds-spacing-03);
    }
    .contact-card__info {
      flex: 1;
    }
    .contact-card__name {
      font-weight: 500;
    }
    .contact-card__role {
      font-size: 0.75rem;
      color: var(--cds-text-secondary);
    }
    .contact-card__actions {
      display: flex;
      gap: var(--cds-spacing-02);
    }
    @media (max-width: 768px) {
      .customer-header {
        padding: var(--cds-spacing-05);
        margin: calc(-1 * var(--cds-spacing-05));
        margin-bottom: var(--cds-spacing-04);
      }
      .customer-header__top {
        flex-direction: column;
        gap: var(--cds-spacing-04);
      }
      .customer-header__name {
        font-size: 1.5rem;
      }
      .customer-header__stats {
        gap: var(--cds-spacing-05);
        flex-wrap: wrap;
      }
      .adoption-stage {
        flex-direction: column;
      }
      .adoption-stage__step::after {
        display: none;
      }
    }
    /* Recommendation Cards */
    .recommendation-card {
      background: var(--cds-layer-02);
      border: 1px solid var(--cds-border-subtle-01);
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 12px;
      transition: box-shadow 0.2s ease;
    }
    .recommendation-card:hover {
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .recommendation-card.accepted {
      opacity: 0.6;
      background: var(--cds-layer-01);
    }
    .recommendation-card__header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 8px;
    }
    .recommendation-card__priority {
      background: var(--cds-interactive);
      color: white;
      font-size: 12px;
      font-weight: 600;
      padding: 4px 8px;
      border-radius: 4px;
    }
    .recommendation-card__title {
      font-weight: 600;
      font-size: 15px;
      margin-bottom: 4px;
    }
    .recommendation-card__meta {
      display: flex;
      gap: 12px;
      font-size: 13px;
      color: var(--cds-text-secondary);
      margin-bottom: 12px;
    }
    .recommendation-card__description {
      font-size: 14px;
      color: var(--cds-text-secondary);
      margin-bottom: 12px;
    }
    .recommendation-card__footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .recommendation-card__improvement {
      font-size: 12px;
      color: var(--cds-support-success);
    }
    .recommendation-card__actions {
      display: flex;
      gap: 8px;
    }
    .weak-dimension-chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: var(--cds-support-error-inverse);
      color: var(--cds-support-error);
      font-size: 13px;
      padding: 6px 12px;
      border-radius: 16px;
      font-weight: 500;
    }
    .weak-dimension-chip__score {
      background: rgba(0,0,0,0.1);
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- Side Navigation -->
    <nav class="side-nav" id="sideNav">
      <div class="side-nav__header">
        <div class="side-nav__logo">CS</div>
        <span class="side-nav__title">CS Tracker</span>
      </div>
      <ul class="side-nav__items">
        <li class="side-nav__item">
          <a href="index.html" class="side-nav__link">
            <svg viewBox="0 0 32 32"><path d="M16 2L2 12v18h10V18h8v12h10V12L16 2zm12 26h-6V16H10v12H4V13.21l12-9 12 9V28z"/></svg>
            <span>Dashboard</span>
          </a>
        </li>
        <li class="side-nav__item">
          <a href="customers.html" class="side-nav__link active">
            <svg viewBox="0 0 32 32"><path d="M28 10h-6V6c0-1.1-.9-2-2-2h-8c-1.1 0-2 .9-2 2v4H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h24c1.1 0 2-.9 2-2V12c0-1.1-.9-2-2-2zM12 6h8v4h-8V6zm16 20H4V12h24v14z"/></svg>
            <span>Customers</span>
          </a>
        </li>
        <li class="side-nav__item">
          <a href="tasks.html" class="side-nav__link">
            <svg viewBox="0 0 32 32"><path d="M14 21.5l-5-4.96L7.59 18 14 24.35 25.41 13 24 11.59 14 21.5z"/><path d="M16 2C8.27 2 2 8.27 2 16s6.27 14 14 14 14-6.27 14-14S23.73 2 16 2zm0 26C9.38 28 4 22.62 4 16S9.38 4 16 4s12 5.38 12 12-5.38 12-12 12z"/></svg>
            <span>Tasks</span>
          </a>
        </li>
        <li class="side-nav__divider"></li>
        <li class="side-nav__item">
          <a href="reports.html" class="side-nav__link">
            <svg viewBox="0 0 32 32"><path d="M10 18H6v8h4v-8zm12-8h-4v16h4V10zm-6 6h-4v10h4V16z"/></svg>
            <span>Reports</span>
          </a>
        </li>
        <li class="side-nav__item">
          <a href="admin.html" class="side-nav__link">
            <svg viewBox="0 0 32 32"><path d="M27 16.76V16v-.77l1.92-1.68a2 2 0 00.4-2.4l-2-3.46a2 2 0 00-1.94-1 2 2 0 00-.64.1l-2.43.82a11.35 11.35 0 00-1.31-.75l-.51-2.52a2 2 0 00-2-1.61h-4a2 2 0 00-2 1.61l-.51 2.52a11.48 11.48 0 00-1.32.75l-2.38-.86a2 2 0 00-.68-.09 2 2 0 00-1.72 1l-2 3.46a2 2 0 00.4 2.4l1.92 1.68V16v.77l-1.92 1.68a2 2 0 00-.4 2.4l2 3.46a2 2 0 00 1.72 1 2 2 0 00.68-.09l2.42-.82a11.35 11.35 0 001.31.75l.51 2.52a2 2 0 002 1.61h4a2 2 0 002-1.61l.51-2.52a11.48 11.48 0 001.32-.75l2.42.82a2 2 0 00.64.09 2 2 0 001.72-1l2-3.46a2 2 0 00-.4-2.4zM16 22a6 6 0 116-6 6 6 0 01-6 6z"/></svg>
            <span>Admin</span>
          </a>
        </li>
      </ul>
      <button class="side-nav__toggle" id="navToggleBtn" title="Collapse menu">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="11 17 6 12 11 7"></polyline>
          <polyline points="18 17 13 12 18 7"></polyline>
        </svg>
        <span class="side-nav__toggle-text">Collapse</span>
      </button>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Header -->
      <header class="header">
        <div class="header__left">
          <button class="hamburger" onclick="toggleNav()">
            <span></span>
            <span></span>
            <span></span>
          </button>
          <a href="customers.html" style="color: var(--cds-text-secondary); text-decoration: none; display: flex; align-items: center; gap: 8px;">
            <svg width="16" height="16" viewBox="0 0 32 32"><path d="M10 16L20 6l1.4 1.4-8.6 8.6 8.6 8.6L20 26z"/></svg>
            Back to Customers
          </a>
        </div>
        <div class="header__right">
          <button class="btn btn--tertiary">
            <svg width="16" height="16" viewBox="0 0 32 32" fill="currentColor"><path d="M4 4v2h2.586L2 10.586 3.414 12 8 7.414V10h2V4H4zm18 0v6h2V7.414L28.586 12 30 10.586 25.414 6H28V4H22z"/></svg>
            Export to PPT
          </button>
          <button class="btn btn--primary" onclick="openTaskModal()">
            <svg width="16" height="16" viewBox="0 0 32 32" fill="currentColor"><path d="M17 15V7h-2v8H7v2h8v8h2v-8h8v-2h-8z"/></svg>
            Add Task
          </button>
          <div class="user-menu">
            <div class="avatar user-avatar">CJ</div>
          </div>
        </div>
      </header>

      <!-- Page Content -->
      <div class="page-content">
        <!-- Customer Header -->
        <div class="customer-header">
          <div class="customer-header__top">
            <div>
              <h1 class="customer-header__name" id="customerName">Loading...</h1>
              <div class="customer-header__meta">
                <span id="customerSfId">-</span>
                <span>|</span>
                <span id="customerProducts">-</span>
                <span>|</span>
                <span id="customerSince"></span>
              </div>
            </div>
            <div style="display: flex; gap: 12px;">
              <span class="health-badge health-badge--gray" id="healthBadge" style="font-size: 14px; padding: 8px 16px;">-</span>
              <span class="tag tag--blue" id="partnerBadge" style="font-size: 14px; padding: 8px 16px; display: none;"></span>
            </div>
          </div>
          <div class="customer-header__stats">
            <div class="customer-header__stat">
              <div class="customer-header__stat-value" id="statArr">-</div>
              <div class="customer-header__stat-label">ARR</div>
            </div>
            <div class="customer-header__stat">
              <div class="customer-header__stat-value" id="statRenewal">-</div>
              <div class="customer-header__stat-label">Renewal</div>
            </div>
            <div class="customer-header__stat">
              <div class="customer-header__stat-value" id="statAdoption">-</div>
              <div class="customer-header__stat-label">Adoption</div>
            </div>
            <div class="customer-header__stat">
              <div class="customer-header__stat-value" id="statDaysToRenewal">-</div>
              <div class="customer-header__stat-label">Days to Renewal</div>
            </div>
          </div>
        </div>

        <!-- Tabs -->
        <nav class="tabs">
          <ul class="tabs__list">
            <li><a href="#" class="tabs__tab active">Overview</a></li>
            <li><a href="#" class="tabs__tab">Usage Framework</a></li>
            <li><a href="#" class="tabs__tab">Engagements</a></li>
            <li><a href="#" class="tabs__tab">Tasks</a></li>
            <li><a href="#" class="tabs__tab">Risks</a></li>
            <li><a href="#" class="tabs__tab">Assessments</a></li>
            <li><a href="#" class="tabs__tab">TargetProcess</a></li>
            <li><a href="#" class="tabs__tab">Roadmap</a></li>
            <li><a href="#" class="tabs__tab">Recommendations</a></li>
            <li><a href="#" class="tabs__tab">Flow</a></li>
            <li><a href="#" class="tabs__tab">Documents</a></li>
          </ul>
        </nav>

        <div class="grid grid--2">
          <!-- Left Column -->
          <div>
            <!-- Account Details -->
            <div class="card">
              <div class="card__header" style="margin-bottom: 16px;">
                <h2 class="section-title" style="margin-bottom: 0;">
                  <svg width="20" height="20" viewBox="0 0 32 32"><path d="M28 10h-6V6c0-1.1-.9-2-2-2h-8c-1.1 0-2 .9-2 2v4H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h24c1.1 0 2-.9 2-2V12c0-1.1-.9-2-2-2z"/></svg>
                  Account Details
                </h2>
                <button class="btn btn--ghost btn--icon" onclick="openEditAccountModal()" title="Edit Account Details">
                  <svg width="16" height="16" viewBox="0 0 32 32" fill="currentColor"><path d="M2 26h28v2H2zM25.4 9c.8-.8.8-2 0-2.8l-3.6-3.6c-.8-.8-2-.8-2.8 0l-15 15V24h6.4l15-15zm-5-5L24 7.6l-3 3L17.4 7l3-3zM6 22v-3.6l10-10 3.6 3.6-10 10H6z"/></svg>
                </button>
              </div>
              <div class="grid grid--2" style="gap: 16px;">
                <div>
                  <div class="form-label">Account Manager</div>
                  <div style="font-weight: 500;" id="accountManager">-</div>
                </div>
                <div>
                  <div class="form-label">CSM Owner</div>
                  <div style="font-weight: 500;" id="csmOwner">-</div>
                </div>
                <div>
                  <div class="form-label">Industry</div>
                  <div id="customerIndustry">-</div>
                </div>
                <div>
                  <div class="form-label">Employees</div>
                  <div id="customerEmployees">-</div>
                </div>
                <div>
                  <div class="form-label">Contract Start</div>
                  <div id="contractStart">-</div>
                </div>
                <div>
                  <div class="form-label">Contract End</div>
                  <div id="contractEnd">-</div>
                </div>
              </div>
            </div>

            <!-- Adoption Journey -->
            <div class="card adoption-journey-card" onclick="openAdoptionStageModal()">
              <div class="adoption-journey-header">
                <h2 class="section-title" style="margin-bottom: 0;">
                  <svg width="20" height="20" viewBox="0 0 32 32"><path d="M12 29a1 1 0 01-.92-.62L6.33 17H2v-2h5a1 1 0 01.92.62L12 25.28l8.06-21.63A1 1 0 0121 3a1 1 0 01.93.68L25.74 15H30v2h-5a1 1 0 01-.95-.68L21 7.04l-8.05 21.34A1 1 0 0112 29z"/></svg>
                  Adoption Journey
                </h2>
                <span class="adoption-journey-edit-hint">
                  <svg width="14" height="14" viewBox="0 0 32 32" fill="currentColor"><path d="M2 26h28v2H2zM25.4 9c.8-.8.8-2 0-2.8l-3.6-3.6c-.8-.8-2-.8-2.8 0l-15 15V24h6.4l15-15zm-5-5L24 7.6l-3 3L17.4 7l3-3zM6 22v-3.6l10-10 3.6 3.6-10 10H6z"/></svg>
                  Click to edit
                </span>
              </div>
              <div class="adoption-stage">
                <div class="adoption-stage__step" id="stage-onboarding">
                  <strong>Onboarding</strong>
                  <div>-</div>
                </div>
                <div class="adoption-stage__step" id="stage-adoption">
                  <strong>Adoption</strong>
                  <div>-</div>
                </div>
                <div class="adoption-stage__step" id="stage-value_realization">
                  <strong>Value Realization</strong>
                  <div>-</div>
                </div>
                <div class="adoption-stage__step" id="stage-expansion">
                  <strong>Expansion</strong>
                  <div>-</div>
                </div>
                <div class="adoption-stage__step" id="stage-renewal">
                  <strong>Renewal</strong>
                  <div>-</div>
                </div>
              </div>
            </div>

            <!-- Use Case Tracker -->
            <div class="card">
              <div class="card__header">
                <h2 class="section-title" style="margin-bottom: 0;">
                  <svg width="20" height="20" viewBox="0 0 32 32"><path d="M14 21.5l-5-4.96L7.59 18 14 24.35 25.41 13 24 11.59 14 21.5z"/></svg>
                  Use Case Tracker
                </h2>
                <span id="useCaseProgress" class="tag tag--blue">Loading...</span>
              </div>
              <div class="progress mb-4" style="height: 12px;">
                <div id="useCaseProgressBar" class="progress__bar progress__bar--success" style="width: 0%;"></div>
              </div>

              <!-- Solution Area Tabs -->
              <div id="solutionAreaTabs" class="tabs mb-4" style="border-bottom: 1px solid var(--cds-border-subtle); display: flex; gap: 0;">
                <button class="tab-btn active" data-area="WFM" style="padding: 8px 16px; border: none; background: none; cursor: pointer; border-bottom: 2px solid var(--cds-interactive); font-weight: 500;">WFM</button>
                <button class="tab-btn" data-area="HPM" style="padding: 8px 16px; border: none; background: none; cursor: pointer; color: var(--cds-text-secondary);">HPM</button>
                <button class="tab-btn" data-area="EAP" style="padding: 8px 16px; border: none; background: none; cursor: pointer; color: var(--cds-text-secondary);">EAP</button>
                <button class="tab-btn" data-area="POM" style="padding: 8px 16px; border: none; background: none; cursor: pointer; color: var(--cds-text-secondary);">POM</button>
                <button class="tab-btn" data-area="FPM" style="padding: 8px 16px; border: none; background: none; cursor: pointer; color: var(--cds-text-secondary);">FPM</button>
              </div>

              <!-- Use Cases Container -->
              <div id="useCasesContainer">
                <div class="text-secondary text-center" style="padding: 24px;">Loading use cases...</div>
              </div>
            </div>
          </div>

          <!-- Right Column -->
          <div>
            <!-- Health Score -->
            <div class="card">
              <div class="card__header" style="padding: 0 0 16px 0; border-bottom: none;">
                <h2 class="section-title" style="margin-bottom: 0;">
                  <svg width="20" height="20" viewBox="0 0 32 32"><path d="M16 2a14 14 0 1014 14A14 14 0 0016 2zm0 26a12 12 0 1112-12 12 12 0 01-12 12z"/><path d="M16 8a8 8 0 108 8 8 8 0 00-8-8zm0 14a6 6 0 116-6 6 6 0 01-6 6z"/></svg>
                  Health Score
                </h2>
                <button class="btn btn--ghost btn--small" onclick="openEditHealthModal()" title="Edit Health Score">
                  <svg width="16" height="16" viewBox="0 0 32 32"><path d="M2 26h28v2H2zM25.4 9c.8-.8.8-2 0-2.8l-3.6-3.6c-.8-.8-2-.8-2.8 0l-15 15V24h6.4l15-15zm-5-5L24 7.6l-3 3L17.4 7l3-3zM6 22v-3.6l10-10 3.6 3.6-10 10H6z"/></svg>
                </button>
              </div>
              <div id="healthScoreContainer" class="flex gap-5 flex-center">
                <div style="text-align: center;">
                  <div id="healthScoreCircle" style="width: 100px; height: 100px; border-radius: 50%; background: conic-gradient(var(--health-green) 0deg 306deg, var(--cds-background-hover) 306deg 360deg); display: flex; align-items: center; justify-content: center;">
                    <div id="healthScoreValue" style="width: 70px; height: 70px; border-radius: 50%; background: white; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: 600; color: var(--health-green);">-</div>
                  </div>
                  <div class="text-secondary mt-2" style="font-size: 12px;">Score</div>
                </div>
                <div style="flex: 1;">
                  <div class="flex flex-between mb-2">
                    <span class="text-secondary">30-day trend</span>
                    <span id="healthTrend" class="text-success">-</span>
                  </div>
                  <div class="flex flex-between mb-2">
                    <span class="text-secondary">Product Usage</span>
                    <span id="productUsage">-</span>
                  </div>
                  <div class="flex flex-between mb-2">
                    <span class="text-secondary">Engagement</span>
                    <span id="engagementLevel">-</span>
                  </div>
                  <div class="flex flex-between">
                    <span class="text-secondary">Support Tickets</span>
                    <span id="supportTickets">-</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- SPM Assessment Summary -->
            <div class="card" id="spmAssessmentSummaryCard">
              <div class="card__header">
                <h2 class="section-title" style="margin-bottom: 0;">
                  <svg width="20" height="20" viewBox="0 0 32 32"><path d="M16 2a14 14 0 1014 14A14 14 0 0016 2zm0 26a12 12 0 1112-12 12 12 0 01-12 12z"/><path d="M16 10a6 6 0 106 6 6 6 0 00-6-6zm0 10a4 4 0 114-4 4 4 0 01-4 4z"/></svg>
                  SPM Maturity
                </h2>
                <a href="#" class="btn btn--ghost" onclick="event.preventDefault(); showSection('spmAssessment');">View Details</a>
              </div>
              <div id="spmAssessmentSummaryContainer">
                <div class="text-secondary text-center" style="padding: 16px;">Loading...</div>
              </div>
            </div>

            <!-- Key Contacts -->
            <div class="card">
              <div class="card__header">
                <h2 class="section-title" style="margin-bottom: 0;">
                  <svg width="20" height="20" viewBox="0 0 32 32"><path d="M16 4a5 5 0 11-5 5 5 5 0 015-5m0-2a7 7 0 107 7 7 7 0 00-7-7zM26 30h-2v-5a5 5 0 00-5-5h-6a5 5 0 00-5 5v5H6v-5a7 7 0 017-7h6a7 7 0 017 7z"/></svg>
                  Key Contacts
                </h2>
                <button class="btn btn--ghost btn--icon">
                  <svg width="16" height="16" viewBox="0 0 32 32"><path d="M17 15V7h-2v8H7v2h8v8h2v-8h8v-2h-8z"/></svg>
                </button>
              </div>
              <div id="keyContactsContainer">
                <div class="text-secondary text-center" style="padding: 16px;">Loading contacts...</div>
              </div>
            </div>

            <!-- Open Tasks -->
            <div class="card">
              <div class="card__header">
                <h2 class="section-title" style="margin-bottom: 0;">
                  <svg width="20" height="20" viewBox="0 0 32 32"><path d="M14 21.5l-5-4.96L7.59 18 14 24.35 25.41 13 24 11.59 14 21.5z"/></svg>
                  Open Tasks
                </h2>
                <span id="openTasksCount" class="tag">- Tasks</span>
              </div>
              <div id="openTasksContainer">
                <div class="text-secondary text-center" style="padding: 16px;">Loading tasks...</div>
              </div>
            </div>

            <!-- Open Risks -->
            <div class="card">
              <div class="card__header">
                <h2 class="section-title" style="margin-bottom: 0;">
                  <svg width="20" height="20" viewBox="0 0 32 32"><path d="M16 2a14 14 0 1014 14A14 14 0 0016 2zm0 26a12 12 0 1112-12 12 12 0 01-12 12z"/><path d="M15 8h2v11h-2zm1 14a1.5 1.5 0 101.5 1.5A1.5 1.5 0 0016 22z"/></svg>
                  Open Risks
                </h2>
                <span id="openRisksCount" class="tag">- Risks</span>
              </div>
              <div id="openRisksContainer">
                <div class="text-secondary text-center" style="padding: 16px;">Loading risks...</div>
              </div>
            </div>

            <!-- Recent Engagements -->
            <div class="card">
              <div class="card__header">
                <h2 class="section-title" style="margin-bottom: 0;">
                  <svg width="20" height="20" viewBox="0 0 32 32"><path d="M17.74 30L16 29l4-7h6a2 2 0 002-2V8a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2h9v2H6a4 4 0 01-4-4V8a4 4 0 014-4h20a4 4 0 014 4v12a4 4 0 01-4 4h-4.84z"/></svg>
                  Recent Engagements
                </h2>
                <button class="btn btn--ghost">View All</button>
              </div>
              <div id="recentEngagementsContainer" class="timeline">
                <div class="text-secondary text-center" style="padding: 16px;">Loading engagements...</div>
              </div>
            </div>

            <!-- Meeting Notes -->
            <div class="card">
              <div class="card__header">
                <h2 class="section-title" style="margin-bottom: 0;">
                  <svg width="20" height="20" viewBox="0 0 32 32"><path d="M28 4H4a2 2 0 00-2 2v20a2 2 0 002 2h24a2 2 0 002-2V6a2 2 0 00-2-2zM4 26V6h24v20z"/><path d="M6 12h20v2H6zM6 18h20v2H6zM6 24h12v2H6z"/></svg>
                  Meeting Notes
                </h2>
                <button class="btn btn--primary btn--icon" onclick="openMeetingNoteModal()">
                  <svg width="16" height="16" viewBox="0 0 32 32"><path d="M17 15V7h-2v8H7v2h8v8h2v-8h8v-2h-8z"/></svg>
                  Add Note
                </button>
              </div>
              <div id="meetingNotesContainer">
                <div class="text-secondary text-center" style="padding: 16px;">Loading meeting notes...</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Tasks Section (shown when Tasks tab is active) -->
        <div class="card mt-5" id="tasksSection" style="display: none;">
          <div class="card__header">
            <h2 class="section-title" style="margin-bottom: 0;">
              <svg width="20" height="20" viewBox="0 0 32 32"><path d="M14 21.5l-5-4.96L7.59 18 14 24.35 25.41 13 24 11.59 14 21.5z"/><path d="M16 2C8.27 2 2 8.27 2 16s6.27 14 14 14 14-6.27 14-14S23.73 2 16 2zm0 26C9.38 28 4 22.62 4 16S9.38 4 16 4s12 5.38 12 12-5.38 12-12 12z"/></svg>
              Customer Tasks
            </h2>
            <div class="flex gap-3">
              <span class="tag" id="tasksTabCount">0 Tasks</span>
              <button class="btn btn--primary btn--icon" onclick="openTaskModal()">
                <svg width="16" height="16" viewBox="0 0 32 32"><path d="M17 15V7h-2v8H7v2h8v8h2v-8h8v-2h-8z"/></svg>
                Add Task
              </button>
            </div>
          </div>
          <div id="tasksTabContainer" style="padding: 16px;">
            <div class="text-secondary text-center">Loading tasks...</div>
          </div>
        </div>

        <!-- Risks Section (shown when Risks tab is active) -->
        <div class="card mt-5" id="risksSection" style="display: none;">
          <div class="card__header">
            <h2 class="section-title" style="margin-bottom: 0;">
              <svg width="20" height="20" viewBox="0 0 32 32"><path d="M16 2a14 14 0 1014 14A14 14 0 0016 2zm0 26a12 12 0 1112-12 12 12 0 01-12 12z"/><path d="M15 8h2v11h-2zm1 14a1.5 1.5 0 101.5 1.5A1.5 1.5 0 0016 22z"/></svg>
              Customer Risks
            </h2>
            <div class="flex gap-3">
              <span class="tag" id="risksTabCount">0 Risks</span>
              <button class="btn btn--primary btn--icon" onclick="openRiskModal()">
                <svg width="16" height="16" viewBox="0 0 32 32"><path d="M17 15V7h-2v8H7v2h8v8h2v-8h8v-2h-8z"/></svg>
                Add Risk
              </button>
            </div>
          </div>
          <div id="risksTabContainer" style="padding: 16px;">
            <div class="text-secondary text-center">Loading risks...</div>
          </div>
        </div>

        <!-- SPM Assessment Section (shown when SPM Assessment tab is active) -->
        <div class="card mt-5" id="spmAssessmentSection" style="display: none;">
          <div class="card__header">
            <h2 class="section-title" style="margin-bottom: 0;">
              <svg width="20" height="20" viewBox="0 0 32 32"><path d="M16 22a6 6 0 116-6 6 6 0 01-6 6zm0-10a4 4 0 104 4 4 4 0 00-4-4z"/><path d="M28 16a12 12 0 10-12 12 12 12 0 0012-12zM16 26a10 10 0 1110-10 10.011 10.011 0 01-10 10z"/></svg>
              SPM Maturity Assessment
            </h2>
            <div class="flex gap-3">
              <button class="btn btn--secondary" onclick="openUploadAssessmentModal()">
                <svg width="16" height="16" viewBox="0 0 32 32" fill="currentColor"><path d="M6 17l1.41 1.41L15 10.83V30h2V10.83l7.59 7.58L26 17 16 7 6 17z"/><path d="M6 8V4h20v4h2V4a2 2 0 00-2-2H6a2 2 0 00-2 2v4z"/></svg>
                Upload Results
              </button>
              <button class="btn btn--primary" onclick="openNewAssessmentModal()">
                <svg width="16" height="16" viewBox="0 0 32 32" fill="currentColor"><path d="M17 15V7h-2v8H7v2h8v8h2v-8h8v-2h-8z"/></svg>
                New Assessment
              </button>
            </div>
          </div>

          <!-- No Assessment State -->
          <div id="noAssessmentState" style="text-align: center; padding: 48px 24px;">
            <svg width="64" height="64" viewBox="0 0 32 32" style="color: var(--cds-text-secondary); margin-bottom: 16px;"><path d="M16 22a6 6 0 116-6 6 6 0 01-6 6zm0-10a4 4 0 104 4 4 4 0 00-4-4z"/><path d="M28 16a12 12 0 10-12 12 12 12 0 0012-12zM16 26a10 10 0 1110-10 10.011 10.011 0 01-10 10z"/></svg>
            <h3 style="margin-bottom: 8px; font-size: 16px;">No Assessment Yet</h3>
            <p style="color: var(--cds-text-secondary); margin-bottom: 16px;">Complete an SPM maturity assessment to track this customer's progress.</p>
            <button class="btn btn--primary" onclick="openNewAssessmentModal()">Start Assessment</button>
          </div>

          <!-- Assessment Content (hidden until assessment exists) -->
          <div id="assessmentContent" style="display: none;">
            <div class="grid grid--2" style="gap: 24px;">
              <!-- Left: Radar Chart -->
              <div>
                <div class="assessment-chart-container" id="radarChartContainer" onclick="openRadarChartModal()" style="cursor: pointer;" title="Click to enlarge">
                  <canvas id="spmRadarChart"></canvas>
                </div>
                <!-- Comparison Legend -->
                <div id="comparisonLegend" class="comparison-legend" style="display: none;"></div>
                <div class="assessment-overall-score" id="overallScoreDisplay">
                  <span class="score-value" id="overallScoreValue">-</span>
                  <span class="score-label">/ 5.0 Overall Maturity</span>
                </div>
              </div>

              <!-- Right: Dimension Scores -->
              <div>
                <h3 style="font-size: 14px; font-weight: 600; margin-bottom: 16px;">Dimension Scores</h3>
                <div id="dimensionScoreCards" class="dimension-scores-grid">
                  <!-- Cards populated by JS -->
                </div>

                <div style="margin-top: 24px;">
                  <h3 style="font-size: 14px; font-weight: 600; margin-bottom: 16px;">Assessment Details</h3>
                  <div class="assessment-details">
                    <div class="flex flex-between mb-2">
                      <span class="text-secondary">Assessment Date</span>
                      <span id="assessmentDate">-</span>
                    </div>
                    <div class="flex flex-between mb-2">
                      <span class="text-secondary">Template Version</span>
                      <span id="assessmentVersion">-</span>
                    </div>
                    <div class="flex flex-between mb-2">
                      <span class="text-secondary">Status</span>
                      <span id="assessmentStatus">-</span>
                    </div>
                    <div class="flex flex-between">
                      <span class="text-secondary">Completed By</span>
                      <span id="assessmentCompletedBy">-</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Trend Comparison (if history exists) -->
            <div id="assessmentTrendSection" style="display: none; margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--cds-border-subtle-01);">
              <h3 style="font-size: 14px; font-weight: 600; margin-bottom: 16px;">Progress vs Previous Assessment</h3>
              <div id="trendIndicators" class="grid grid--5 gap-3">
                <!-- Trend indicators populated by JS -->
              </div>
            </div>

            <!-- Assessment History -->
            <div style="margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--cds-border-subtle-01);">
              <div class="flex flex-between items-center mb-4">
                <h3 style="font-size: 14px; font-weight: 600; margin-bottom: 0;">Assessment History</h3>
                <button class="btn btn--ghost btn--sm" onclick="openEditScoresModal()" id="editScoresBtn" style="display: none;">
                  <svg width="14" height="14" viewBox="0 0 32 32" fill="currentColor"><path d="M2 26h28v2H2zM25.4 9c.8-.8.8-2 0-2.8l-3.6-3.6c-.8-.8-2-.8-2.8 0l-15 15V24h6.4l15-15zm-5-5L24 7.6l-3 3L17.4 7l3-3zM6 22v-3.6l10-10 3.6 3.6-10 10H6z"/></svg>
                  Edit Scores
                </button>
              </div>
              <div class="data-table-container">
                <table class="data-table" id="assessmentHistoryTable">
                  <thead id="assessmentHistoryTableHead">
                    <tr>
                      <th style="width: 50px;">Compare</th>
                      <th>Date</th>
                      <th>Version</th>
                      <th>Overall Score</th>
                      <th>Change</th>
                      <th>Status</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="assessmentHistoryTableBody">
                    <tr>
                      <td colspan="7" class="text-center text-secondary">Loading history...</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Assessment Targets Section -->
            <div id="assessmentTargetsSection" style="margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--cds-border-subtle-01);">
              <div class="flex flex-between items-center mb-4">
                <h3 style="font-size: 14px; font-weight: 600; margin-bottom: 0;">
                  <svg width="16" height="16" viewBox="0 0 32 32" fill="currentColor" style="vertical-align: middle; margin-right: 6px;"><path d="M16 2a14 14 0 1014 14A14.016 14.016 0 0016 2zm0 26a12 12 0 1112-12 12.014 12.014 0 01-12 12z"/><path d="M16 8a8 8 0 108 8 8.009 8.009 0 00-8-8zm0 14a6 6 0 116-6 6.007 6.007 0 01-6 6z"/><circle cx="16" cy="16" r="3"/></svg>
                  Assessment Targets
                </h3>
                <button class="btn btn--primary btn--sm" onclick="openTargetModal()">
                  <svg width="14" height="14" viewBox="0 0 32 32" fill="currentColor"><path d="M17 15V7h-2v8H7v2h8v8h2v-8h8v-2h-8z"/></svg>
                  Set Target
                </button>
              </div>
              <div id="targetsListContainer">
                <div class="text-secondary text-center" style="padding: 24px;">No targets set. Set a target to track progress toward goals.</div>
              </div>
            </div>

            <!-- Audit Trail Section (initially hidden) -->
            <div id="auditTrailSection" style="display: none; margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--cds-border-subtle-01);">
              <div class="flex flex-between items-center mb-4">
                <h3 style="font-size: 14px; font-weight: 600; margin-bottom: 0;">
                  <svg width="16" height="16" viewBox="0 0 32 32" fill="currentColor" style="vertical-align: middle; margin-right: 6px;"><path d="M16 2C8.3 2 2 8.3 2 16s6.3 14 14 14 14-6.3 14-14S23.7 2 16 2zm0 26C9.4 28 4 22.6 4 16S9.4 4 16 4s12 5.4 12 12-5.4 12-12 12z"/><path d="M17 16.59V8h-2v9.41l4.3 4.3 1.4-1.42z"/></svg>
                  Change History
                </h3>
                <button class="btn btn--ghost btn--sm" onclick="hideAuditTrail()">Hide</button>
              </div>
              <div id="auditTrailContainer" class="audit-trail">
                <div class="text-secondary text-center" style="padding: 24px;">Loading audit trail...</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Target Modal -->
        <div class="modal" id="targetModal">
          <div class="modal__overlay" onclick="closeTargetModal()"></div>
          <div class="modal__container" style="max-width: 700px; max-height: 90vh;">
            <div class="modal__header">
              <h2 class="modal__title" id="targetModalTitle">Set Assessment Target</h2>
              <button class="modal__close" onclick="closeTargetModal()">&times;</button>
            </div>
            <div class="modal__body" style="max-height: calc(90vh - 160px); overflow-y: auto;">
              <form id="targetForm">
                <div class="form-group">
                  <label class="form-label" for="targetName">Target Name *</label>
                  <input type="text" id="targetName" class="form-input" placeholder="e.g., Q4 2024 Goals" required>
                </div>
                <div class="form-group">
                  <label class="form-label" for="targetDescription">Description</label>
                  <textarea id="targetDescription" class="form-textarea" rows="2" placeholder="Describe this target..."></textarea>
                </div>
                <div class="form-group">
                  <label class="form-label" for="targetDate">Target Date</label>
                  <input type="date" id="targetDate" class="form-input">
                </div>
                <div class="form-group">
                  <label class="form-label">Target Scores by Dimension</label>
                  <p class="form-hint">Set the target score (1-5) for each dimension</p>
                  <div id="targetDimensionScores" class="target-dimension-scores">
                    <div class="text-secondary">Loading dimensions...</div>
                  </div>
                </div>
                <div class="form-group">
                  <label class="form-label">Overall Target</label>
                  <div class="flex items-center gap-3">
                    <input type="number" id="targetOverallScore" class="form-input" style="width: 100px;" min="1" max="5" step="0.1" placeholder="Auto">
                    <span class="text-secondary">Leave empty to auto-calculate from dimension scores</span>
                  </div>
                </div>
              </form>
            </div>
            <div class="modal__footer">
              <button type="button" class="btn btn--secondary" onclick="closeTargetModal()">Cancel</button>
              <button type="button" class="btn btn--primary" onclick="saveTarget()" id="saveTargetBtn">Save Target</button>
            </div>
          </div>
        </div>

        <!-- Edit Scores Modal -->
        <div class="modal" id="editScoresModal">
          <div class="modal__overlay" onclick="closeEditScoresModal()"></div>
          <div class="modal__container" style="max-width: 900px; max-height: 90vh;">
            <div class="modal__header">
              <h2 class="modal__title">Edit Assessment Scores</h2>
              <button class="modal__close" onclick="closeEditScoresModal()">&times;</button>
            </div>
            <div class="modal__body" style="max-height: calc(90vh - 160px); overflow-y: auto;">
              <div class="notification notification--warning mb-4">
                <svg width="20" height="20" viewBox="0 0 32 32" fill="var(--cds-support-warning)"><path d="M16 2C8.3 2 2 8.3 2 16s6.3 14 14 14 14-6.3 14-14S23.7 2 16 2zm-1 7h2v10h-2V9zm1 16c-.8 0-1.5-.7-1.5-1.5S15.2 22 16 22s1.5.7 1.5 1.5S16.8 25 16 25z"/></svg>
                <div>
                  <strong>Editing scores will be tracked in the audit trail.</strong>
                  <p style="margin: 4px 0 0 0; font-size: 13px;">You must provide a reason for any changes.</p>
                </div>
              </div>
              <div id="editScoresContainer">
                <div class="text-secondary text-center" style="padding: 24px;">Loading responses...</div>
              </div>
            </div>
            <div class="modal__footer" style="justify-content: space-between;">
              <button type="button" class="btn btn--ghost" onclick="viewAuditTrail()">
                <svg width="14" height="14" viewBox="0 0 32 32" fill="currentColor"><path d="M16 2C8.3 2 2 8.3 2 16s6.3 14 14 14 14-6.3 14-14S23.7 2 16 2zm0 26C9.4 28 4 22.6 4 16S9.4 4 16 4s12 5.4 12 12-5.4 12-12 12z"/><path d="M17 16.59V8h-2v9.41l4.3 4.3 1.4-1.42z"/></svg>
                View Change History
              </button>
              <div>
                <button type="button" class="btn btn--secondary" onclick="closeEditScoresModal()">Cancel</button>
                <button type="button" class="btn btn--primary" onclick="saveEditedScores()" id="saveEditedScoresBtn">Save Changes</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Edit Reason Modal -->
        <div class="modal" id="editReasonModal">
          <div class="modal__overlay" onclick="closeEditReasonModal()"></div>
          <div class="modal__container" style="max-width: 400px;">
            <div class="modal__header">
              <h2 class="modal__title">Reason for Change</h2>
              <button class="modal__close" onclick="closeEditReasonModal()">&times;</button>
            </div>
            <div class="modal__body">
              <div class="form-group">
                <label class="form-label" for="editChangeReason">Why are you making this change? *</label>
                <textarea id="editChangeReason" class="form-textarea" rows="3" placeholder="e.g., Correcting data entry error, Updated based on new information..." required></textarea>
              </div>
            </div>
            <div class="modal__footer">
              <button type="button" class="btn btn--secondary" onclick="closeEditReasonModal()">Cancel</button>
              <button type="button" class="btn btn--primary" onclick="confirmScoreEdit()">Confirm</button>
            </div>
          </div>
        </div>

        <!-- Radar Chart Modal -->
        <div class="modal" id="radarChartModal">
          <div class="modal__overlay" onclick="closeRadarChartModal()"></div>
          <div class="modal__container" style="max-width: 800px; max-height: 90vh;">
            <div class="modal__header">
              <h2 class="modal__title">SPM Maturity Assessment</h2>
              <button class="modal__close" onclick="closeRadarChartModal()">&times;</button>
            </div>
            <div class="modal__body" style="padding: 24px;">
              <div style="width: 100%; height: 500px; position: relative;">
                <canvas id="spmRadarChartLarge"></canvas>
              </div>
              <div class="modal__footer" style="margin-top: 16px; justify-content: center;">
                <button type="button" class="btn btn--secondary" onclick="copyRadarChartToClipboard()">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 6px;">
                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                  </svg>
                  Copy to Clipboard
                </button>
                <button type="button" class="btn btn--secondary" onclick="downloadRadarChart()">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 6px;">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="7 10 12 15 17 10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                  </svg>
                  Download
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- New Assessment Modal -->
        <div class="modal" id="newAssessmentModal">
          <div class="modal__overlay" onclick="closeNewAssessmentModal()"></div>
          <div class="modal__container" style="max-width: 800px; max-height: 90vh;">
            <div class="modal__header">
              <h2 class="modal__title" id="assessmentModalTitle">Select Assessment Template</h2>
              <button class="modal__close" onclick="closeNewAssessmentModal()">&times;</button>
            </div>
            <div class="modal__body" style="max-height: calc(90vh - 160px); overflow-y: auto;">
              <!-- Template Selection Step -->
              <div id="templateSelectionStep">
                <p class="text-secondary mb-4">Choose an assessment template to begin:</p>
                <div id="templateList" class="template-list">
                  <div class="text-secondary text-center" style="padding: 24px;">Loading templates...</div>
                </div>
              </div>

              <!-- Question Step (hidden initially) -->
              <div id="questionStep" style="display: none;">
                <!-- Progress Indicator -->
                <div class="assessment-wizard-progress">
                  <div class="wizard-progress__bar">
                    <div class="wizard-progress__fill" id="wizardProgressBar" style="width: 0%;"></div>
                  </div>
                  <div class="wizard-progress__text">
                    <span id="currentDimensionName">Loading...</span>
                    <span id="questionProgress">0 / 0</span>
                  </div>
                </div>

                <!-- Question Display -->
                <div class="assessment-question-container">
                  <h3 id="currentQuestionNumber" style="font-size: 12px; color: var(--cds-text-secondary); margin-bottom: 8px;">Question 1</h3>
                  <p id="currentQuestionText" style="font-size: 16px; font-weight: 500; margin-bottom: 24px;">Loading question...</p>

                  <!-- Rating Options -->
                  <div id="ratingOptions" class="rating-scale">
                    <!-- Options populated by JS -->
                  </div>

                  <!-- Notes -->
                  <div class="form-group" style="margin-top: 16px;">
                    <label class="form-label" for="questionNotes">Notes (optional)</label>
                    <textarea id="questionNotes" class="form-textarea" rows="2" placeholder="Add any comments about this rating..."></textarea>
                  </div>
                </div>
              </div>
            </div>
            <div class="modal__footer" style="justify-content: space-between;">
              <button type="button" class="btn btn--secondary" id="saveCloseBtn" onclick="saveAndCloseAssessment()" style="display: none;">
                Save & Close
              </button>
              <div class="flex gap-2">
                <button type="button" class="btn btn--ghost" id="backToTemplatesBtn" onclick="showTemplateSelection()" style="display: none;">
                  <svg width="16" height="16" viewBox="0 0 32 32"><path d="M10 16L20 6l1.4 1.4-8.6 8.6 8.6 8.6L20 26z"/></svg>
                  Back
                </button>
                <button type="button" class="btn btn--ghost" id="prevQuestionBtn" onclick="previousQuestion()" style="display: none;" disabled>
                  <svg width="16" height="16" viewBox="0 0 32 32"><path d="M10 16L20 6l1.4 1.4-8.6 8.6 8.6 8.6L20 26z"/></svg>
                  Previous
                </button>
                <button type="button" class="btn btn--primary" id="nextQuestionBtn" onclick="nextQuestion()" style="display: none;">
                  Next
                  <svg width="16" height="16" viewBox="0 0 32 32"><path d="M22 16L12 26l-1.4-1.4 8.6-8.6-8.6-8.6L12 6z"/></svg>
                </button>
                <button type="button" class="btn btn--primary" id="submitAssessmentBtn" onclick="submitAssessment()" style="display: none;">
                  Complete Assessment
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Upload Assessment Modal -->
        <div class="modal" id="uploadAssessmentModal">
          <div class="modal__overlay" onclick="closeUploadAssessmentModal()"></div>
          <div class="modal__container" style="max-width: 500px;">
            <div class="modal__header">
              <h2 class="modal__title">Upload Assessment Results</h2>
              <button class="modal__close" onclick="closeUploadAssessmentModal()">&times;</button>
            </div>
            <form id="uploadAssessmentForm" onsubmit="handleAssessmentUpload(event)">
              <div class="modal__body">
                <div class="notification notification--info mb-4">
                  <svg width="20" height="20" viewBox="0 0 32 32" fill="var(--cds-support-info)"><path d="M16 2C8.3 2 2 8.3 2 16s6.3 14 14 14 14-6.3 14-14S23.7 2 16 2zm-1 7h2v2h-2V9zm4 14h-6v-2h2v-5h-2v-2h4v7h2v2z"/></svg>
                  <span>Upload an Excel file with completed assessment scores.</span>
                </div>

                <div class="form-group">
                  <label class="form-label" for="assessmentUploadDate">Assessment Date</label>
                  <input type="date" id="assessmentUploadDate" class="form-input">
                </div>

                <div class="form-group">
                  <label class="form-label" for="assessmentUploadFile">Excel File *</label>
                  <input type="file" id="assessmentUploadFile" class="form-input" accept=".xlsx,.xls" required>
                  <span class="form-hint">File should contain Question Number and Score columns.</span>
                </div>
              </div>
              <div class="modal__footer">
                <button type="button" class="btn btn--secondary" onclick="closeUploadAssessmentModal()">Cancel</button>
                <button type="submit" class="btn btn--primary" id="uploadAssessmentBtn">Upload</button>
              </div>
            </form>
          </div>
        </div>

        <!-- Use Case Status Modal -->
        <div class="modal" id="useCaseStatusModal">
          <div class="modal__overlay" onclick="closeUseCaseStatusModal()"></div>
          <div class="modal__container" style="max-width: 600px;">
            <div class="modal__header">
              <h2 class="modal__title">Update Use Case Status</h2>
              <button class="modal__close" onclick="closeUseCaseStatusModal()">&times;</button>
            </div>
            <div class="modal__body">
              <div style="margin-bottom: 24px;">
                <h3 id="useCaseModalName" style="font-size: 16px; font-weight: 600; margin-bottom: 8px;">Use Case Name</h3>
                <p id="useCaseModalDescription" class="text-secondary" style="font-size: 14px; line-height: 1.5;">Description</p>
              </div>

              <div class="form-group">
                <label class="form-label">Status</label>
                <div class="use-case-status-options">
                  <div class="status-option" data-status="not_started" onclick="selectUseCaseStatus('not_started')">
                    <div class="status-option__icon status-option__icon--not-started"></div>
                    <div>
                      <div class="status-option__label">Not Started</div>
                      <div class="status-option__description">Use case has not been implemented</div>
                    </div>
                  </div>
                  <div class="status-option" data-status="in_progress" onclick="selectUseCaseStatus('in_progress')">
                    <div class="status-option__icon status-option__icon--in-progress"></div>
                    <div>
                      <div class="status-option__label">In Progress</div>
                      <div class="status-option__description">Currently being implemented</div>
                    </div>
                  </div>
                  <div class="status-option" data-status="implemented" onclick="selectUseCaseStatus('implemented')">
                    <div class="status-option__icon status-option__icon--implemented">
                      <svg width="12" height="12" viewBox="0 0 32 32" fill="currentColor"><path d="M13 24l-9-9 1.41-1.41L13 21.17 26.59 7.58 28 9 13 24z"/></svg>
                    </div>
                    <div>
                      <div class="status-option__label">Implemented</div>
                      <div class="status-option__description">Use case is live and in use</div>
                    </div>
                  </div>
                  <div class="status-option" data-status="optimized" onclick="selectUseCaseStatus('optimized')">
                    <div class="status-option__icon status-option__icon--optimized">
                      <svg width="12" height="12" viewBox="0 0 32 32" fill="currentColor"><path d="M30 10.68l-2-1.15L22 4H10L4 9.53l-2 1.15 14 8.09zm-5.18-.68L16 13.35 7.18 10 10.89 6h10.22zM2 14.43L16 22.54l14-8.11v1.14L16 23.68 2 15.57zM2 18.43L16 26.54l14-8.11v1.14L16 27.68 2 19.57z"/></svg>
                    </div>
                    <div>
                      <div class="status-option__label">Optimized</div>
                      <div class="status-option__description">Fully optimized and delivering value</div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label class="form-label" for="useCaseNotes">Notes</label>
                <textarea id="useCaseNotes" class="form-textarea" rows="3" placeholder="Add notes about this use case implementation..."></textarea>
              </div>

              <!-- Adoption History Chart -->
              <div style="margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--cds-border-subtle-01);">
                <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 16px;">Adoption Trend</h4>
                <div class="use-case-history-chart">
                  <canvas id="useCaseHistoryChart"></canvas>
                </div>
              </div>
            </div>
            <div class="modal__footer">
              <button type="button" class="btn btn--secondary" onclick="closeUseCaseStatusModal()">Cancel</button>
              <button type="button" class="btn btn--primary" id="saveUseCaseStatusBtn" onclick="saveUseCaseStatus()">Save Status</button>
            </div>
          </div>
        </div>

        <!-- Product Roadmap Section -->
        <div class="card mt-5" id="roadmapSection">
          <div class="card__header">
            <h2 class="section-title" style="margin-bottom: 0;">
              <svg width="20" height="20" viewBox="0 0 32 32"><path d="M28 4H4a2 2 0 00-2 2v20a2 2 0 002 2h24a2 2 0 002-2V6a2 2 0 00-2-2zM4 26V6h24v20z"/><path d="M6 12h4v2H6zm0 5h4v2H6zm0 5h4v2H6zm6-10h14v2H12zm0 5h14v2H12zm0 5h14v2H12z"/></svg>
              Product Roadmap
            </h2>
            <div class="flex gap-3">
              <span class="tag" id="roadmapTimeframe" style="display: none;">-</span>
              <button class="btn btn--ghost btn--icon" id="addRoadmapItemBtn" title="Add Item" onclick="openRoadmapItemModal()" style="display: none;">
                <svg width="16" height="16" viewBox="0 0 32 32"><path d="M17 15V7h-2v8H7v2h8v8h2v-8h8v-2h-8z"/></svg>
              </button>
              <button class="btn btn--ghost btn--icon" id="pushToTPBtn" title="Push to TargetProcess" onclick="openPushToTPModal()" style="display: none;">
                <svg width="16" height="16" viewBox="0 0 32 32"><path d="M12 10H6v2h6v6h2v-6h6v-2h-6V4h-2v6z"/><path d="M28 18v8H4V6h10V4H4a2 2 0 00-2 2v20a2 2 0 002 2h24a2 2 0 002-2v-8z"/></svg>
              </button>
              <button class="btn btn--ghost btn--icon" id="roadmapSettingsBtn" title="Roadmap Settings" onclick="openCreateRoadmapModal()">
                <svg width="16" height="16" viewBox="0 0 32 32"><path d="M27 16.76V16v-.77l1.92-1.68a2 2 0 00.4-2.4l-2-3.46a2 2 0 00-1.94-1 2 2 0 00-.64.1l-2.43.82a11.35 11.35 0 00-1.31-.75l-.51-2.52a2 2 0 00-2-1.61h-4a2 2 0 00-2 1.61l-.51 2.52a11.48 11.48 0 00-1.32.75l-2.38-.86a2 2 0 00-.68-.09 2 2 0 00-1.72 1l-2 3.46a2 2 0 00.4 2.4l1.92 1.68V16v.77l-1.92 1.68a2 2 0 00-.4 2.4l2 3.46a2 2 0 00 1.72 1 2 2 0 00.68-.09l2.42-.82a11.35 11.35 0 001.31.75l.51 2.52a2 2 0 002 1.61h4a2 2 0 002-1.61l.51-2.52a11.48 11.48 0 001.32-.75l2.42.82a2 2 0 00.64.09 2 2 0 001.72-1l2-3.46a2 2 0 00-.4-2.4zM16 22a6 6 0 116-6 6 6 0 01-6 6z"/></svg>
              </button>
            </div>
          </div>

          <!-- No Roadmap State -->
          <div id="noRoadmapState" style="display: none; text-align: center; padding: 48px 24px;">
            <svg width="48" height="48" viewBox="0 0 32 32" style="color: var(--cds-text-secondary); margin-bottom: 16px;"><path d="M28 4H4a2 2 0 00-2 2v20a2 2 0 002 2h24a2 2 0 002-2V6a2 2 0 00-2-2zM4 26V6h24v20z"/></svg>
            <h3 style="margin-bottom: 8px; font-size: 16px;">No Roadmap Created</h3>
            <p style="color: var(--cds-text-secondary); margin-bottom: 16px;">Create a product roadmap to track planned features and milestones.</p>
            <button class="btn btn--primary" onclick="openCreateRoadmapModal()">Create Roadmap</button>
          </div>

          <!-- Roadmap Content -->
          <div id="roadmapContent" style="display: none;">
            <!-- Roadmap Timeline -->
            <div style="overflow-x: auto; padding: 16px 0;">
              <div style="min-width: 900px;">
                <!-- Quarter Headers -->
                <div id="quarterHeaders" style="display: grid; grid-template-columns: 150px repeat(8, 1fr); gap: 4px; margin-bottom: 16px;">
                  <div style="font-weight: 600; font-size: 12px; color: var(--cds-text-secondary);">Category</div>
                </div>

                <!-- Roadmap Items Container -->
                <div id="roadmapItemsContainer"></div>
              </div>
            </div>

            <!-- Legend -->
            <div style="display: flex; gap: 24px; padding-top: 16px; border-top: 1px solid var(--cds-border-subtle-01); flex-wrap: wrap;">
              <div style="display: flex; align-items: center; gap: 8px; font-size: 12px;">
                <div style="width: 12px; height: 12px; background: var(--cds-interactive); border-radius: 2px;"></div>
                <span>In Progress</span>
              </div>
              <div style="display: flex; align-items: center; gap: 8px; font-size: 12px;">
                <div style="width: 12px; height: 12px; background: #8a3ffc; border-radius: 2px;"></div>
                <span>Planned</span>
              </div>
              <div style="display: flex; align-items: center; gap: 8px; font-size: 12px;">
                <div style="width: 12px; height: 12px; background: var(--cds-support-success); border-radius: 2px;"></div>
                <span>Completed</span>
              </div>
              <div style="display: flex; align-items: center; gap: 8px; font-size: 12px;">
                <div style="width: 12px; height: 12px; background: var(--cds-support-warning); border-radius: 2px;"></div>
                <span>Delayed</span>
              </div>
              <div style="display: flex; align-items: center; gap: 8px; font-size: 12px;">
                <div style="width: 12px; height: 12px; background: var(--cds-support-error); border-radius: 2px;"></div>
                <span>Cancelled</span>
              </div>
            </div>

            <!-- Last Updated -->
            <div id="roadmapLastUpdated" style="margin-top: 16px; font-size: 12px; color: var(--cds-text-secondary);"></div>
          </div>
        </div>

        <!-- Engagements Section (shown when Engagements tab is active) -->
        <div class="card mt-5" id="engagementsSection" style="display: none;">
          <div class="card__header">
            <h2 class="section-title" style="margin-bottom: 0;">
              <svg width="20" height="20" viewBox="0 0 32 32"><path d="M17.74 30L16 29l4-7h6a2 2 0 002-2V8a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2h9v2H6a4 4 0 01-4-4V8a4 4 0 014-4h20a4 4 0 014 4v12a4 4 0 01-4 4h-4.84z"/></svg>
              Customer Engagements
            </h2>
            <div class="flex gap-3">
              <select id="engagementFilter" class="form-select" style="min-width: 120px;" onchange="filterEngagements()">
                <option value="all">All Types</option>
                <option value="meeting">Meetings</option>
                <option value="call">Calls</option>
                <option value="email">Emails</option>
                <option value="qbr">QBRs</option>
                <option value="training">Training</option>
                <option value="support">Support</option>
              </select>
              <button class="btn btn--primary btn--icon" onclick="openEngagementModal()">
                <svg width="16" height="16" viewBox="0 0 32 32"><path d="M17 15V7h-2v8H7v2h8v8h2v-8h8v-2h-8z"/></svg>
                Log Engagement
              </button>
            </div>
          </div>
          <!-- Engagement Drop Zone -->
          <div class="drop-zone" id="engagementDropZone" data-drop-type="engagement">
            <div class="drop-zone__icon">
              <svg width="32" height="32" viewBox="0 0 32 32"><path d="M17.74 30L16 29l4-7h6a2 2 0 002-2V8a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2h9v2H6a4 4 0 01-4-4V8a4 4 0 014-4h20a4 4 0 014 4v12a4 4 0 01-4 4h-4.84z"/></svg>
            </div>
            <div class="drop-zone__content">
              <strong>Drop Outlook emails or calendar events here</strong>
              <span>Or <button type="button" class="btn-link" onclick="document.getElementById('engagementFileInput').click()">browse files</button> (.eml, .ics)</span>
            </div>
            <input type="file" id="engagementFileInput" accept=".eml,.ics,.ical" style="display:none" onchange="handleEngagementFileSelect(event)">
            <div class="drop-zone__hint" id="engagementDropHint"></div>
          </div>

          <div id="engagementsTabContainer" style="padding: 16px;">
            <div class="text-secondary text-center">Loading engagements...</div>
          </div>
        </div>

        <!-- TargetProcess Section (shown when TargetProcess tab is active) -->
        <div class="card mt-5" id="targetprocessSection" style="display: none;">
          <div class="card__header">
            <h2 class="section-title" style="margin-bottom: 0;">
              <svg width="20" height="20" viewBox="0 0 32 32"><path d="M28 4H4a2 2 0 00-2 2v20a2 2 0 002 2h24a2 2 0 002-2V6a2 2 0 00-2-2zM4 26V6h24v20z"/><path d="M6 12h4v2H6zm0 5h4v2H6zm0 5h4v2H6zm6-10h14v2H12zm0 5h14v2H12zm0 5h14v2H12z"/></svg>
              TargetProcess Integration
            </h2>
            <div class="flex gap-3">
              <button class="btn btn--ghost" onclick="refreshTPData()">
                <svg width="16" height="16" viewBox="0 0 32 32"><path d="M12 10H6.78A11 11 0 0127 16h2A13 13 0 006 7.68V4H4v8h8zm8 12h5.22A11 11 0 015 16H3a13 13 0 0023 8.32V28h2v-8h-8z"/></svg>
                Refresh
              </button>
            </div>
          </div>
          <div id="tpTabContainer" style="padding: 16px;">
            <!-- TP Stats Row -->
            <div class="grid grid--4 mb-5" id="tpStatsRow">
              <div class="metric-card">
                <div class="metric-card__label">User Stories</div>
                <div class="metric-card__value" id="tpUserStories">-</div>
              </div>
              <div class="metric-card">
                <div class="metric-card__label">Features</div>
                <div class="metric-card__value" id="tpFeatures">-</div>
              </div>
              <div class="metric-card">
                <div class="metric-card__label">Bugs</div>
                <div class="metric-card__value" id="tpBugs">-</div>
              </div>
              <div class="metric-card">
                <div class="metric-card__label">In Progress</div>
                <div class="metric-card__value" id="tpInProgress">-</div>
              </div>
            </div>
            <!-- TP Items List -->
            <div id="tpItemsList">
              <div class="text-secondary text-center" style="padding: 24px;">Loading TargetProcess data...</div>
            </div>
          </div>
        </div>

        <!-- Documents Section (shown when Documents tab is active) -->
        <div class="card mt-5" id="documentsSection" style="display: none;">
          <div class="card__header">
            <h2 class="section-title" style="margin-bottom: 0;">
              <svg width="20" height="20" viewBox="0 0 32 32"><path d="M25.7 9.3l-7-7A.91.91 0 0018 2H8a2 2 0 00-2 2v24a2 2 0 002 2h16a2 2 0 002-2V10a.91.91 0 00-.3-.7zM18 4.4l5.6 5.6H18zM24 28H8V4h8v6a2 2 0 002 2h6z"/><path d="M10 22h12v2H10zm0-6h12v2H10z"/></svg>
              Customer Documents
            </h2>
            <div class="flex gap-3">
              <select id="documentFilter" class="form-select" style="min-width: 120px;" onchange="filterDocuments()">
                <option value="all">All Types</option>
                <option value="contract">Contracts</option>
                <option value="sow">SOWs</option>
                <option value="presentation">Presentations</option>
                <option value="report">Reports</option>
                <option value="other">Other</option>
              </select>
              <button class="btn btn--primary btn--icon" onclick="openDocumentModal()">
                <svg width="16" height="16" viewBox="0 0 32 32"><path d="M17 15V7h-2v8H7v2h8v8h2v-8h8v-2h-8z"/></svg>
                Upload Document
              </button>
            </div>
          </div>
          <!-- Document Drop Zone -->
          <div class="drop-zone" id="documentDropZone" data-drop-type="document">
            <div class="drop-zone__icon">
              <svg width="32" height="32" viewBox="0 0 32 32"><path d="M25.7 9.3l-7-7A.91.91 0 0018 2H8a2 2 0 00-2 2v24a2 2 0 002 2h16a2 2 0 002-2V10a.91.91 0 00-.3-.7zM18 4.4l5.6 5.6H18zM24 28H8V4h8v6a2 2 0 002 2h6z"/><path d="M10 22h12v2H10zm0-6h12v2H10z"/></svg>
            </div>
            <div class="drop-zone__content">
              <strong>Drop files to attach</strong>
              <span>Or <button type="button" class="btn-link" onclick="document.getElementById('documentFileInput').click()">browse files</button></span>
            </div>
            <input type="file" id="documentFileInput" multiple style="display:none" onchange="handleDocumentFileSelect(event)">
            <div class="drop-zone__hint" id="documentDropHint"></div>
          </div>

          <div id="documentsTabContainer" style="padding: 16px;">
            <div class="text-secondary text-center">Loading documents...</div>
          </div>
        </div>

        <!-- Recommendations Section (shown when Recommendations tab is active) -->
        <div class="card mt-5" id="recommendationsSection" style="display: none;">
          <div class="card__header">
            <h2 class="section-title" style="margin-bottom: 0;">
              <svg width="20" height="20" viewBox="0 0 32 32"><path d="M16 2l4 8 8 1.5-6 5.5 1.5 8.5-7.5-4-7.5 4 1.5-8.5-6-5.5L12 10l4-8z"/></svg>
              Roadmap Recommendations
            </h2>
            <div class="flex gap-3">
              <button class="btn btn--secondary" onclick="generateRecommendations()" id="generateRecsBtn">
                <svg width="16" height="16" viewBox="0 0 32 32" fill="currentColor"><path d="M16 2l4 8 8 1.5-6 5.5 1.5 8.5-7.5-4-7.5 4 1.5-8.5-6-5.5L12 10l4-8z"/></svg>
                Generate Recommendations
              </button>
            </div>
          </div>

          <!-- No Recommendations State -->
          <div id="noRecommendationsState" style="text-align: center; padding: 48px 24px;">
            <svg width="64" height="64" viewBox="0 0 32 32" style="color: var(--cds-text-secondary); margin-bottom: 16px;"><path d="M16 2l4 8 8 1.5-6 5.5 1.5 8.5-7.5-4-7.5 4 1.5-8.5-6-5.5L12 10l4-8z"/></svg>
            <h3 style="margin-bottom: 8px; font-size: 16px;">No Recommendations Yet</h3>
            <p style="color: var(--cds-text-secondary); margin-bottom: 16px;">Complete an SPM Assessment to get AI-powered roadmap recommendations based on the customer's maturity scores.</p>
            <button class="btn btn--primary" onclick="generateRecommendations()">Generate Recommendations</button>
          </div>

          <!-- Recommendations Content -->
          <div id="recommendationsContent" style="display: none; padding: 16px;">
            <!-- Weak Dimensions Summary -->
            <div id="weakDimensionsSummary" style="margin-bottom: 24px;">
              <h3 style="font-size: 14px; font-weight: 600; margin-bottom: 12px;">Areas for Improvement</h3>
              <div id="weakDimensionsChips" style="display: flex; gap: 8px; flex-wrap: wrap;">
                <!-- Chips populated by JS -->
              </div>
            </div>

            <!-- Recommendations List -->
            <div id="recommendationsList">
              <!-- Recommendations populated by JS -->
            </div>
          </div>
        </div>

        <!-- Implementation Flow Section (shown when Implementation Flow tab is active) -->
        <div class="card mt-5" id="implementationFlowSection" style="display: none;">
          <div class="card__header">
            <h2 class="section-title" style="margin-bottom: 0;">
              <svg width="20" height="20" viewBox="0 0 32 32"><path d="M28 2H4a2 2 0 00-2 2v24a2 2 0 002 2h24a2 2 0 002-2V4a2 2 0 00-2-2zM4 28V4h11v24zm13 0V4h11v24z"/><path d="M8 8h4v2H8zm0 4h4v2H8zm0 4h4v2H8zm12-8h4v2h-4zm0 4h4v2h-4zm0 4h4v2h-4z"/></svg>
              Implementation Flow
            </h2>
            <div class="flex gap-3">
              <button class="btn btn--secondary" onclick="refreshFlowVisualization()">
                <svg width="16" height="16" viewBox="0 0 32 32" fill="currentColor"><path d="M12 10H6.78A11 11 0 0127 16h2A13 13 0 006 7.68V4H4v8h8zm8 12h5.22A11 11 0 015 16H3a13 13 0 0023 8.32V28h2v-8h-8z"/></svg>
                Refresh
              </button>
            </div>
          </div>

          <!-- No Flow Data State -->
          <div id="noFlowState" style="text-align: center; padding: 48px 24px;">
            <svg width="64" height="64" viewBox="0 0 32 32" style="color: var(--cds-text-secondary); margin-bottom: 16px;"><path d="M28 2H4a2 2 0 00-2 2v24a2 2 0 002 2h24a2 2 0 002-2V4a2 2 0 00-2-2zM4 28V4h11v24zm13 0V4h11v24z"/></svg>
            <h3 style="margin-bottom: 8px; font-size: 16px;">No Implementation Data</h3>
            <p style="color: var(--cds-text-secondary); margin-bottom: 16px;">Complete an SPM Assessment with scores below threshold to see the implementation flow from dimensions to use cases to TP features.</p>
          </div>

          <!-- Flow Visualization Content -->
          <div id="flowVisualizationContent" style="display: none; padding: 16px;">
            <!-- Summary Statistics -->
            <div class="grid grid--3" style="margin-bottom: 24px;">
              <div class="metric-card">
                <div class="metric-card__label">Weak Dimensions</div>
                <div class="metric-card__value" id="flowWeakDimensionsCount">-</div>
              </div>
              <div class="metric-card">
                <div class="metric-card__label">Recommended Use Cases</div>
                <div class="metric-card__value" id="flowUseCasesCount">-</div>
              </div>
              <div class="metric-card">
                <div class="metric-card__label">TP Features to Implement</div>
                <div class="metric-card__value" id="flowTPFeaturesCount">-</div>
              </div>
            </div>

            <!-- Flow Visualization Card -->
            <div class="card" style="margin-bottom: 24px;">
              <div class="card__header">
                <h3 style="font-size: 14px; font-weight: 600; margin-bottom: 0;">Assessment Gap -> Use Case -> TP Feature Flow</h3>
                <button class="btn btn--ghost btn--sm" onclick="openFlowChartModal()">
                  <svg width="14" height="14" viewBox="0 0 32 32" fill="currentColor"><path d="M28 4H10a2 2 0 00-2 2v14a2 2 0 002 2h18a2 2 0 002-2V6a2 2 0 00-2-2zm0 16H10V6h18zM2 24V10H0v14a2 2 0 002 2h18v-2z"/></svg>
                  Expand
                </button>
              </div>
              <div class="card__body">
                <!-- Filter Controls -->
                <div class="flow-filters" style="display: flex; gap: 16px; margin-bottom: 16px; flex-wrap: wrap; align-items: center;">
                  <div class="flow-filter-group">
                    <label style="font-size: 12px; font-weight: 500; color: var(--cds-text-secondary); margin-right: 8px;">Filter by Dimension:</label>
                    <select id="flowDimensionFilter" class="form-select" style="min-width: 180px; padding: 6px 12px; border-radius: 4px; border: 1px solid var(--cds-border-strong); font-size: 13px;" onchange="applyFlowFilters()">
                      <option value="all">All Dimensions</option>
                    </select>
                  </div>
                  <div class="flow-filter-group">
                    <label style="font-size: 12px; font-weight: 500; color: var(--cds-text-secondary); margin-right: 8px;">Filter by Use Case:</label>
                    <select id="flowUseCaseFilter" class="form-select" style="min-width: 200px; padding: 6px 12px; border-radius: 4px; border: 1px solid var(--cds-border-strong); font-size: 13px;" onchange="applyFlowFilters()">
                      <option value="all">All Use Cases</option>
                    </select>
                  </div>
                  <button class="btn btn--ghost btn--sm" onclick="resetFlowFilters()" style="font-size: 12px;">
                    <svg width="12" height="12" viewBox="0 0 32 32" fill="currentColor"><path d="M12 10H6.78A11 11 0 0127 16h2A13 13 0 006 7.68V4H4v8h8zm8 12h5.22A11 11 0 015 16H3a13 13 0 0023 8.32V28h2v-8h-8z"/></svg>
                    Reset
                  </button>
                </div>
                <div class="flow-chart-container" onclick="openFlowChartModal()" style="height: 600px; cursor: pointer; border-radius: 8px; transition: all 0.2s ease;">
                  <canvas id="flowSankeyChart"></canvas>
                </div>
                <div class="flow-legend" style="display: flex; justify-content: center; gap: 24px; margin-top: 16px; padding: 12px; background: var(--cds-layer-02); border-radius: 6px;">
                  <span style="display: flex; align-items: center; gap: 6px; font-size: 12px;">
                    <span style="width: 12px; height: 12px; border-radius: 50%; background: #da1e28;"></span> Critical (&lt; 2.0)
                  </span>
                  <span style="display: flex; align-items: center; gap: 6px; font-size: 12px;">
                    <span style="width: 12px; height: 12px; border-radius: 50%; background: #ff832b;"></span> Needs Work (&lt; 3.0)
                  </span>
                  <span style="display: flex; align-items: center; gap: 6px; font-size: 12px;">
                    <span style="width: 12px; height: 12px; border-radius: 50%; background: #f1c21b;"></span> Below Target (&lt; 4.0)
                  </span>
                  <span style="display: flex; align-items: center; gap: 6px; font-size: 12px;">
                    <span style="width: 12px; height: 12px; border-radius: 50%; background: #0f62fe;"></span> Use Cases
                  </span>
                  <span style="display: flex; align-items: center; gap: 6px; font-size: 12px;">
                    <span style="width: 12px; height: 12px; border-radius: 50%; background: #8a3ffc;"></span> TP Features
                  </span>
                </div>
              </div>
            </div>

            <!-- Data Table: Dimensions with Gaps -->
            <div style="margin-bottom: 24px;">
              <h3 style="font-size: 14px; font-weight: 600; margin-bottom: 12px;">Weak Dimensions</h3>
              <div class="data-table-container">
                <table class="data-table" id="flowDimensionsTable">
                  <thead>
                    <tr>
                      <th>Dimension</th>
                      <th>Score</th>
                      <th>Gap to Target (3.5)</th>
                      <th>Status</th>
                    </tr>
                  </thead>
                  <tbody id="flowDimensionsTableBody">
                    <tr><td colspan="4" class="text-center text-secondary">Loading...</td></tr>
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Data Table: Recommended Use Cases -->
            <div style="margin-bottom: 24px;">
              <h3 style="font-size: 14px; font-weight: 600; margin-bottom: 12px;">Recommended Use Cases</h3>
              <div class="data-table-container">
                <table class="data-table" id="flowUseCasesTable">
                  <thead>
                    <tr>
                      <th>Use Case</th>
                      <th>Solution Area</th>
                      <th>Improves</th>
                      <th>TP Features</th>
                    </tr>
                  </thead>
                  <tbody id="flowUseCasesTableBody">
                    <tr><td colspan="4" class="text-center text-secondary">Loading...</td></tr>
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Data Table: TP Features -->
            <div>
              <h3 style="font-size: 14px; font-weight: 600; margin-bottom: 12px;">TP Features to Implement</h3>
              <div class="data-table-container">
                <table class="data-table" id="flowTPFeaturesTable">
                  <thead>
                    <tr>
                      <th>Feature Name</th>
                      <th>For Use Case</th>
                      <th>Required</th>
                      <th>TP Link</th>
                    </tr>
                  </thead>
                  <tbody id="flowTPFeaturesTableBody">
                    <tr><td colspan="4" class="text-center text-secondary">Loading...</td></tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- Flow Chart Modal -->
        <div class="modal" id="flowChartModal">
          <div class="modal__overlay" onclick="closeFlowChartModal()"></div>
          <div class="modal__container" style="max-width: 1100px; max-height: 90vh;">
            <div class="modal__header">
              <h2 class="modal__title">Assessment -> Use Case -> TP Feature Flow</h2>
              <button class="modal__close" onclick="closeFlowChartModal()">&times;</button>
            </div>
            <div class="modal__body" style="padding: 24px;">
              <!-- Modal Filter Controls -->
              <div class="flow-filters" style="display: flex; gap: 16px; margin-bottom: 16px; flex-wrap: wrap; align-items: center;">
                <div class="flow-filter-group">
                  <label style="font-size: 12px; font-weight: 500; color: var(--cds-text-secondary); margin-right: 8px;">Filter by Dimension:</label>
                  <select id="flowDimensionFilterModal" class="form-select" style="min-width: 180px; padding: 6px 12px; border-radius: 4px; border: 1px solid var(--cds-border-strong); font-size: 13px;" onchange="applyFlowFilters(true)">
                    <option value="all">All Dimensions</option>
                  </select>
                </div>
                <div class="flow-filter-group">
                  <label style="font-size: 12px; font-weight: 500; color: var(--cds-text-secondary); margin-right: 8px;">Filter by Use Case:</label>
                  <select id="flowUseCaseFilterModal" class="form-select" style="min-width: 200px; padding: 6px 12px; border-radius: 4px; border: 1px solid var(--cds-border-strong); font-size: 13px;" onchange="applyFlowFilters(true)">
                    <option value="all">All Use Cases</option>
                  </select>
                </div>
                <button class="btn btn--ghost btn--sm" onclick="resetFlowFilters(true)" style="font-size: 12px;">
                  <svg width="12" height="12" viewBox="0 0 32 32" fill="currentColor"><path d="M12 10H6.78A11 11 0 0127 16h2A13 13 0 006 7.68V4H4v8h8zm8 12h5.22A11 11 0 015 16H3a13 13 0 0023 8.32V28h2v-8h-8z"/></svg>
                  Reset
                </button>
              </div>

              <!-- Exportable Container (includes title, chart, and legend) -->
              <div id="flowExportContainer" style="background: white; padding: 20px; border-radius: 8px;">
                <!-- Title for export -->
                <div id="flowExportTitle" style="text-align: center; margin-bottom: 16px;">
                  <h3 style="font-size: 18px; font-weight: 600; color: #161616; margin: 0;" id="flowExportTitleText">Implementation Flow</h3>
                  <p style="font-size: 12px; color: #525252; margin: 4px 0 0 0;" id="flowExportSubtitle">Assessment Gaps  Recommended Use Cases  TP Features</p>
                </div>

                <!-- Chart Container -->
                <div style="height: 450px;">
                  <canvas id="flowSankeyChartLarge"></canvas>
                </div>

                <!-- Legend for export -->
                <div id="flowExportLegend" style="display: flex; justify-content: center; gap: 24px; margin-top: 16px; padding: 12px; background: #f4f4f4; border-radius: 6px;">
                  <span style="display: flex; align-items: center; gap: 6px; font-size: 12px;">
                    <span style="width: 12px; height: 12px; border-radius: 50%; background: #da1e28;"></span> Critical (&lt; 2.0)
                  </span>
                  <span style="display: flex; align-items: center; gap: 6px; font-size: 12px;">
                    <span style="width: 12px; height: 12px; border-radius: 50%; background: #ff832b;"></span> Needs Work (&lt; 3.0)
                  </span>
                  <span style="display: flex; align-items: center; gap: 6px; font-size: 12px;">
                    <span style="width: 12px; height: 12px; border-radius: 50%; background: #f1c21b;"></span> Below Target (&lt; 4.0)
                  </span>
                  <span style="display: flex; align-items: center; gap: 6px; font-size: 12px;">
                    <span style="width: 12px; height: 12px; border-radius: 50%; background: #0f62fe;"></span> Use Cases
                  </span>
                  <span style="display: flex; align-items: center; gap: 6px; font-size: 12px;">
                    <span style="width: 12px; height: 12px; border-radius: 50%; background: #8a3ffc;"></span> TP Features
                  </span>
                </div>
              </div>
            </div>
            <div class="modal__footer" style="justify-content: center;">
              <button type="button" class="btn btn--primary" onclick="copyFlowVisualToClipboard()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 6px;">
                  <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                  <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                </svg>
                Copy for PowerPoint
              </button>
              <button type="button" class="btn btn--secondary" onclick="downloadFlowVisual()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 6px;">
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                  <polyline points="7 10 12 15 17 10"></polyline>
                  <line x1="12" y1="15" x2="12" y2="3"></line>
                </svg>
                Download Image
              </button>
            </div>
          </div>
        </div>

        <!-- Accept Recommendation Modal -->
        <div class="modal" id="acceptRecommendationModal">
          <div class="modal__overlay" onclick="closeAcceptRecommendationModal()"></div>
          <div class="modal__container" style="max-width: 500px;">
            <div class="modal__header">
              <h2 class="modal__title">Add to Roadmap</h2>
              <button class="modal__close" onclick="closeAcceptRecommendationModal()">&times;</button>
            </div>
            <form id="acceptRecommendationForm" onsubmit="handleAcceptRecommendation(event)">
              <input type="hidden" id="acceptRecId" value="">
              <div class="modal__body">
                <p class="text-secondary mb-4" id="acceptRecTitle">Loading...</p>

                <div class="form-row">
                  <div class="form-group">
                    <label class="form-label" for="acceptRecQuarter">Target Quarter *</label>
                    <select id="acceptRecQuarter" class="select-input" required>
                      <option value="Q1">Q1</option>
                      <option value="Q2">Q2</option>
                      <option value="Q3">Q3</option>
                      <option value="Q4">Q4</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label class="form-label" for="acceptRecYear">Year *</label>
                    <select id="acceptRecYear" class="select-input" required>
                      <!-- Options populated by JS -->
                    </select>
                  </div>
                </div>

                <div class="form-group">
                  <label class="form-label" for="acceptRecNotes">Notes (optional)</label>
                  <textarea id="acceptRecNotes" class="text-input" rows="2" placeholder="Add any notes about this roadmap item..."></textarea>
                </div>
              </div>
              <div class="modal__footer">
                <button type="button" class="btn btn--ghost" onclick="closeAcceptRecommendationModal()">Cancel</button>
                <button type="submit" class="btn btn--primary" id="acceptRecSubmitBtn">Add to Roadmap</button>
              </div>
            </form>
          </div>
        </div>

        <!-- Usage Framework Section (shown when Usage Framework tab is active) -->
        <div class="card mt-5" id="usageFrameworkSection" style="display: none;">
          <div class="card__header">
            <h2 class="section-title" style="margin-bottom: 0;">
              <svg width="20" height="20" viewBox="0 0 32 32"><path d="M10 18H6v8h4v-8zm12-8h-4v16h4V10zm-6 6h-4v10h4V16z"/></svg>
              Usage Framework
            </h2>
            <div class="flex gap-3">
              <select id="usageTimeframe" class="form-select" style="min-width: 120px;" onchange="updateUsageTimeframe()">
                <option value="30">Last 30 Days</option>
                <option value="90" selected>Last 90 Days</option>
                <option value="180">Last 6 Months</option>
                <option value="365">Last Year</option>
              </select>
            </div>
          </div>
          <div id="usageFrameworkContainer" style="padding: 16px;">
            <!-- Usage Metrics Row -->
            <div class="grid grid--4 mb-5">
              <div class="metric-card">
                <div class="metric-card__label">Active Users</div>
                <div class="metric-card__value" id="ufActiveUsers">-</div>
                <div class="metric-card__trend" id="ufActiveUsersTrend">-</div>
              </div>
              <div class="metric-card">
                <div class="metric-card__label">Login Frequency</div>
                <div class="metric-card__value" id="ufLoginFreq">-</div>
                <div class="metric-card__trend" id="ufLoginFreqTrend">-</div>
              </div>
              <div class="metric-card">
                <div class="metric-card__label">Feature Adoption</div>
                <div class="metric-card__value" id="ufFeatureAdoption">-</div>
                <div class="metric-card__trend" id="ufFeatureAdoptionTrend">-</div>
              </div>
              <div class="metric-card">
                <div class="metric-card__label">Engagement Score</div>
                <div class="metric-card__value" id="ufEngagementScore">-</div>
                <div class="metric-card__trend" id="ufEngagementScoreTrend">-</div>
              </div>
            </div>

            <!-- Feature Usage Breakdown -->
            <h3 style="font-size: 14px; font-weight: 600; margin-bottom: 16px;">Feature Usage Breakdown</h3>
            <div id="featureUsageList">
              <div class="text-secondary text-center" style="padding: 24px;">Loading usage data...</div>
            </div>
          </div>
        </div>

        <!-- Roadmap Item Modal -->
        <div class="modal" id="roadmapItemModal">
          <div class="modal__overlay" onclick="closeRoadmapItemModal()"></div>
          <div class="modal__container" style="max-width: 600px;">
            <div class="modal__header">
              <h2 class="modal__title" id="roadmapItemModalTitle">Add Roadmap Item</h2>
              <button class="modal__close" onclick="closeRoadmapItemModal()">&times;</button>
            </div>
            <form id="roadmapItemForm" onsubmit="handleRoadmapItemSubmit(event)">
              <div class="modal__body">
                <input type="hidden" id="roadmapItemId" value="">

                <div class="form-group">
                  <label class="form-label" for="roadmapItemTitle">Title *</label>
                  <input type="text" id="roadmapItemTitle" class="text-input" required placeholder="e.g., Executive Dashboard">
                </div>

                <div class="form-group">
                  <label class="form-label" for="roadmapItemDescription">Description</label>
                  <textarea id="roadmapItemDescription" class="text-input" rows="3" placeholder="Brief description of this item"></textarea>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label class="form-label" for="roadmapItemCategory">Category *</label>
                    <select id="roadmapItemCategory" class="select-input" required>
                      <option value="feature">Feature</option>
                      <option value="enhancement">Enhancement</option>
                      <option value="integration">Integration</option>
                      <option value="migration">Migration</option>
                      <option value="optimization">Optimization</option>
                      <option value="other">Other</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label class="form-label" for="roadmapItemStatus">Status *</label>
                    <select id="roadmapItemStatus" class="select-input" required>
                      <option value="planned">Planned</option>
                      <option value="in_progress">In Progress</option>
                      <option value="completed">Completed</option>
                      <option value="delayed">Delayed</option>
                      <option value="cancelled">Cancelled</option>
                    </select>
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label class="form-label" for="roadmapItemStartDate">Start Date *</label>
                    <input type="date" id="roadmapItemStartDate" class="text-input" required>
                  </div>
                  <div class="form-group">
                    <label class="form-label" for="roadmapItemDuration">Duration</label>
                    <select id="roadmapItemDuration" class="select-input" onchange="updateEndDateFromDuration()">
                      <option value="">Custom end date</option>
                      <option value="1">1 month</option>
                      <option value="2">2 months</option>
                      <option value="3">3 months (1 quarter)</option>
                      <option value="6">6 months (2 quarters)</option>
                      <option value="9">9 months (3 quarters)</option>
                      <option value="12">12 months (1 year)</option>
                    </select>
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label class="form-label" for="roadmapItemEndDate">End Date *</label>
                    <input type="date" id="roadmapItemEndDate" class="text-input" required>
                  </div>
                  <div class="form-group">
                    <label class="form-label" for="roadmapItemProgress">Progress (%)</label>
                    <input type="number" id="roadmapItemProgress" class="text-input" min="0" max="100" value="0">
                  </div>
                </div>

                <div class="form-group">
                  <label class="form-label" for="roadmapItemNotes">Notes</label>
                  <textarea id="roadmapItemNotes" class="text-input" rows="2" placeholder="Additional notes or updates"></textarea>
                </div>
              </div>
              <div class="modal__footer">
                <button type="button" class="btn btn--danger" id="roadmapItemDeleteBtn" style="display: none; margin-right: auto;" onclick="deleteRoadmapItem(document.getElementById('roadmapItemId').value)">Delete</button>
                <button type="button" class="btn btn--secondary" onclick="closeRoadmapItemModal()">Cancel</button>
                <button type="submit" class="btn btn--primary" id="roadmapItemSubmitBtn">Add Item</button>
              </div>
            </form>
          </div>
        </div>

        <!-- Create Roadmap Modal -->
        <div class="modal" id="createRoadmapModal">
          <div class="modal__overlay" onclick="closeCreateRoadmapModal()"></div>
          <div class="modal__container" style="max-width: 500px;">
            <div class="modal__header">
              <h2 class="modal__title">Create Product Roadmap</h2>
              <button class="modal__close" onclick="closeCreateRoadmapModal()">&times;</button>
            </div>
            <form id="createRoadmapForm" onsubmit="handleCreateRoadmap(event)">
              <div class="modal__body">
                <div class="form-group">
                  <label class="form-label" for="roadmapName">Roadmap Name</label>
                  <input type="text" id="roadmapName" class="text-input" value="Product Roadmap" placeholder="Product Roadmap">
                </div>

                <div class="form-group">
                  <label class="form-label" for="roadmapDescription">Description</label>
                  <textarea id="roadmapDescription" class="text-input" rows="2" placeholder="Optional description"></textarea>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label class="form-label" for="roadmapStartDate">Start Date *</label>
                    <input type="date" id="roadmapStartDate" class="text-input" required>
                  </div>
                  <div class="form-group">
                    <label class="form-label" for="roadmapEndDate">End Date *</label>
                    <input type="date" id="roadmapEndDate" class="text-input" required>
                  </div>
                </div>
              </div>
              <div class="modal__footer">
                <button type="button" class="btn btn--secondary" onclick="closeCreateRoadmapModal()">Cancel</button>
                <button type="submit" class="btn btn--primary">Create Roadmap</button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Push to TargetProcess Modal -->
      <div class="modal" id="pushToTPModal">
        <div class="modal__overlay" onclick="closePushToTPModal()"></div>
        <div class="modal__container" style="max-width: 600px;">
          <div class="modal__header">
            <h2 class="modal__title">Push Roadmap to TargetProcess</h2>
            <button class="modal__close" onclick="closePushToTPModal()">&times;</button>
          </div>
          <div class="modal__body">
            <p style="margin-bottom: 16px; color: var(--cds-text-secondary);">
              The following roadmap items will be created as Features in TargetProcess:
            </p>

            <!-- Items to Push -->
            <div id="tpPushItemsList" style="max-height: 300px; overflow-y: auto; margin-bottom: 16px;">
              <!-- Items will be populated by JS -->
            </div>

            <!-- Project Selection -->
            <div class="form-group">
              <label class="form-label" for="tpProjectSelect">Target Project *</label>
              <select id="tpProjectSelect" class="select-input" required>
                <option value="">Select a project...</option>
                <option value="roadmap">Product Roadmap</option>
                <option value="customer-features">Customer Features</option>
                <option value="platform">Platform Development</option>
              </select>
            </div>

            <!-- Options -->
            <div class="form-group">
              <label class="form-label">Options</label>
              <div style="display: flex; flex-direction: column; gap: 8px;">
                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                  <input type="checkbox" id="tpLinkToCustomer" checked>
                  <span>Link features to customer</span>
                </label>
                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                  <input type="checkbox" id="tpIncludeDates" checked>
                  <span>Include planned dates</span>
                </label>
                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                  <input type="checkbox" id="tpSkipExisting">
                  <span>Skip items already in TargetProcess</span>
                </label>
              </div>
            </div>

            <!-- Status Message -->
            <div id="tpPushStatus" style="display: none; padding: 12px; border-radius: 4px; margin-top: 16px;">
            </div>
          </div>
          <div class="modal__footer">
            <button type="button" class="btn btn--secondary" onclick="closePushToTPModal()">Cancel</button>
            <button type="button" class="btn btn--primary" id="tpPushBtn" onclick="handlePushToTP()">
              <svg width="16" height="16" viewBox="0 0 32 32" style="margin-right: 8px;"><path d="M12 10H6v2h6v6h2v-6h6v-2h-6V4h-2v6z"/><path d="M28 18v8H4V6h10V4H4a2 2 0 00-2 2v20a2 2 0 002 2h24a2 2 0 002-2v-8z"/></svg>
              Push to TargetProcess
            </button>
          </div>
        </div>
      </div>

      <!-- Risk Modal -->
      <div class="modal" id="riskModal">
        <div class="modal__overlay" onclick="closeRiskModal()"></div>
        <div class="modal__container" style="max-width: 600px;">
          <div class="modal__header">
            <h2 class="modal__title" id="riskModalTitle">Add Risk</h2>
            <button class="modal__close" onclick="closeRiskModal()">&times;</button>
          </div>
          <form id="riskForm" onsubmit="handleRiskSubmit(event)">
            <input type="hidden" id="riskId" value="">
            <div class="modal__body">
              <div class="form-group">
                <label class="form-label" for="riskTitle">Title *</label>
                <input type="text" id="riskTitle" class="form-input" required placeholder="Brief description of the risk">
              </div>

              <div class="grid grid--2" style="gap: 16px;">
                <div class="form-group">
                  <label class="form-label" for="riskSeverity">Severity</label>
                  <select id="riskSeverity" class="form-select">
                    <option value="low">Low</option>
                    <option value="medium" selected>Medium</option>
                    <option value="high">High</option>
                    <option value="critical">Critical</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label" for="riskCategory">Category</label>
                  <select id="riskCategory" class="form-select">
                    <option value="">Select category...</option>
                    <option value="adoption">Adoption</option>
                    <option value="renewal">Renewal</option>
                    <option value="technical">Technical</option>
                    <option value="relationship">Relationship</option>
                    <option value="financial">Financial</option>
                    <option value="other">Other</option>
                  </select>
                </div>
              </div>

              <div class="grid grid--2" style="gap: 16px;">
                <div class="form-group">
                  <label class="form-label" for="riskProbability">Probability (1-5)</label>
                  <select id="riskProbability" class="form-select">
                    <option value="">Not rated</option>
                    <option value="1">1 - Very Unlikely</option>
                    <option value="2">2 - Unlikely</option>
                    <option value="3">3 - Possible</option>
                    <option value="4">4 - Likely</option>
                    <option value="5">5 - Very Likely</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label" for="riskImpactRating">Impact (1-5)</label>
                  <select id="riskImpactRating" class="form-select">
                    <option value="">Not rated</option>
                    <option value="1">1 - Minimal</option>
                    <option value="2">2 - Minor</option>
                    <option value="3">3 - Moderate</option>
                    <option value="4">4 - Major</option>
                    <option value="5">5 - Severe</option>
                  </select>
                </div>
              </div>

              <div class="form-group">
                <label class="form-label" for="riskDescription">Description</label>
                <textarea id="riskDescription" class="form-textarea" rows="2" placeholder="Detailed description of the risk"></textarea>
              </div>

              <div class="form-group">
                <label class="form-label" for="riskImpact">Potential Impact</label>
                <textarea id="riskImpact" class="form-textarea" rows="2" placeholder="What could happen if this risk materializes?"></textarea>
              </div>

              <div class="form-group">
                <label class="form-label" for="riskMitigation">Mitigation Plan</label>
                <textarea id="riskMitigation" class="form-textarea" rows="2" placeholder="Steps being taken to address this risk"></textarea>
              </div>

              <div class="grid grid--2" style="gap: 16px;">
                <div class="form-group">
                  <label class="form-label" for="riskOwner">Owner</label>
                  <select id="riskOwner" class="form-select">
                    <option value="">Unassigned</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label" for="riskDueDate">Target Resolution Date</label>
                  <input type="date" id="riskDueDate" class="form-input">
                </div>
              </div>

              <!-- Status (only shown when editing) -->
              <div class="form-group" id="riskStatusGroup" style="display: none;">
                <label class="form-label" for="riskStatus">Status</label>
                <select id="riskStatus" class="form-select">
                  <option value="open">Open</option>
                  <option value="mitigating">Mitigating</option>
                  <option value="resolved">Resolved</option>
                  <option value="accepted">Accepted</option>
                </select>
              </div>
            </div>
            <div class="modal__footer">
              <button type="button" class="btn btn--ghost btn--danger" id="riskDeleteBtn" onclick="deleteRisk()" style="display: none; margin-right: auto;">Delete</button>
              <button type="button" class="btn btn--secondary" onclick="closeRiskModal()">Cancel</button>
              <button type="submit" class="btn btn--primary" id="riskSubmitBtn">Add Risk</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Resolve Risk Modal -->
      <div class="modal" id="resolveRiskModal">
        <div class="modal__overlay" onclick="closeResolveRiskModal()"></div>
        <div class="modal__container" style="max-width: 500px;">
          <div class="modal__header">
            <h2 class="modal__title">Resolve Risk</h2>
            <button class="modal__close" onclick="closeResolveRiskModal()">&times;</button>
          </div>
          <form id="resolveRiskForm" onsubmit="handleResolveRisk(event)">
            <input type="hidden" id="resolveRiskId" value="">
            <div class="modal__body">
              <p id="resolveRiskTitle" style="margin-bottom: 16px; font-weight: 500;"></p>
              <div class="form-group">
                <label class="form-label" for="resolutionNotes">Resolution Notes</label>
                <textarea id="resolutionNotes" class="form-textarea" rows="3" placeholder="Describe how the risk was resolved..."></textarea>
              </div>
            </div>
            <div class="modal__footer">
              <button type="button" class="btn btn--secondary" onclick="closeResolveRiskModal()">Cancel</button>
              <button type="submit" class="btn btn--primary">Mark as Resolved</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Task Modal -->
      <div class="modal" id="taskModal">
        <div class="modal__overlay" onclick="closeTaskModal()"></div>
        <div class="modal__container" style="max-width: 600px;">
          <div class="modal__header">
            <h2 class="modal__title" id="taskModalTitle">Add Task</h2>
            <button class="modal__close" onclick="closeTaskModal()">&times;</button>
          </div>
          <form id="taskForm" onsubmit="handleTaskSubmit(event)">
            <input type="hidden" id="taskId" value="">
            <div class="modal__body">
              <div class="form-group">
                <label class="form-label" for="taskTitle">Title *</label>
                <input type="text" id="taskTitle" class="form-input" required placeholder="Task title">
              </div>

              <div class="form-group">
                <label class="form-label" for="taskDescription">Description</label>
                <textarea id="taskDescription" class="form-textarea" rows="2" placeholder="Task details"></textarea>
              </div>

              <div class="grid grid--2" style="gap: 16px;">
                <div class="form-group">
                  <label class="form-label" for="taskPriority">Priority</label>
                  <select id="taskPriority" class="form-select">
                    <option value="low">Low</option>
                    <option value="medium" selected>Medium</option>
                    <option value="high">High</option>
                    <option value="urgent">Urgent</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label" for="taskDueDate">Due Date</label>
                  <input type="date" id="taskDueDate" class="form-input">
                </div>
              </div>

              <div class="grid grid--2" style="gap: 16px;">
                <div class="form-group">
                  <label class="form-label" for="taskAssignee">Assignee</label>
                  <select id="taskAssignee" class="form-select">
                    <option value="">Unassigned</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label" for="taskCustomer">Customer</label>
                  <select id="taskCustomer" class="form-select">
                    <option value="">No customer</option>
                  </select>
                </div>
              </div>

              <!-- Status (only shown when editing) -->
              <div class="form-group" id="taskStatusGroup" style="display: none;">
                <label class="form-label" for="taskStatus">Status</label>
                <select id="taskStatus" class="form-select">
                  <option value="open">Open</option>
                  <option value="in_progress">In Progress</option>
                  <option value="completed">Completed</option>
                  <option value="cancelled">Cancelled</option>
                </select>
              </div>
            </div>
            <div class="modal__footer">
              <button type="button" class="btn btn--ghost btn--danger" id="taskDeleteBtn" onclick="deleteTask()" style="display: none; margin-right: auto;">Delete</button>
              <button type="button" class="btn btn--secondary" onclick="closeTaskModal()">Cancel</button>
              <button type="submit" class="btn btn--primary" id="taskSubmitBtn">Add Task</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Engagement Modal -->
      <div class="modal" id="engagementModal">
        <div class="modal__overlay" onclick="closeEngagementModal()"></div>
        <div class="modal__container" style="max-width: 600px;">
          <div class="modal__header">
            <h2 class="modal__title" id="engagementModalTitle">Log Engagement</h2>
            <button class="modal__close" onclick="closeEngagementModal()">&times;</button>
          </div>
          <form id="engagementForm" onsubmit="handleEngagementSubmit(event)">
            <input type="hidden" id="engagementId" value="">
            <div class="modal__body">
              <div class="form-group">
                <label class="form-label" for="engagementType">Type *</label>
                <select id="engagementType" class="form-select" required>
                  <option value="meeting">Meeting</option>
                  <option value="call">Call</option>
                  <option value="email">Email</option>
                  <option value="qbr">QBR</option>
                  <option value="training">Training</option>
                  <option value="support">Support</option>
                  <option value="other">Other</option>
                </select>
              </div>

              <div class="form-group">
                <label class="form-label" for="engagementSubject">Subject *</label>
                <input type="text" id="engagementSubject" class="form-input" required placeholder="Brief subject of the engagement">
              </div>

              <div class="grid grid--2" style="gap: 16px;">
                <div class="form-group">
                  <label class="form-label" for="engagementDate">Date *</label>
                  <input type="date" id="engagementDate" class="form-input" required>
                </div>
                <div class="form-group">
                  <label class="form-label" for="engagementDuration">Duration (minutes)</label>
                  <input type="number" id="engagementDuration" class="form-input" min="1" placeholder="30">
                </div>
              </div>

              <div class="form-group">
                <label class="form-label" for="engagementAttendees">Attendees</label>
                <input type="text" id="engagementAttendees" class="form-input" placeholder="Names separated by commas">
              </div>

              <div class="form-group">
                <label class="form-label" for="engagementNotes">Notes</label>
                <textarea id="engagementNotes" class="form-textarea" rows="4" placeholder="Key discussion points, outcomes, action items..."></textarea>
              </div>

              <div class="form-group">
                <label class="form-label" for="engagementOutcome">Outcome</label>
                <select id="engagementOutcome" class="form-select">
                  <option value="">Select outcome...</option>
                  <option value="positive">Positive</option>
                  <option value="neutral">Neutral</option>
                  <option value="negative">Negative</option>
                  <option value="follow_up_required">Follow-up Required</option>
                </select>
              </div>
            </div>
            <div class="modal__footer">
              <button type="button" class="btn btn--ghost btn--danger" id="engagementDeleteBtn" onclick="deleteEngagement()" style="display: none; margin-right: auto;">Delete</button>
              <button type="button" class="btn btn--secondary" onclick="closeEngagementModal()">Cancel</button>
              <button type="submit" class="btn btn--primary" id="engagementSubmitBtn">Log Engagement</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Adoption Stage Modal -->
      <div class="modal" id="adoptionStageModal">
        <div class="modal__overlay" onclick="closeAdoptionStageModal()"></div>
        <div class="modal__container" style="max-width: 600px;">
          <div class="modal__header">
            <h2 class="modal__title">Update Adoption Stage</h2>
            <button class="modal__close" onclick="closeAdoptionStageModal()">&times;</button>
          </div>
          <form id="adoptionStageForm" onsubmit="handleAdoptionStageSubmit(event)">
            <div class="modal__body">
              <!-- Current Stage Display -->
              <div style="margin-bottom: 20px; padding: 12px; background: var(--cds-layer-02); border-radius: 8px;">
                <div style="font-size: 12px; color: var(--cds-text-secondary); margin-bottom: 4px;">Current Stage</div>
                <div id="currentStageDisplay" style="font-weight: 600; font-size: 16px;">-</div>
              </div>

              <!-- Stage Selector -->
              <div class="form-group">
                <label class="form-label">Select New Stage</label>
                <div class="stage-selector">
                  <div class="stage-selector__option" data-stage="onboarding" onclick="selectAdoptionStage('onboarding')">
                    <div class="stage-selector__number">1</div>
                    <div class="stage-selector__content">
                      <div class="stage-selector__name">Onboarding</div>
                      <div class="stage-selector__desc">Initial setup and configuration</div>
                    </div>
                    <div class="stage-selector__check">
                      <svg width="16" height="16" viewBox="0 0 32 32"><path d="M13 24l-9-9 1.41-1.41L13 21.17 26.59 7.58 28 9 13 24z"/></svg>
                    </div>
                  </div>
                  <div class="stage-selector__option" data-stage="adoption" onclick="selectAdoptionStage('adoption')">
                    <div class="stage-selector__number">2</div>
                    <div class="stage-selector__content">
                      <div class="stage-selector__name">Adoption</div>
                      <div class="stage-selector__desc">Active user adoption and training</div>
                    </div>
                    <div class="stage-selector__check">
                      <svg width="16" height="16" viewBox="0 0 32 32"><path d="M13 24l-9-9 1.41-1.41L13 21.17 26.59 7.58 28 9 13 24z"/></svg>
                    </div>
                  </div>
                  <div class="stage-selector__option" data-stage="value_realization" onclick="selectAdoptionStage('value_realization')">
                    <div class="stage-selector__number">3</div>
                    <div class="stage-selector__content">
                      <div class="stage-selector__name">Value Realization</div>
                      <div class="stage-selector__desc">Achieving business outcomes</div>
                    </div>
                    <div class="stage-selector__check">
                      <svg width="16" height="16" viewBox="0 0 32 32"><path d="M13 24l-9-9 1.41-1.41L13 21.17 26.59 7.58 28 9 13 24z"/></svg>
                    </div>
                  </div>
                  <div class="stage-selector__option" data-stage="expansion" onclick="selectAdoptionStage('expansion')">
                    <div class="stage-selector__number">4</div>
                    <div class="stage-selector__content">
                      <div class="stage-selector__name">Expansion</div>
                      <div class="stage-selector__desc">Growing usage and capabilities</div>
                    </div>
                    <div class="stage-selector__check">
                      <svg width="16" height="16" viewBox="0 0 32 32"><path d="M13 24l-9-9 1.41-1.41L13 21.17 26.59 7.58 28 9 13 24z"/></svg>
                    </div>
                  </div>
                  <div class="stage-selector__option" data-stage="renewal" onclick="selectAdoptionStage('renewal')">
                    <div class="stage-selector__number">5</div>
                    <div class="stage-selector__content">
                      <div class="stage-selector__name">Renewal</div>
                      <div class="stage-selector__desc">Contract renewal and optimization</div>
                    </div>
                    <div class="stage-selector__check">
                      <svg width="16" height="16" viewBox="0 0 32 32"><path d="M13 24l-9-9 1.41-1.41L13 21.17 26.59 7.58 28 9 13 24z"/></svg>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Notes -->
              <div class="form-group">
                <label class="form-label" for="adoptionStageNotes">Notes (optional)</label>
                <textarea id="adoptionStageNotes" class="form-textarea" rows="2" placeholder="Reason for stage change..."></textarea>
              </div>
            </div>
            <div class="modal__footer">
              <button type="button" class="btn btn--secondary" onclick="closeAdoptionStageModal()">Cancel</button>
              <button type="submit" class="btn btn--primary" id="adoptionStageSubmitBtn">Update Stage</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Edit Account Details Modal -->
      <div class="modal" id="editAccountModal">
        <div class="modal__overlay" onclick="closeEditAccountModal()"></div>
        <div class="modal__container" style="max-width: 600px;">
          <div class="modal__header">
            <h2 class="modal__title">Edit Account Details</h2>
            <button class="modal__close" onclick="closeEditAccountModal()">&times;</button>
          </div>
          <form id="editAccountForm" onsubmit="handleEditAccountSubmit(event)">
            <div class="modal__body">
              <div class="grid grid--2" style="gap: 16px;">
                <div class="form-group">
                  <label class="form-label" for="editAccountManager">Account Manager</label>
                  <select id="editAccountManager" class="form-select">
                    <option value="">Select Account Manager</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label" for="editCsmOwner">CSM Owner</label>
                  <select id="editCsmOwner" class="form-select">
                    <option value="">Select CSM Owner</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label" for="editPartner">Partner</label>
                  <select id="editPartner" class="form-select">
                    <option value="">No Partner</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label" for="editIndustry">Industry</label>
                  <select id="editIndustry" class="form-select">
                    <option value="">Select industry</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label" for="editEmployees">Employee Count</label>
                  <select id="editEmployees" class="form-select">
                    <option value="">Select range</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label" for="editContractStart">Contract Start Date</label>
                  <input type="date" id="editContractStart" class="form-input">
                </div>
                <div class="form-group">
                  <label class="form-label" for="editContractEnd">Contract End Date</label>
                  <input type="date" id="editContractEnd" class="form-input">
                </div>
                <div class="form-group">
                  <label class="form-label" for="editRenewalDate">Renewal Date</label>
                  <input type="date" id="editRenewalDate" class="form-input">
                </div>
                <div class="form-group">
                  <label class="form-label" for="editArr">ARR ($)</label>
                  <input type="number" id="editArr" class="form-input" placeholder="e.g., 450000" step="1000">
                </div>
              </div>
            </div>
            <div class="modal__footer">
              <button type="button" class="btn btn--secondary" onclick="closeEditAccountModal()">Cancel</button>
              <button type="submit" class="btn btn--primary" id="editAccountSubmitBtn">Save Changes</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Edit Health Score Modal -->
      <div class="modal" id="editHealthModal">
        <div class="modal__overlay" onclick="closeEditHealthModal()"></div>
        <div class="modal__container" style="max-width: 500px;">
          <div class="modal__header">
            <h2 class="modal__title">Edit Health Score</h2>
            <button class="modal__close" onclick="closeEditHealthModal()">&times;</button>
          </div>
          <form id="editHealthForm" onsubmit="handleEditHealthSubmit(event)">
            <div class="modal__body">
              <div class="form-group">
                <label class="form-label" for="editHealthStatus">Health Status *</label>
                <select id="editHealthStatus" class="form-select" required>
                  <option value="green">Green - Healthy</option>
                  <option value="yellow">Yellow - Needs Attention</option>
                  <option value="red">Red - At Risk</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label" for="editHealthScore">Health Score (0-100)</label>
                <input type="number" id="editHealthScore" class="form-input" min="0" max="100" placeholder="e.g., 85">
                <span class="form-hint">Overall health score from 0 to 100</span>
              </div>
              <div class="form-group">
                <label class="form-label" for="editHealthTrend">Trend</label>
                <select id="editHealthTrend" class="form-select">
                  <option value="">Select trend</option>
                  <option value="improving">Improving</option>
                  <option value="stable">Stable</option>
                  <option value="declining">Declining</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label" for="editHealthOverrideReason">Override Reason</label>
                <textarea id="editHealthOverrideReason" class="form-input" rows="3" placeholder="Explain why the health status was manually set (optional)"></textarea>
                <span class="form-hint">Document the reason for any manual health status override</span>
              </div>
            </div>
            <div class="modal__footer">
              <button type="button" class="btn btn--secondary" onclick="closeEditHealthModal()">Cancel</button>
              <button type="submit" class="btn btn--primary" id="editHealthSubmitBtn">Save Changes</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Meeting Note Modal -->
      <div class="modal" id="meetingNoteModal">
        <div class="modal__overlay" onclick="closeMeetingNoteModal()"></div>
        <div class="modal__container" style="max-width: 600px;">
          <div class="modal__header">
            <h2 class="modal__title" id="meetingNoteModalTitle">Add Meeting Note</h2>
            <button class="modal__close" onclick="closeMeetingNoteModal()">&times;</button>
          </div>
          <form id="meetingNoteForm" onsubmit="handleMeetingNoteSubmit(event)">
            <input type="hidden" id="meetingNoteId" value="">
            <div class="modal__body">
              <div class="grid grid--2" style="gap: 16px;">
                <div class="form-group">
                  <label class="form-label" for="meetingNoteDate">Meeting Date *</label>
                  <input type="date" id="meetingNoteDate" class="form-input" required>
                </div>
                <div class="form-group">
                  <label class="form-label" for="meetingNoteTitle">Title *</label>
                  <input type="text" id="meetingNoteTitle" class="form-input" required placeholder="e.g., Weekly Check-in">
                </div>
              </div>
              <div class="form-group">
                <label class="form-label" for="meetingNoteAttendees">Attendees</label>
                <input type="text" id="meetingNoteAttendees" class="form-input" placeholder="e.g., John Doe, Jane Smith">
                <span class="form-hint">Comma-separated list of attendees</span>
              </div>
              <div class="form-group">
                <label class="form-label" for="meetingNoteNotes">Notes</label>
                <textarea id="meetingNoteNotes" class="form-input" rows="4" placeholder="Key discussion points..."></textarea>
              </div>
              <div class="form-group">
                <label class="form-label" for="meetingNoteActionItems">Action Items</label>
                <textarea id="meetingNoteActionItems" class="form-input" rows="3" placeholder="List action items from the meeting..."></textarea>
              </div>
              <div class="form-group">
                <label class="form-label" for="meetingNoteNextSteps">Next Steps</label>
                <textarea id="meetingNoteNextSteps" class="form-input" rows="2" placeholder="Follow-up actions and next meeting plans..."></textarea>
              </div>
            </div>
            <div class="modal__footer">
              <button type="button" class="btn btn--secondary" onclick="closeMeetingNoteModal()">Cancel</button>
              <button type="submit" class="btn btn--primary" id="meetingNoteSubmitBtn">Save Note</button>
            </div>
          </form>
        </div>
      </div>

      <!-- View Meeting Note Modal -->
      <div class="modal" id="viewMeetingNoteModal">
        <div class="modal__overlay" onclick="closeViewMeetingNoteModal()"></div>
        <div class="modal__container" style="max-width: 600px;">
          <div class="modal__header">
            <h2 class="modal__title" id="viewMeetingNoteTitle">Meeting Note</h2>
            <button class="modal__close" onclick="closeViewMeetingNoteModal()">&times;</button>
          </div>
          <div class="modal__body" id="viewMeetingNoteContent">
            <!-- Content populated by JavaScript -->
          </div>
          <div class="modal__footer">
            <button type="button" class="btn btn--ghost" id="deleteMeetingNoteBtn" onclick="deleteMeetingNote()">Delete</button>
            <div style="flex: 1;"></div>
            <button type="button" class="btn btn--secondary" onclick="createTaskFromMeetingNote()">
              <svg width="14" height="14" viewBox="0 0 32 32" fill="currentColor" style="margin-right: 4px;"><path d="M17 15V7h-2v8H7v2h8v8h2v-8h8v-2h-8z"/></svg>
              Add Task
            </button>
            <button type="button" class="btn btn--secondary" onclick="closeViewMeetingNoteModal()">Close</button>
            <button type="button" class="btn btn--primary" id="editMeetingNoteBtn" onclick="editMeetingNote()">Edit</button>
          </div>
        </div>
      </div>

      <!-- Drop Action Modal (for choosing engagement vs document) -->
      <div class="modal" id="dropActionModal">
        <div class="modal__overlay" onclick="closeDropActionModal()"></div>
        <div class="modal__container" style="max-width: 500px;">
          <div class="modal__header">
            <h2 class="modal__title">Save Dropped Item</h2>
            <button class="modal__close" onclick="closeDropActionModal()">&times;</button>
          </div>
          <div class="modal__body">
            <p style="margin-bottom: 16px;" id="dropActionDescription">How would you like to save this item?</p>

            <!-- Preview of dropped content -->
            <div class="drop-preview" id="dropPreview" style="background: var(--cds-layer-02); padding: 12px; border-radius: 4px; margin-bottom: 16px;">
              <div id="dropPreviewContent"></div>
            </div>

            <div class="drop-action-options">
              <button type="button" class="drop-action-btn" onclick="saveDropAsEngagement()">
                <div class="drop-action-btn__icon">
                  <svg width="24" height="24" viewBox="0 0 32 32"><path d="M17.74 30L16 29l4-7h6a2 2 0 002-2V8a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2h9v2H6a4 4 0 01-4-4V8a4 4 0 014-4h20a4 4 0 014 4v12a4 4 0 01-4 4h-4.84z"/></svg>
                </div>
                <div class="drop-action-btn__content">
                  <strong>Create Engagement</strong>
                  <span>Log as an email, meeting, or call interaction</span>
                </div>
              </button>
              <button type="button" class="drop-action-btn" onclick="saveDropAsDocument()">
                <div class="drop-action-btn__icon">
                  <svg width="24" height="24" viewBox="0 0 32 32"><path d="M25.7 9.3l-7-7A.91.91 0 0018 2H8a2 2 0 00-2 2v24a2 2 0 002 2h16a2 2 0 002-2V10a.91.91 0 00-.3-.7zM18 4.4l5.6 5.6H18zM24 28H8V4h8v6a2 2 0 002 2h6z"/></svg>
                </div>
                <div class="drop-action-btn__content">
                  <strong>Save as Document</strong>
                  <span>Store in customer documents for reference</span>
                </div>
              </button>
            </div>
          </div>
          <div class="modal__footer">
            <button type="button" class="btn btn--ghost" onclick="closeDropActionModal()">Cancel</button>
          </div>
        </div>
      </div>

      <!-- Browser Warning Modal -->
      <div class="modal" id="browserWarningModal">
        <div class="modal__overlay" onclick="closeBrowserWarningModal()"></div>
        <div class="modal__container" style="max-width: 500px;">
          <div class="modal__header">
            <h2 class="modal__title">Browser Compatibility Note</h2>
            <button class="modal__close" onclick="closeBrowserWarningModal()">&times;</button>
          </div>
          <div class="modal__body">
            <div style="display: flex; align-items: flex-start; gap: 12px; margin-bottom: 16px;">
              <svg width="24" height="24" viewBox="0 0 32 32" fill="#f1c21b"><path d="M16 2C8.3 2 2 8.3 2 16s6.3 14 14 14 14-6.3 14-14S23.7 2 16 2zm-1 6h2v12h-2V8zm1 17c-.8 0-1.5-.7-1.5-1.5S15.2 22 16 22s1.5.7 1.5 1.5S16.8 25 16 25z"/></svg>
              <div>
                <p style="margin-bottom: 12px;"><strong>Direct drag-and-drop from Mac Outlook may not work in this browser.</strong></p>
                <p style="margin-bottom: 12px;">This is a known limitation with Chrome and Firefox on macOS.</p>
                <p><strong>Workaround:</strong> First drag the email or calendar event to your Desktop to create a file, then drag that file here.</p>
              </div>
            </div>
            <div style="background: var(--cds-layer-02); padding: 12px; border-radius: 4px;">
              <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                <input type="checkbox" id="dontShowBrowserWarning" style="width: 16px; height: 16px;">
                <span>Don't show this message again</span>
              </label>
            </div>
          </div>
          <div class="modal__footer">
            <button type="button" class="btn btn--primary" onclick="closeBrowserWarningModal()">Got it</button>
          </div>
        </div>
      </div>
    </main>

    <!-- Mobile Bottom Navigation -->
    <nav class="bottom-nav">
      <ul class="bottom-nav__items">
        <li>
          <a href="index.html" class="bottom-nav__link">
            <svg viewBox="0 0 32 32"><path d="M16 2L2 12v18h10V18h8v12h10V12L16 2z"/></svg>
            Home
          </a>
        </li>
        <li>
          <a href="customers.html" class="bottom-nav__link active">
            <svg viewBox="0 0 32 32"><path d="M28 10h-6V6c0-1.1-.9-2-2-2h-8c-1.1 0-2 .9-2 2v4H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h24c1.1 0 2-.9 2-2V12c0-1.1-.9-2-2-2z"/></svg>
            Customers
          </a>
        </li>
        <li>
          <a href="#" class="bottom-nav__link">
            <svg viewBox="0 0 32 32"><path d="M17 15V7h-2v8H7v2h8v8h2v-8h8v-2h-8z"/></svg>
            Add
          </a>
        </li>
        <li>
          <a href="tasks.html" class="bottom-nav__link">
            <svg viewBox="0 0 32 32"><path d="M14 21.5l-5-4.96L7.59 18 14 24.35 25.41 13 24 11.59 14 21.5z"/></svg>
            Tasks
          </a>
        </li>
        <li>
          <a href="#" class="bottom-nav__link">
            <svg viewBox="0 0 32 32"><path d="M4 6h24v2H4zm0 9h24v2H4zm0 9h24v2H4z"/></svg>
            More
          </a>
        </li>
      </ul>
    </nav>
  </div>

  <!-- Chat Widget -->
  <button class="chat-trigger" id="chatTrigger" onclick="toggleChatPanel()" title="CS Assistant">
    <svg viewBox="0 0 24 24" fill="currentColor">
      <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H5.17L4 17.17V4h16v12z"/>
      <path d="M7 9h10v2H7zm0-3h10v2H7zm0 6h7v2H7z"/>
    </svg>
  </button>

  <div class="chat-panel" id="chatPanel">
    <div class="chat-header">
      <div class="chat-header__title">
        <div class="chat-header__status"></div>
        <h3>CS Assistant</h3>
      </div>
      <div class="chat-header__actions">
        <button class="chat-header__btn" onclick="clearChat()" title="Clear chat">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
          </svg>
        </button>
        <button class="chat-header__btn" onclick="toggleChatPanel()" title="Close">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 6L6 18M6 6l12 12"/>
          </svg>
        </button>
      </div>
    </div>
    <div class="chat-messages" id="chatMessages"></div>
    <div class="chat-input-area">
      <div class="chat-input-wrapper">
        <textarea id="chatInput" placeholder="Ask about customers, tasks, risks..." rows="1"></textarea>
      </div>
      <button id="chatSendBtn" onclick="sendMessage()" title="Send">
        <svg viewBox="0 0 24 24" fill="currentColor">
          <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- Assessment Report Modal -->
  <div class="modal" id="assessmentReportModal">
    <div class="modal__overlay" onclick="closeAssessmentReportModal()"></div>
    <div class="modal__container" style="max-width: 900px; max-height: 90vh;">
      <div class="modal__header">
        <h2 class="modal__title">Assessment Report</h2>
        <div style="display: flex; gap: 8px; align-items: center;">
          <button class="btn btn--secondary btn--sm" onclick="exportAssessmentExcel()" title="Export to Excel">
            <svg width="16" height="16" viewBox="0 0 32 32" fill="currentColor" style="margin-right: 4px;">
              <path d="M28.781 4.405h-10.13V2.018L2 4.588v22.527l16.651 2.868v-3.538h10.13A1.162 1.162 0 0030 25.349V5.5a1.162 1.162 0 00-1.219-1.095zm-12.282 2.81h1.544v5.395h-1.544zm0 6.165h1.544v5.395h-1.544zm-9.252 8.312l2.574-4.308-2.326-4.2h2.596l1.198 2.544c.11.237.193.44.251.606h.018c.088-.235.175-.44.261-.618l1.286-2.532h2.392l-2.392 4.262 2.492 4.246h-2.591l-1.426-2.858a2.078 2.078 0 01-.157-.387h-.023a1.81 1.81 0 01-.158.387l-1.405 2.858zm9.252-.77h1.544v5.395h-1.544zm2.522-13.707h1.544v5.395h-1.544zm0 6.165h1.544v5.395h-1.544zm0 6.165h1.544v5.395h-1.544zm2.522-12.33h1.544v5.395h-1.544zm0 6.165h1.544v5.395h-1.544zm0 6.165h1.544v5.395h-1.544zm2.522-12.33H26v5.395h-1.544zm0 6.165H26v5.395h-1.544zm0 6.165H26v5.395h-1.544z"/>
            </svg>
            Excel
          </button>
          <button class="btn btn--secondary btn--sm" onclick="printAssessmentReport()" title="Print / Save as PDF">
            <svg width="16" height="16" viewBox="0 0 32 32" fill="currentColor" style="margin-right: 4px;">
              <path d="M28 9h-4V5H8v4H4a2 2 0 00-2 2v10a2 2 0 002 2h4v4h16v-4h4a2 2 0 002-2V11a2 2 0 00-2-2zM10 7h12v2H10zm12 18H10v-6h12zm4-8h-2v-2h2z"/>
            </svg>
            Print/PDF
          </button>
          <button class="modal__close" onclick="closeAssessmentReportModal()">&times;</button>
        </div>
      </div>
      <div class="modal__body" id="assessmentReportContent" style="max-height: calc(90vh - 120px); overflow-y: auto;">
        <div class="text-secondary text-center" style="padding: 48px;">Loading report...</div>
      </div>
    </div>
  </div>

  <!-- Recommendation Modal -->
  <div class="modal" id="recommendationModal">
    <div class="modal__overlay" onclick="closeRecommendationModal()"></div>
    <div class="modal__container" style="max-width: 600px;">
      <div class="modal__header">
        <h2 class="modal__title" id="recommendationModalTitle">Add Recommendation</h2>
        <button class="modal__close" onclick="closeRecommendationModal()">&times;</button>
      </div>
      <form id="recommendationForm" onsubmit="event.preventDefault(); saveRecommendation();">
        <div class="modal__body">
          <div class="form__group">
            <label class="form__label" for="recTitle">Title <span class="text-danger">*</span></label>
            <input type="text" id="recTitle" class="form__input" required placeholder="Enter recommendation title">
          </div>

          <div class="form__group">
            <label class="form__label" for="recDescription">Description</label>
            <textarea id="recDescription" class="form__input form__textarea" rows="6" placeholder="Enter recommendation details. Supports markdown: **bold**, *italic*, [link](url), - list items"></textarea>
            <span class="form__helper">Supports markdown formatting: **bold**, *italic*, [link](url), - lists</span>
          </div>

          <div class="form__row">
            <div class="form__group" style="flex: 1;">
              <label class="form__label" for="recPriority">Priority</label>
              <select id="recPriority" class="form__input">
                <option value="high">High</option>
                <option value="medium" selected>Medium</option>
                <option value="low">Low</option>
              </select>
            </div>

            <div class="form__group" style="flex: 1;">
              <label class="form__label" for="recCategory">Category</label>
              <input type="text" id="recCategory" class="form__input" placeholder="e.g., Process, Technology, People">
            </div>
          </div>
        </div>

        <div class="modal__footer">
          <button type="button" class="btn btn--ghost" onclick="closeRecommendationModal()">Cancel</button>
          <button type="submit" class="btn btn--primary">Save Recommendation</button>
        </div>
      </form>
    </div>
  </div>

  <script src="js/auth.js?v=5"></script>
  <script src="js/api.js?v=16"></script>
  <script src="js/chat.js?v=1"></script>
  <script src="js/table-sort.js?v=1"></script>
  <script src="js/customer-detail.js?v=47"></script>
</body>
</html>
